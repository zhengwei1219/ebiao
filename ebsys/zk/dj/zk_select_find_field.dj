<script>&#13;&#10;function uf_open(){&#13;&#10;	labTbName.innerText = fcpubdata.obj[1];&#13;&#10;	var jiahao = "+";&#13;&#10;	if (fcpubdata.databaseTypeName == "oracle") jiahao = "||";&#13;&#10;	dataset1.Open("select tbname,fdname,'|'"+jiahao+" CHNNAME "+jiahao+"'|' as CHNNAME,type from fc_entitysub where tbname ='"+fcpubdata.obj[1]+"' Order By sortNo");&#13;&#10;	if(IsSpace(fcpubdata.obj[3]) == true) return;&#13;&#10;	var len = fcpubdata.obj[3].length;&#13;&#10;	for(var j=0;j<len;j++){&#13;&#10;		var l=dataset1.oDom.documentElement.childNodes.length-1;&#13;&#10;		for(var i=0;i<l;i++){&#13;&#10;			if(fcpubdata.obj[3][j] == dataset1.oDom.documentElement.childNodes(i).childNodes(2).text ){&#13;&#10;				dataset1.oDom.documentElement.childNodes(i).childNodes(0).text = "是";&#13;&#10;				/*var oTd = grid1.tab.rows(i+1).cells(1);&#13;&#10;				oTd.style.backgroundImage="url("+fcpubdata.path+"/fceform/images/ef_run_grid_checked.gif)";&#13;&#10;				oTd.style.backgroundRepeat="no-repeat";*/&#13;&#10;				dataset1.oDom.documentElement.childNodes(i).childNodes(3).text = fcpubdata.obj[4][j];&#13;&#10;				dataset1.oDom.documentElement.childNodes(i).childNodes(4).text = fcpubdata.obj[7][j];&#13;&#10;				break;				&#13;&#10;			}&#13;&#10;		}&#13;&#10;	}&#13;&#10;	dataset1.dset_cont();&#13;&#10;	dataset1.SetPos(0);&#13;&#10;	//uf_xmlGet();&#13;&#10;}&#13;&#10;&#13;&#10;function uf_sel() {&#13;&#10;	dataset1.Update();//防止修改某行记录后，鼠标没移动行，记录没提交到数据集&#13;&#10;	var xmlSql = "";&#13;&#10;	var fieldArr =  new Array();&#13;&#10;	var titleArr = new Array();&#13;&#10;	var showContArr = new Array();&#13;&#10;	var len = titleArr.length;&#13;&#10;	var xmlRet = SelectSql("select fdname from fc_entitysub where (tbname='"+fcpubdata.obj[1]+"' and type= '名称') or  tbname='"+fcpubdata.obj[1]+"' and type='自动编号'" ,1,-1);&#13;&#10;	var oXml = SetDom(xmlRet);&#13;&#10;	if (oXml.documentElement == null) {&#13;&#10;	    alert(xmlRet);&#13;&#10;	    return;&#13;&#10;	}&#13;&#10;	if (oXml.documentElement.childNodes.length < 1){&#13;&#10;		alert(fcpubdata.obj[1]+"表中没有名称或自动编号的字段，请在"+fcpubdata.obj[1]+"表中添加。"); &#13;&#10;		return;&#13;&#10;	}	 &#13;&#10;	var noNameField = true;&#13;&#10;	var l = dataset1.oDom.documentElement.childNodes.length-1;&#13;&#10;	xmlSql += "<delete tableName='fc_relation' ><where>  tbname1='"+fcpubdata.obj[0]+"' and fdname1='"+fcpubdata.obj[2]+"' and tbname2= '"+fcpubdata.obj[1]+"'</where></delete>"&#13;&#10;	if((fcpubdata.obj[5] != null) && (fcpubdata.obj[6] != null)){&#13;&#10;		xmlSql += "<delete tableName='fc_relation' ><where>  tbname1='"+fcpubdata.obj[0]+"' and fdname1='"+fcpubdata.obj[6]+"' and tbname2= '"+fcpubdata.obj[5]+"'</where></delete>"&#13;&#10;	}&#13;&#10;&#13;&#10;	for(var i=0;i<l;i++){&#13;&#10;		if(dataset1.oDom.documentElement.childNodes(i).childNodes(0).text == "是"){&#13;&#10;			if(dataset1.oDom.documentElement.childNodes(i).childNodes(5).text == "名称" || dataset1.oDom.documentElement.childNodes(i).childNodes(5).text == "自动编号") { &#13;&#10;			 	noNameField = false;&#13;&#10;			}&#13;&#10;			&#13;&#10;			fieldArr[len] = dataset1.oDom.documentElement.childNodes(i).childNodes(2).text;			&#13;&#10;			titleArr[len] = dataset1.oDom.documentElement.childNodes(i).childNodes(3).text;&#13;&#10;			showContArr[len] = dataset1.oDom.documentElement.childNodes(i).childNodes(4).text;&#13;&#10;			len += 1;&#13;&#10;			var rowNo = i+1;&#13;&#10;			xmlSql += "<insert tableName='fc_relation'><names> tbname1,tbname2,fdname1,fdname2,title,xmlSet,rowNo</names><values>'"+fcpubdata.obj[0]+"','"+fcpubdata.obj[1]+"','"+fcpubdata.obj[2]+"','"+dataset1.oDom.documentElement.childNodes(i).childNodes(2).text +"','"+dataset1.oDom.documentElement.childNodes(i).childNodes(3).text +"','"+TransSql(RepXml(dataset1.oDom.documentElement.childNodes(i).childNodes(4).text)) +"'," + rowNo + " </values></insert>";&#13;&#10;		}	&#13;&#10;	}&#13;&#10;	if(noNameField == true) {alert("没有选择名称或自动编号类型字段,不能保存"); return }&#13;&#10;	var arr = [xmlSql,fieldArr,titleArr,showContArr];&#13;&#10;	window.returnValue = arr;&#13;&#10;	$eform('关闭窗口');&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_xmlSet(){&#13;&#10;	var xmlSet = "";&#13;&#10;	var showCont = "";&#13;&#10;	var isNotGenField = 0;&#13;&#10;	if(!IsSpace($id('showCont').value)){&#13;&#10;		xmlSet += "<showCont>"+$id('showCont').value+"</showCont>"&#13;&#10;	}&#13;&#10;	if(!IsSpace($id('isNotGenField').value)){&#13;&#10;		xmlSet += "<isNotGenField>"+$id('isNotGenField').value+"</isNotGenField>";&#13;&#10;	}&#13;&#10;	dataset1.Field('xmlSet').Value = xmlSet;&#13;&#10;} &#13;&#10;&#13;&#10;function uf_xmlGet(){&#13;&#10;	var showCont = "";&#13;&#10;	var isNotGenField = 0;&#13;&#10;	if(!IsSpace(dataset1.Field('xmlSet').Value)){&#13;&#10;		var oDom = SetDom("<root>"+dataset1.Field('xmlSet').Value+"</root>");&#13;&#10;		if(oDom.documentElement != null){&#13;&#10;			uf_getProp(oDom,'showCont');&#13;&#10;			uf_getProp(oDom,'isNotGenField');&#13;&#10;		}&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;function uf_getProp(oDom,nodeName){&#13;&#10;	var node = oDom.documentElement.selectSingleNode("/root/"+nodeName);&#13;&#10;	if(node != null){&#13;&#10;		if(nodeName == "isNotGenField") {&#13;&#10;			SetCheckBoxValue($id("isNotGenField"), node.text);&#13;&#10;		}&#13;&#10;		$id(nodeName).value = node.text;&#13;&#10;	}		&#13;&#10;}</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true toolbar="自定义工具栏" billtaborder="<root><taborder>isNotGenField</taborder><taborder>title</taborder><taborder>showCont</taborder><taborder>grid1</taborder></root>" dj_sn="zk_select_find_field" caption="查找关系类型选择多字段" type="ZK" isfile="是" center="居中" posleft postop poswidth="388" posheight="500" window="有模式窗口" BLONopen="uf_open()" BLONopenBefore BLONclose userType alertType="1" isCheckPermit="否" controlno="SKButton:0;SKDBedit:0;checkbox:1;label:6;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:1;text:1;hr:0;checkboxlist:0;radiolist:0;dropdownlist:1;grid:2;dataset:1;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;eblayout:0;test:undefined" contxml="<root><checkbox><id>isNotGenField</id></checkbox><label><id>label1</id><id>labTbName</id><id>label4</id><id>label5</id><id>label6</id></label><a><id>a11</id></a><text><id>title</id></text><dropdownlist><id>showCont</id></dropdownlist><grid><id>grid1</id></grid><dataset><id>dataset1</id></dataset></root>" jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;fctorun.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" BLONresizeBefore BLONresizeAfter allBrowser="否" useHelp unselectable="on" userToolbar='<tr rowstate="add"><td>ok</td><td>确定</td><td></td><td>uf_sel()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>close</td><td>关闭窗口</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>'><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 192px; HEIGHT: 407px; TOP: 17px; LEFT: 4px" id=grid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" bodyrows="-1" bodyrowheight="-1" blRowNo="否" hideVscroll="是" hideHscroll="是" SetRowHeight="是" readonly="否" autoappend="否" autowidth="否" autoheight="否" canselect="是" dataset="dataset1" visible="是" controltype="grid" crosstabdatatype="0" crosstabsql cavg="否" cmax="否" cmin="否" csum="否" ccount="否" ravg="否" rmax="否" rmin="否" rsum="否" rcount="否" coltitle rowtitle crosstabformat crosstabsumtype="0" crosstabtitle iscrosstab="否" usertitle usertitlehtml titlerows titlerowheight><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 134px; LEFT: 524px" id=dataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" controltype="dataset" async="否" isSubGrid="否" opensortno="1" pubpara="否" saveastable isaddemptyrec="否" submittype="1" submitno="1" issubds="否" savetable AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll="uf_xmlSet()" AfterScroll datasourceName opensql subdsfield masterds masterdsfield formatxml='<root><tr rowstate="add"><td>sel</td><td>选</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>勾</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>25</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>TBNAME</td><td>表名</td><td>字符</td><td>50</td><td></td><td>数据项</td><td></td><td></td><td>是</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>120</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>FDNAME</td><td>字段名</td><td>字符</td><td>50</td><td></td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>92</td><td></td><td></td><td></td><td></td><td>uf_xmlGet()</td><td></td><td></td><td></td></tr><tr rowstate="add"><td>CHNNAME</td><td>标题</td><td>字符</td><td>50</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>97</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>xmlSet</td><td>字段属性</td><td>字符</td><td>7000</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>96</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>TYPE</td><td>类型</td><td>字符</td><td>30</td><td></td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>60</td><td></td><td></td><td></td><td></td><td>uf_xmlGet()</td><td></td><td></td><td></td></tr><tr rowstate="add"><td>noGenField</td><td>不产生数据集的字段</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' idparam queryTableName="FC_ENTITYSUB"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 15px; TOP: 2px; LEFT: 10px" id=label1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">表名：</LABEL><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 202px; HEIGHT: 15px; TOP: 2px; LEFT: 49px" id=labTbName onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否"></LABEL><A onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 12px; DISPLAY: block; FONT-FAMILY: 宋体; HEIGHT: 18px; COLOR: #0000ff; FONT-SIZE: 16px; TOP: -3px; FONT-WEIGHT: bold; LEFT: 355px; backgroundColor1: #ffffff" id=a11 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() href="javascript:ShowHelp('findmuchfield')" target=_self controltype="a" NotBg="否" href1="javascript:ShowHelp('findmuchfield')">?</A><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 72px; HEIGHT: 16px; TOP: 1px; LEFT: 284px" id=label4 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">查找多字段</LABEL><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 170px; HEIGHT: 20px; TOP: 38px; LEFT: 208px" id=title onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() value=标题 size=30 dataset="dataset1" controltype="text" field="CHNNAME" china="标题"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 170px; HEIGHT: 20px; TOP: 86px; LEFT: 208px; ButtonWidth: 10" id=showCont onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_fccode.gif" format visible="是" controltype="dropdownlist" onselchange='bill_onclick("uf_xmlSet();")' temptext="空&#13;&#10;标签&#13;&#10;只读编辑框&#13;&#10;编辑框&#13;&#10;只读多行编辑框&#13;&#10;多行编辑框" tempvalue="空&#13;&#10;标签&#13;&#10;只读编辑框&#13;&#10;编辑框&#13;&#10;只读多行编辑框&#13;&#10;多行编辑框" FieldNameList isTreeNewSql="0" isShowTree="0" multiselect="否" addrow="否" blnempty="否" blninput="否" xml="<tr height='20px' ><td>空</td><td>空</td></tr><tr height='20px' ><td>标签</td><td>标签</td></tr><tr height='20px' ><td>只读编辑框</td><td>只读编辑框</td></tr><tr height='20px' ><td>编辑框</td><td>编辑框</td></tr><tr height='20px' ><td>只读多行编辑框</td><td>只读多行编辑框</td></tr><tr height='20px' ><td>多行编辑框</td><td>多行编辑框</td></tr>" check="1" sql datasourceName> 
<DIV onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 182px; HEIGHT: 20px; TOP: 117px; LEFT: 205px" id=isNotGenField onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() noWrap dataset="dataset1" controltype="checkbox" field="noGenField" china="不产生数据集的字段" value fc_onclick='bill_onclick("uf_xmlSet()")' falsevalue="0" truevalue="1"><INPUT oncontrolselect=controlselectcancel() type=checkbox><SPAN>是否不产生数据集中的字段</SPAN></DIV><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 15px; TOP: 20px; LEFT: 208px" id=label5 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">标题：</LABEL><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 113px; HEIGHT: 15px; TOP: 68px; LEFT: 208px" id=label6 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">显示控件：</LABEL></DIV>