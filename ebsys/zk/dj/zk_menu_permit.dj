<script>function uf_open(){&#13;&#10;	 var xmlpath = location.protocol + "//" + location.host + fcpubdata.path + "/zk/main/admin_design_menu.xml";&#13;&#10;    var oXml = SetDomFile(xmlpath);&#13;&#10;    var docE = oXml.documentElement;&#13;&#10;    uf_editCode(docE);&#13;&#10;    docE.setAttribute("rootaction", escape("uf_clickTree(Global.selectedItem.code)"));&#13;&#10;    tree1.loadXmlStr(docE.xml);	&#13;&#10;    TreeRootNodeHide($id('tree1'), 'none');&#13;&#10;    tree1.expandAll();&#13;&#10;    e_PropWinOnload() ;&#13;&#10;    &#13;&#10;}&#13;&#10;&#13;&#10;function uf_editCode(oNode){&#13;&#10;	for(var i = 0; i < oNode.childNodes.length;i++){&#13;&#10;    	codeArr = oNode.childNodes[i].getAttribute("code").split(',');&#13;&#10;    	if(codeArr.length < 1) codeArr[0] = "";&#13;&#10;    	oNode.childNodes[i].setAttribute("code", codeArr[0]); &#13;&#10;    	if(oNode.childNodes.length > 0){&#13;&#10;    		uf_editCode(oNode.childNodes[i])&#13;&#10;    	}&#13;&#10;    }&#13;&#10;}&#13;&#10;   &#13;&#10;&#13;&#10;function uf_clickTree(code){&#13;&#10;	dataset1.Open("select fcq_profilesub.profileid ,fcq_profilesub.profileid as profileName,type,detail,permit from fcq_profilesub inner join fcq_profile  on fcq_profile.profileid=fcq_profilesub.profileid where fcq_profilesub.type=1 and fcq_profilesub.detail='"+ code +"'");&#13;&#10;}&#13;&#10;&#13;&#10;function uf_addPermit(){&#13;&#10;	if(Global.selectedItem == null){&#13;&#10;		alert("请先选中菜单中的功能点后，在添加授权角色");&#13;&#10;		return;	&#13;&#10;	}&#13;&#10;	if(IsSpace(Global.selectedItem.code)){&#13;&#10;		alert("您选中的功能点为上级节点或没有功能点id");&#13;&#10;		return;	&#13;&#10;	}&#13;&#10;	$eform('增加行')&#13;&#10;	var roles = fcUserFunc.selectProfiles(grid1,'profileId','profileName');&#13;&#10;	if(IsSpace(roles)){&#13;&#10;		$eform('删除行');		&#13;&#10;	}else{&#13;&#10;		$eform('提交数据');&#13;&#10;		uf_clickTree(Global.selectedItem.code);&#13;&#10;	}	&#13;&#10;		&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_del(){&#13;&#10;&#13;&#10;	if (Global.selectedItem == null) {&#13;&#10;        alert("请选择要删除角色权限的功能点！");&#13;&#10;        return;&#13;&#10;	}&#13;&#10;	var xmlSql = "";&#13;&#10;	var l=dataset1.oDom.documentElement.childNodes.length-1;&#13;&#10;	for(var i=0;i<l;i++){&#13;&#10;		if(dataset1.oDom.documentElement.childNodes(i).childNodes(0).text == "是"){&#13;&#10;			xmlSql += "<delete tableName='fcq_profilesub'><where>  profileId= '"+ dataset1.oDom.documentElement.childNodes(i).childNodes(1).text+"' and type=1 and detail='"+ Global.selectedItem.code +"'</where></delete>";&#13;&#10;		}	&#13;&#10;	}&#13;&#10;	doSaveData(xmlSql,function(){alert("成功删除选中角色功能点权限");uf_clickTree(Global.selectedItem.code)})&#13;&#10;}	&#13;&#10;</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true toolbar="不带工具栏" jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" runParams envType="电脑" dj_sn="zk_menu_permit" caption="主菜单权限设置" type="ZK" isfile="是" center="  " posleft postop poswidth posheight window="当前窗口" BLONopen="uf_open()" BLONopenBefore BLONclose billtaborder="<root><taborder>grid1</taborder><taborder>cmdAdd</taborder><taborder>cmdDel</taborder></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:4;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:4;text:0;hr:0;checkboxlist:0;radiolist:0;dropdownlist:1;grid:1;dataset:1;spin:0;excel:0;tree:5;ebshow:0;ebiao:0;layout:0;page:0;eblayout:0;test:undefined" contxml="<root><button><id>cmdAdd</id><id>cmdDel</id></button><grid><id>grid1</id></grid><dataset><id>dataset1</id></dataset><tree><id>tree1</id></tree></root>" userToolbar='<tr rowstate="add"><td>add</td><td>新增</td><td></td><td>uf_addPermit()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>del</td><td>删除</td><td></td><td>uf_del()</td><td></td><td></td><td></td><td></td><td></td></tr>' useHelp allBrowser="否" BLONresizeAfter BLONresizeBefore userType alertType="1" isCheckPermit="否" unselectable="on"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 138px; LEFT: 1024px" id=dataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" isSubGrid="否" pubpara="否" isaddemptyrec="否" submittype="1" submitno="1" issubds="否" opensortno="1" savetable="FCQ_PROFILESUB" idparam="PRO" fieldtrans="<root><field><name>profileName</name><trans></trans><rtrans></rtrans><sql>select%20profileId%20%20%2CprofileName%20%20from%20FCQ_PROFILE</sql></field></root>" async="否" controltype="dataset" idtype="1" datasourceName AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll queryTableName="FCQ_PROFILESUB" saveastable formatxml="<root><tr rowstate=&quot;add&quot;><td>sel</td><td>选</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>勾</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>30</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>profileid</td><td>角色id</td><td>字符</td><td>11</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot; multisel=&quot;是&quot;><td>profileName</td><td>角色名称</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>380</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>detail</td><td>详细</td><td>字符</td><td>100</td><td>0</td><td>变量默认值</td><td>Global.selectedItem.code</td><td></td><td>是</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>id</td><td>id字段</td><td>字符</td><td>11</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>permit</td><td>权限</td><td>整数</td><td>4</td><td>0</td><td>数据项</td><td>1</td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>right</td><td>80</td><td></td><td></td><td>$valid('整数');</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>type</td><td>类型</td><td>整数</td><td>4</td><td>0</td><td>数据项</td><td>1</td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>right</td><td>80</td><td></td><td></td><td>$valid('整数');</td><td></td><td></td><td></td><td></td><td></td></tr></root>" masterdsfield masterds subdsfield opensql><IMG onresizeend=resizeEnd() style="BORDER-BOTTOM: 1px solid; POSITION: absolute; BORDER-LEFT: 1px solid; WIDTH: 570px; HEIGHT: 536px; BORDER-TOP: 1px solid; TOP: 3px; BORDER-RIGHT: 1px solid; LEFT: 3px" id=tree1 class=control-border-color onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_tree.gif" controltype="tree" datasourceName xml='<TreeNode id="1" text="" roottarget="_self" rootaction=""  target="_self" title=""  icon=""  check="undefined" code=""/>' clicknode roottext="全选" sourcetype="0" ischecked="否" isAll="是" opentb="_self" AutoSizeXml="<record id ='tree1'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>百分比设置</WSetType><Width></Width><WExt></WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>伸缩设置</HSetType><Height></Height><HExt>5</HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 433px; HEIGHT: 512px; TOP: 28px; LEFT: 579px" id=grid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" controltype="grid" visible="是" dataset="dataset1" readonly="否" canselect="是" autoappend="否" autoheight="是" autowidth="否" SetRowHeight="是" hideHscroll="auto" hideVscroll="auto" blRowNo="否" bodyrowheight="-1" bodyrows="-1" titlerowheight titlerows usertitlehtml usertitle iscrosstab="否" crosstabtitle crosstabsumtype="0" crosstabformat rowtitle coltitle rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否" crosstabsql crosstabdatatype="0"><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 1px; LEFT: 580px" id=cmdAdd onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_addPermit()")'></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 1px; LEFT: 662px" id=cmdDel onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_del()")'></BUTTON></DIV>