<script>&#13;&#10;function uf_deltype(){&#13;&#10;	var ret = window.confirm("确定删除当前关系分类吗？");&#13;&#10;	if(ret == true){	&#13;&#10;		var xmlSql="<update tableName='FCQ_RELATION_DICT_TYPE'>  <set>deleteMark = 1</set> <where> typeId = '"+dataset2.Field('typeId').Value+"'</where> </update>";&#13;&#10;		//xmlSql += "<delete tableName='FCQ_RELATION_DICT'>  <where> typeId = '"+dataset2.Field('typeId').Value+"'</where> </delete>";&#13;&#10;		doSaveData(xmlSql,function(){alert("删除关系分类成功")});&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_delRow(){//如果就一条记录，删除后界面上的关系类型字段绑定的控件就没有值了，&#13;&#10;	var typeId = dataset2.Field('typeId').Value;&#13;&#10;	var typeName = dataset2.Field('chnname').Value;&#13;&#10;	$eform('删除行且删除记录');&#13;&#10;	if(dataset2.oDom.documentElement.childNodes.length  == 1){//如果选择的类型没有记录，就给数据集新增一条空记录，然后把类型名称和id赋值给数据集当前行的id名称&#13;&#10;		dataset2.Append();&#13;&#10;		dataset2.Field('typeId').Value = typeId;&#13;&#10;		dataset2.Field('chnname').Value = typeName;&#13;&#10;		dataset2.fset_cont1();&#13;&#10;	}	&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_refeshDs(){//选择关系类型后刷新数据集	&#13;&#10;	var typeId = $id('typeId').value;&#13;&#10;	var typeName = $id('relationType').value;&#13;&#10;	var sql = "select typeId ,tbname1,tbname2 from fcq_relation_dict_type where typeId='"+typeId+"'";&#13;&#10;	var xmlRet1 = SelectSql(sql, 1, 1);&#13;&#10;    var oXml1 = SetDom(xmlRet1);&#13;&#10;    if (oXml1.documentElement == null) {&#13;&#10;        alert(xmlRet1);&#13;&#10;        return;&#13;&#10;    }&#13;&#10;	if (oXml1.documentElement.childNodes.length < 1) return;&#13;&#10;    var table1 = oXml1.documentElement.childNodes[0].childNodes[1].text;&#13;&#10;    var table2 = oXml1.documentElement.childNodes[0].childNodes[2].text;&#13;&#10;    var fromIdSql = uf_sqlTrans(table1,1);&#13;&#10;    var toIdSql = uf_sqlTrans(table2,2);&#13;&#10;    var tbchnname = escape("select tbname, tbchnname  from fc_entity");&#13;&#10;    var chnname = escape("select typeid,chnname from FCQ_RELATION_DICT_TYPE");&#13;&#10;    var permit1 = escape("select  code ,name   from FC_DATADICT where typename='权限类型名称' and name != '私有'");&#13;&#10;    var  fieldtrans ="<root><field><name>tbchnname</name><trans></trans><rtrans></rtrans><sql>"+tbchnname+"</sql></field><field><name>fromName</name><trans></trans><rtrans></rtrans><sql>"+fromIdSql+"</sql></field><field><name>toName</name><trans></trans><rtrans></rtrans><sql>"+toIdSql+"</sql></field><field><name>chnname</name><trans></trans><rtrans></rtrans><sql>"+ chnname +"</sql></field><field><name>permit1</name><trans></trans><rtrans></rtrans><sql>"+permit1+"</sql></field></root>";&#13;&#10;    dataset2.oXmlTrans = SetDom(fieldtrans);&#13;&#10;	dataset2.Open();&#13;&#10;	if(dataset2.oDom.documentElement.childNodes.length  == 1){//如果选择的类型没有记录，就给数据集新增一条空记录，然后把类型名称和id赋值给数据集当前行的id名称&#13;&#10;		dataset2.Append();&#13;&#10;		dataset2.Field('typeId').Value = typeId;&#13;&#10;		dataset2.Field('chnname').Value = typeName;&#13;&#10;		dataset2.fset_cont1();&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_sqlTrans(tableName,type){//根据表名生成读出时转换的sql语句&#13;&#10;	var sqlTrans ="";&#13;&#10;	var id = "fromId";&#13;&#10;	var name = "fromName";&#13;&#10;	if(type == 2){&#13;&#10;		id = "toId";&#13;&#10;		name = "toName";&#13;&#10;	}&#13;&#10;	if(tableName == "FCQ_USER"){&#13;&#10;    	sqlTrans = escape("select userid as "+id+" ,username as "+name+" from FCQ_USER"); 	&#13;&#10;    }else  if(tableName == "FCQ_USER_GROUP"){&#13;&#10;    	sqlTrans = escape("select userGroupId as "+id+" ,userGroupName as "+name+" from FCQ_USER_GROUP"); &#13;&#10;    }else  if(tableName == "FCQ_ORG"){&#13;&#10;    	sqlTrans = escape("select sFID as "+id+" ,sFName as "+name+" from FCQ_ORG"); &#13;&#10;    }&#13;&#10;	return sqlTrans;&#13;&#10;}&#13;&#10;function uf_add(){&#13;&#10;	var typeId = dataset2.Field('typeId').Value;&#13;&#10;	var chnname = dataset2.Field('chnname').Value;&#13;&#10;	if(IsSpace(typeId)) {alert("先选择关系类型后，再新增");return;}&#13;&#10;	$eform('打开窗口新增记录');&#13;&#10;	relationType.fnPutvalue(chnname);&#13;&#10;	if(dataset2.oDom.documentElement.childNodes[0].childNodes[0].text == ""){//数据集当前行的xml串是分类下没有记录添加的空行，删掉&#13;&#10;		$id('typeId').value = typeId;&#13;&#10;		uf_refeshDs();&#13;&#10;	}&#13;&#10;}&#13;&#10;</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true toolbar="自定义工具栏" mkbh runsave OtherSave="否" codeheader="DIC" entertype="修改" keyfield="id" userToolbar='<tr rowstate="add"><td>add</td><td>新增</td><td></td><td>uf_add()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>griddel</td><td>删除行且删除记录</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>delType</td><td>删除当前关系分类</td><td>删除关系类型</td><td>uf_deltype()</td><td></td><td></td><td></td><td></td><td></td></tr>' idtype="1" jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" runParams BLONresizeBefore BLONresizeAfter allBrowser="是" useHelp envType="电脑" billtaborder="<root><taborder>grid1</taborder><taborder>relationType</taborder><taborder>typeId</taborder></root>" dj_sn="zk_share_rule" caption="共享规则维护" type="ZK" isfile="是" center="居中" posleft postop poswidth posheight window="有模式窗口" BLONopen="fcpubdata.cardWinUrl='zk_share_rule_card'" BLONopenBefore BLONclose userType alertType="1" isCheckPermit="否" controlno="SKButton:0;SKDBedit:0;checkbox:2;label:2;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:10;text:2;hr:0;checkboxlist:0;radiolist:0;dropdownlist:4;grid:1;dataset:3;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;eblayout:0;test:undefined" contxml="<root><label><id>label2</id></label><text><id>typeId</id></text><dropdownlist><id>relationType</id></dropdownlist><grid><id>grid1</id></grid><dataset><id>dataset2</id></dataset></root>" unselectable="on"><DIV onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 85px; HEIGHT: 15px; TOP: 4px; LEFT: 6px" id=label2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() noWrap controltype="label" inputTag="否" NotBg="否" value="label2">关系类型:</DIV><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 375px; HEIGHT: 252px; TOP: 26px; LEFT: 3px" id=grid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" controltype="grid" dataset="dataset2" canselect="是" autoheight="是" autowidth="是" autoappend="否" readonly="否" SetRowHeight="是" hideVscroll="auto" bodyrowheight="-1" bodyrows="-1" visible="是" hideHscroll="auto" blRowNo="否" titlerowheight titlerows usertitlehtml usertitle="否" iscrosstab="否" crosstabtitle crosstabsumtype="0" crosstabformat rowtitle coltitle rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否" crosstabsql crosstabdatatype="0"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 280px; HEIGHT: 16px; TOP: 0px; LEFT: 78px; ButtonWidth: 10" id=relationType onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_fccode.gif" onchange='bill_onclick("uf_refeshDs();")' controltype="dropdownlist" dataset="dataset2" visible="是" format="      名称     |" xml datasourceName field="chnname" addrow="否" multiselect="否" blnempty="否" blninput="否" isShowTree="0" isTreeNewSql="0" FieldNameList china="类型名" AutoSizeXml="<record id ='relationType'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>百分比设置</WSetType><Width></Width><WExt></WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>百分比设置</HSetType><Height></Height><HExt></HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>" sql="select chnname ,typeId from fcq_relation_dict_type where deleteMark=0 and (useType='共享规则' or useType='共享组织机构')" temptext tempvalue check="2"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 96px; LEFT: 457px" id=dataset2 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" controltype="dataset" datasourceName savetable="FCQ_SHARERULE" fieldtrans="<root><field><name>keyName1</name><trans></trans><rtrans></rtrans><sql></sql></field><field><name>keyName2</name><trans></trans><rtrans></rtrans><sql></sql></field><field><name>chnname</name><trans></trans><rtrans></rtrans><sql></sql></field><field><name>permit1</name><trans></trans><rtrans></rtrans><sql></sql></field><field><name>tbchnname</name><trans></trans><rtrans></rtrans><sql></sql></field></root>" async="否" isSubGrid="否" opensortno="1" pubpara="否" isaddemptyrec="否" submittype="1" submitno="1" issubds="否" idparam="SHA" opensql="select shareid,typeId,typeId as chnname,tbname,tbname as tbchnname,fromId, fromId as fromName,toId,toId as toName,permit,permit as permit1 from fcq_sharerule  where typeid=':{$id('typeId').value}:'" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll formatxml='<root><tr rowstate="add"><td>shareid</td><td>共享规则id</td><td>字符</td><td>11</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>tbname</td><td>表名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add" multisel="是"><td>tbchnname</td><td>表名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>230</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>fromId</td><td>共享id</td><td>字符</td><td></td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>fromName</td><td>来自于</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>400</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>toId</td><td>接受共享id</td><td>字符</td><td>250</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>toName</td><td>共享到</td><td>字符</td><td>250</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>200</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>typeId</td><td>id字段</td><td>字符</td><td>11</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>chnname</td><td>类型名</td><td>字符</td><td>30</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>220</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>permit</td><td>权限类型</td><td>整数</td><td>4</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>permit1</td><td>权限类型</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>120</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' masterdsfield masterds subdsfield saveastable><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 110px; DISPLAY: none; HEIGHT: 20px; TOP: 14px; LEFT: 403px" id=typeId onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() value=id字段 controltype="text" dataset="dataset2" field="typeId" china="id字段"></DIV>