<script>&#13;&#10;var tbname="";&#13;&#10;function uf_init()&#13;&#10;{&#13;&#10;	tbname=fcpubdata.obj.Field('tbname').Value;&#13;&#10;}	&#13;&#10;function uf_open()&#13;&#10;{&#13;&#10;	//labTableName.value=fcpubdata.obj.Field('tbname').Value;&#13;&#10;	labTbchnname.innerText=fcpubdata.obj.Field('tbchnname').Value;&#13;&#10;	SetButtonImage($id("cmdSelect"),fcpubdata.path+"/fceform/css/skins/"+fcpubdata.skins+"/images/ef_run_downarrow.gif");		&#13;&#10;}&#13;&#10;function linkMultiSel()&#13;&#10;{	&#13;&#10;	var  where = "";&#13;&#10;	var ret = SelectSql("select detailxml ,fdname from fc_entitysub where type='取累计汇总' and tbname='"+tbname+"'",1,-1);&#13;&#10;	var oXml = SetDom(ret);&#13;&#10;	if(oXml.documentElement == null){&#13;&#10;		alert(ret);	&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	if(oXml.documentElement.childNodes.length > 0){&#13;&#10;		var oXml1 = SetDom("<root>"+oXml.documentElement.childNodes[0].childNodes[0].text+"</root>");&#13;&#10;		if(oXml1.selectSingleNode("/root/isNotExist").text == "0"){&#13;&#10;			where = " and fdname <> '"+ oXml.documentElement.childNodes[0].childNodes[1].text	+"'"&#13;&#10;		}&#13;&#10;	}&#13;&#10;	var sRet = DjOpen("../../fceform/common/djframe.htm?djsn=multiSel&djtype=ZK",["select fdname,chnname  from fc_entitysub where  tbname='"+tbname+"' "+where +" order by sortNo",txtRetV1.value],"展现","有模式窗口","直接","选择字段名");	&#13;&#10;	if(IsSpace(sRet) == false)&#13;&#10;	{&#13;&#10;		txtRetV.value=sRet[0];&#13;&#10;		txtRetV1.value=sRet[1];&#13;&#10;		txtRetV.fireEvent("onchange");&#13;&#10;		txtRetV1.fireEvent("onchange");&#13;&#10;		dataset1.Update() ;&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;	&#13;&#10;	&#13;&#10;function uf_checkField(sAlert){	&#13;&#10;	var dsObj = dataset1.oDom.documentElement;&#13;&#10;	var tableName = dataset1.Field('TBNAME').Value;&#13;&#10;	var l=dsObj.childNodes.length-1;&#13;&#10;	var ret = true;&#13;&#10;	for(var i = 0;i<l;i++){&#13;&#10;		var fieldList = dsObj.childNodes[i].childNodes[1].text;	&#13;&#10;		var chnFieldList = dsObj.childNodes[i].childNodes[2].text;&#13;&#10;		if(IsSpace(fieldList) == false){&#13;&#10;			var fieldArr = fieldList.split(",");&#13;&#10;			var chnFieldArr = chnFieldList.split(",");&#13;&#10;			var retXml = SelectSql("select fdname,detailxml,type from fc_entitysub where tbname='"+tableName+"'",1,-1);&#13;&#10;			var oXml = SetDom(retXml);&#13;&#10;			if(oXml.documentElement == null){&#13;&#10;				alert(retXml);&#13;&#10;				ret = false;&#13;&#10;				return ret;	&#13;&#10;			}&#13;&#10;			for(var f=0;f<fieldArr.length;f++){&#13;&#10;				var isRet = uf_check(fieldArr[f],chnFieldArr[f],i,oXml.documentElement)&#13;&#10;				if(isRet == false){&#13;&#10;					ret = false;&#13;&#10;					return ret;&#13;&#10;				}&#13;&#10;			}&#13;&#10;		}&#13;&#10;	}	&#13;&#10;	if(ret == true && sAlert == "1") alert("字段列表信息正常");&#13;&#10;}&#13;&#10;&#13;&#10;function uf_check(selectfield,chnSelectField,i,xmlObj){&#13;&#10;	for(var j = 0;j<xmlObj.childNodes.length;j++){&#13;&#10;		if(selectfield.toUpperCase() == xmlObj.childNodes[j].childNodes[0].text.toUpperCase()){&#13;&#10;			if(xmlObj.childNodes[j].childNodes[2].text != "取累计汇总"){&#13;&#10;				return true;&#13;&#10;			}else {&#13;&#10;				var oXml1 = SetDom("<root>"+xmlObj.childNodes[j].childNodes[1].text+"</root>");&#13;&#10;				if(oXml1.selectSingleNode("/root/isNotExist").text == "0"){&#13;&#10;					alert("第"+(i+1)+"行的字段名："+chnSelectField+"("+selectfield+")在数据库中不存在，请修改");&#13;&#10;					return false;	&#13;&#10;				}else{&#13;&#10;					return true;&#13;&#10;				}&#13;&#10;			}&#13;&#10;		}&#13;&#10;		&#13;&#10;		if((j == xmlObj.childNodes.length-1) && (selectfield.toUpperCase() != xmlObj.childNodes[j].childNodes[0].text.toUpperCase())){&#13;&#10;			alert("第"+(i+1)+"行的字段名："+chnSelectField+"("+selectfield+")在数据库中不存在，请修改");&#13;&#10;			return false;&#13;&#10;		}&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;function uf_save(){&#13;&#10;	 if(uf_checkField("0") != false) {&#13;&#10;	 	var l=dataset1.oDom.documentElement.childNodes.length-1;&#13;&#10;		for(var i=0;i<l;i++){&#13;&#10;			var listField = dataset1.oDom.documentElement.childNodes(i).childNodes(1).text;&#13;&#10;			if((dataset1.oDom.documentElement.childNodes(i).getAttribute("rowstate") == "edit") && IsSpace(listField)){&#13;&#10;				dataset1.oDom.documentElement.childNodes(i).removeAttribute("rowstate");	&#13;&#10;			}&#13;&#10;		}&#13;&#10;	 	$eform('提交数据成功后刷新上一窗口');&#13;&#10;	 }&#13;&#10;}</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" toolbar="自定义工具栏" BLONopenBefore="uf_init()" BLONclose center="居中" BLONopen="uf_open()" dj_sn="entityQuery" type="ZK" caption="查询表" codeheader keyfield window="有模式窗口" entertype="修改" posleft postop poswidth="642" posheight="330" isfile="是" OtherSave="否" idtype="5" billtaborder="<root><taborder>grid1</taborder><taborder>cmdSelect</taborder><taborder>txtRetV</taborder><taborder>txtRetV1</taborder></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:7;radio:0;listbox:0;textarea:1;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:1;DsMain_field:0;a:0;button:6;text:6;hr:0;checkboxlist:0;radiolist:0;dropdownlist:1;grid:1;dataset:1;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;eblayout:0;test:undefined" contxml="<root><label><id>label1</id><id>label2</id><id>label5</id><id>labTableName</id><id>labTbchnname</id></label><button><id>cmdSelect</id></button><text><id>txtRetV1</id><id>txtRetV</id></text><grid><id>grid1</id></grid><dataset><id>dataset1</id></dataset></root>" userType alertType="1" isCheckPermit="否" useHelp allBrowser="否" BLONresizeAfter BLONresizeBefore unselectable="on" userToolbar="<tr rowstate=&quot;add&quot;><td>ok</td><td>提交数据成功后刷新上一窗口</td><td></td><td>uf_save()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>close</td><td>关闭窗口</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>checkField</td><td></td><td>字段检查</td><td>uf_checkField('1')</td><td></td><td></td><td></td><td></td><td></td></tr>" runsave><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 21px; TOP: 7px; LEFT: 10px" id=label1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否" NotBg="否">表名：</LABEL><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 83px; HEIGHT: 21px; TOP: 7px; LEFT: 270px" id=label2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否" NotBg="否" AutoSizeXml="<record id ='label2'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>百分比设置</WSetType><Width></Width><WExt></WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>百分比设置</HSetType><Height></Height><HExt></HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>">表中文名：</LABEL><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 615px; HEIGHT: 192px; TOP: 28px; LEFT: 9px" id=grid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" controltype="grid" canselect="是" autoheight="否" autowidth="否" autoappend="否" readonly="否" visible="是" SetRowHeight="是" hideHscroll="auto" hideVscroll="auto" blRowNo="否" bodyrowheight="-1" bodyrows="-1" dataset="dataset1" crosstabsql coltitle rowtitle crosstabformat crosstabsumtype="0" crosstabdatatype="0" crosstabtitle usertitlehtml titlerows titlerowheight usertitle iscrosstab="否" rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 155px; LEFT: 665px" id=dataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="5" controltype="dataset" async="否" datasourceName opensortno="1" issubds="否" savetable="FC_QUERY" submitno="1" submittype="1" isaddemptyrec="否" pubpara="否" saveastable isSubGrid="否" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll idparam formatxml='<root><tr rowstate="add"><td>TBNAME</td><td>表名</td><td>字符</td><td>50</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>fdlist</td><td>字段名列表</td><td>字符</td><td>2000</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>268</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>fdchnlist</td><td>字段中文名列表</td><td>字符</td><td>3000</td><td></td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>410</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>TYPE</td><td>类型</td><td>字符</td><td>16</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>typecode</td><td>中文类型</td><td>字符</td><td>30</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>170</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' masterdsfield masterds subdsfield opensql="select sortNo,&#13;&#10;case when fc_datadict.code  is not null then fc_datadict.name end as typecode,&#13;&#10;code as type,&#13;&#10;':{tbname}:' as tbname,&#13;&#10;fdlist,fdchnlist&#13;&#10; from fc_datadict left join fc_query on fc_query.type=fc_datadict.code&#13;&#10;and fc_query.tbname=':{tbname}:'&#13;&#10;where fc_datadict.typename='用途类别' order by  fc_datadict.sortNo" iscreatetable><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="BORDER-BOTTOM: 0px; POSITION: absolute; BORDER-LEFT: 0px; WIDTH: 17px; HEIGHT: 20px; BORDER-TOP: 0px; TOP: 228px; BORDER-RIGHT: 0px; LEFT: 605px" id=cmdSelect onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("linkMultiSel()")' dropstyle="否"></BUTTON><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 516px; DISPLAY: none; HEIGHT: 20px; TOP: 249px; LEFT: 71px" id=txtRetV1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() size=91 controltype="text" dataset="dataset1" field="fdlist" china="字段名列表"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 62px; HEIGHT: 16px; TOP: 232px; LEFT: 12px" id=label5 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否" NotBg="否">字段列表</LABEL><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 534px; HEIGHT: 20px; TOP: 228px; LEFT: 71px" id=txtRetV onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() size=91 controltype="text" dataset="dataset1" field="fdchnlist" china="字段中文名列表"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; FONT-STYLE: normal; WIDTH: 156px; FONT-FAMILY: 宋体; HEIGHT: 15px; TOP: 6px; TEXT-DECORATION: underline; LEFT: 46px" id=labTableName onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否" dataset="dataset1" field="TBNAME" AutoSizeXml="<record id ='labTableName'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>百分比设置</WSetType><Width></Width><WExt></WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>百分比设置</HSetType><Height></Height><HExt></HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>" china="表名"></LABEL> <LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; FONT-STYLE: normal; WIDTH: 254px; FONT-FAMILY: 宋体; HEIGHT: 15px; TOP: 6px; TEXT-DECORATION: underline; LEFT: 345px" id=labTbchnname onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否" AutoSizeXml="<record id ='labTbchnname'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>百分比设置</WSetType><Width></Width><WExt></WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>百分比设置</HSetType><Height></Height><HExt></HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>"></LABEL></DIV>