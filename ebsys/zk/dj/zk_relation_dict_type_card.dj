<script>function uf_save(){//保存后新增&#13;&#10;	if(IsSpace($id('name').value)) {alert('关系类型名称不能为空');return;}&#13;&#10;	var max = "";&#13;&#10;	if(IsSpace(dataset3.Field('typeId').Value)) {max = getMaxNo("REL");}else{max = dataset3.Field('typeId').Value;}&#13;&#10;	var table1 = $id('table1').value;&#13;&#10;	var table2 = $id('table2').value;&#13;&#10;	if(IsSpace($id('selFunc1').value) && IsSpace($id('sql1').value)){alert("表一的选择函数或表一的sql语句必须要输入或选择一个");return;}&#13;&#10;	if(IsSpace($id('selFunc2').value) && IsSpace($id('sql2').value)){alert("表二的选择函数或表二的sql语句必须要输入或选择一个");return;}&#13;&#10;	if(RepDqMarks($id('selFunc1')) == false) {alert("表一的选择函数中不能有双引号");return;}&#13;&#10;	if(RepDqMarks($id('selFunc2')) == false) {alert("表二的选择函数中不能有双引号");return;}&#13;&#10;	if(RepDqMarks($id('sql1')) == false) {alert("表一的sql语句中不能有双引号");return;}&#13;&#10;	if(RepDqMarks($id('sql2')) == false) {alert("表一的sql语句中中不能有双引号");return;}	&#13;&#10;	$eform('提交数据成功后刷新上一窗口');&#13;&#10;}&#13;&#10;&#13;&#10;function uf_retField(table){&#13;&#10;	if(table == "fcq_role"){&#13;&#10;		return  "roleId";&#13;&#10;	}else 	if(table == "fcq_profile") {&#13;&#10;		return  "profileId";&#13;&#10;	}else	if(table == "fcq_user"){&#13;&#10;		return  "userid";&#13;&#10;	}else	if(table == "fcq_org"){&#13;&#10;		return  "sID";&#13;&#10;	}else	if(table == "fcq_manageType"){&#13;&#10;		return  "id";&#13;&#10;	}else{//在实体子表中查找id字段&#13;&#10;		var r=SqlToField("select fdname from fc_entitysub where type='ID字段' and tbname='"+table+"'");&#13;&#10;		return r;&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;function  uf_getName(){//根据选择的表名自动输入关系词典类型&#13;&#10;	if(IsSpace(uf_getText('table1')) == false || IsSpace(uf_getText('table2')) == false) {&#13;&#10;		$id('name').value = uf_getText('table1') +"==》"+uf_getText('table2') ;	&#13;&#10;		dataset3.Field("chnname").Value = $id("name").value;	&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;function uf_getText(contId){//获取选中控件的text值（表名）&#13;&#10;	var value="";&#13;&#10;	for(i=0;i<$id(contId).length;i++)&#13;&#10;    {&#13;&#10;     	if($id(contId)[i].selected==true) value = $id(contId)[i].innerText;&#13;&#10;    }&#13;&#10;    return value;&#13;&#10;}&#13;&#10;&#13;&#10;function uf_open(){//表单打开后事件&#13;&#10;	new Eform.SysForm().setButtonImage();&#13;&#10;	PropWinOnload();&#13;&#10;	//uf_getName();&#13;&#10;}&#13;&#10;&#13;&#10;function uf_selRelation(){&#13;&#10;	dataset3.Open("select typeId,chnname,tbname1,tbname2,selFunc1,selFunc2,sql1,sql2 from fcq_relation_dict_type where typeid ='"+dataset3.Field('typeId').Value+"'");	&#13;&#10;}&#13;&#10;&#13;&#10;function uf_selFunc(selFunc){&#13;&#10;	&#13;&#10;	SelFunction($id(selFunc));&#13;&#10;	var ret = $id(selFunc).value;&#13;&#10;	if(IsSpace(ret) == false){&#13;&#10;		dataset3.Field(selFunc).Value = ret;&#13;&#10;	}	&#13;&#10;}</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true toolbar="不带工具栏" runParams envType="电脑" useHelp allBrowser="是" BLONresizeAfter BLONresizeBefore jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" isCheckPermit="否" alertType="1" userType userToolbar="<tr rowstate=&quot;add&quot;><td>cmdOk</td><td>保存</td><td>保存后新增</td><td>uf_save()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>cmdClose</td><td>取消</td><td></td><td>$eform('关闭窗口')</td><td></td><td></td><td></td><td></td><td></td></tr>" contxml="<root><label><id>label3</id><id>label2</id><id>lab</id><id>label1</id><id>label4</id><id>label7</id><id>label8</id><id>label9</id><id>label10</id></label><textarea><id>sql1</id><id>sql2</id></textarea><combobox><id>table1</id><id>table2</id><id>combobox3</id></combobox><button><id>cmdDropDown2</id><id>cmdDropDown1</id><id>cmdOk</id><id>cmdClose</id></button><text><id>selFunc1</id><id>selFunc2</id><id>name</id></text><dataset><id>dataset3</id></dataset></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:10;radio:0;listbox:0;textarea:3;combobox:3;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:1;SKBILLgrid:0;shape:3;tab:0;div:2;DsMain_field:0;a:0;button:3;text:4;hr:0;checkboxlist:0;radiolist:0;dropdownlist:6;grid:0;dataset:3;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;eblayout:0;test:undefined" billtaborder="<root><taborder>name</taborder><taborder>table1</taborder><taborder>table2</taborder><taborder>cmdDropDown2</taborder><taborder>cmdDropDown1</taborder><taborder>selFunc1</taborder><taborder>selFunc2</taborder><taborder>sql1</taborder><taborder>sql2</taborder><taborder>cmdOk</taborder><taborder>cmdClose</taborder><taborder>combobox3</taborder></root>" BLONclose BLONopenBefore BLONopen="uf_open()" window="有模式窗口" posheight="450" poswidth="500" postop posleft center="居中" isfile="是" type="ZK" caption="添加关系词典类型" dj_sn="zk_relation_dict_type_card" unselectable="on"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 87px; HEIGHT: 19px; TOP: 32px; LEFT: 11px" id=label3 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">关系类型名称</LABEL>&nbsp; <LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 74px; HEIGHT: 19px; TOP: 54px; LEFT: 11px" id=label2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">表一的名称</LABEL><SELECT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 376px; HEIGHT: 21px; TOP: 50px; LEFT: 105px" id=table1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("uf_getName()")' async="否" controltype="combobox" dataset="dataset3" china="表1" field="tbname1" datasourceName tempvalue temptext check="2" sql="select tbname ,tbchnname from fc_entity order by sortNo"></SELECT><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 93px; HEIGHT: 30px; TOP: 79px; LEFT: 11px" id=lab onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">表一的选择函数</LABEL><INPUT style="POSITION: absolute; TEXT-ALIGN: left; BACKGROUND-COLOR: #ffffff; WIDTH: 357px; DISPLAY: block; HEIGHT: 16px; FONT-SIZE: 12px; TOP: 77px; LEFT: 105px" id=selFunc1 size=1 controltype="text" dataset="dataset3" china="函数1" field="selFunc1"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 81px; HEIGHT: 18px; TOP: 192px; LEFT: 12px" id=label1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">表二的名称</LABEL><SELECT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 377px; HEIGHT: 21px; TOP: 188px; LEFT: 105px" id=table2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("uf_getName()")' async="否" controltype="combobox" dataset="dataset3" china="表2" field="tbname2" datasourceName tempvalue temptext check="2" sql="select tbname ,tbchnname from fc_entity order by sortNo"></SELECT><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 92px; HEIGHT: 19px; TOP: 217px; LEFT: 12px" id=label4 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">表二的选择函数</LABEL><INPUT style="POSITION: absolute; TEXT-ALIGN: left; BACKGROUND-COLOR: #ffffff; WIDTH: 357px; DISPLAY: block; HEIGHT: 16px; FONT-SIZE: 12px; TOP: 215px; LEFT: 105px" id=selFunc2 size=1 controltype="text" dataset="dataset3" china="函数2" field="selFunc2"><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="BORDER-BOTTOM: 0px; POSITION: absolute; BORDER-LEFT: 0px; BACKGROUND-COLOR: #d4d0c8; WIDTH: 17px; DISPLAY: block; BACKGROUND-REPEAT: no-repeat; FONT-FAMILY: ; HEIGHT: 18px; FONT-SIZE: 12px; BORDER-TOP: 0px; TOP: 215px; BORDER-RIGHT: 0px; LEFT: 465px" id=cmdDropDown2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" dropstyle="是" fc_onclick="bill_onclick(&quot;uf_selFunc('selFunc2')&quot;)"></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="BORDER-BOTTOM: 0px; POSITION: absolute; BORDER-LEFT: 0px; BACKGROUND-COLOR: #d4d0c8; WIDTH: 17px; DISPLAY: block; BACKGROUND-REPEAT: no-repeat; FONT-FAMILY: ; HEIGHT: 18px; FONT-SIZE: 12px; BORDER-TOP: 0px; TOP: 77px; BORDER-RIGHT: 0px; LEFT: 464px" id=cmdDropDown1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" dropstyle="是" fc_onclick="bill_onclick(&quot;uf_selFunc('selFunc1')&quot;)"></BUTTON><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 94px; HEIGHT: 21px; TOP: 103px; LEFT: 11px" id=label7 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">表一的选择sql</LABEL><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 96px; HEIGHT: 30px; TOP: 240px; LEFT: 12px" id=label8 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">表二的选择sql</LABEL><TEXTAREA onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 372px; HEIGHT: 74px; TOP: 102px; LEFT: 105px" id=sql1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() rows=1 cols=53 controltype="textarea" dataset="dataset3" china="sql1" field="sql1" induce="否" value="textarea1">sql1</TEXTAREA><TEXTAREA onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 373px; HEIGHT: 85px; TOP: 240px; LEFT: 105px" id=sql2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() cols=53 controltype="textarea" dataset="dataset3" china="sql2" field="sql2" induce="否" value="textarea2">sql2</TEXTAREA><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 82px; LEFT: 493px" id=dataset3 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idparam="REL" async="否" savetable="fcq_relation_dict_type" isSubGrid="否" issubds="否" submitno="1" submittype="2" isaddemptyrec="否" opensortno="1" pubpara="否" controltype="dataset" idtype="1" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll datasourceName formatxml='<root><tr rowstate="add"><td>typeId</td><td>id</td><td>字符</td><td>11</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>chnname</td><td>关系类型名称</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>tbname1</td><td>表1</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>tbname2</td><td>表2</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>selFunc1</td><td>函数1</td><td>字符</td><td>300</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>selFunc2</td><td>函数2</td><td>字符</td><td>300</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>sql1</td><td>sql1</td><td>字符</td><td>500</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>sql2</td><td>sql2</td><td>字符</td><td>500</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>useType</td><td>用途分类</td><td>字符</td><td>20</td><td>0</td><td>数据项</td><td>多对多关系</td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>deleteMark</td><td>新建字段</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td>0</td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' masterdsfield masterds subdsfield opensql="select * from fcq_relation_dict_type where typeid =':{fcpubdata.obj.Field('typeId').Value}:'" saveastable fieldtrans="<root><field><name>selFunc1</name><trans></trans><rtrans>unescape%28%24f_value%28%27selFunc1%27%29%29</rtrans><sql></sql></field><field><name>selFunc2</name><trans></trans><rtrans>unescape%28%24f_value%28%27selFunc2%27%29%29</rtrans><sql></sql></field><field><name>sql1</name><trans></trans><rtrans>unescape%28%24f_value%28%27sql1%27%29%29</rtrans><sql></sql></field><field><name>sql2</name><trans></trans><rtrans>unescape%28%24f_value%28%27sql2%27%29%29</rtrans><sql></sql></field></root>"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; FONT-STYLE: normal; WIDTH: 386px; FONT-FAMILY: 宋体; HEIGHT: 53px; COLOR: #808080; TOP: 361px; LEFT: 101px" id=label9 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">表一的选择函数和表一的sql语句都是用来选择表一(数据库中的业务表)的信息的，如果用函数选择表一的信息就选择或输入一个函数名，如果用sql语句选择，就输入一条sql语句。表二的选择函数和表二的sql语句用法是一样的。</LABEL><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 372px; HEIGHT: 16px; TOP: 27px; LEFT: 105px" id=name onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() size=68 controltype="text" dataset="dataset3" china="关系类型名称" field="chnname"><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 2px; LEFT: 7px" id=cmdOk onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_save()")'></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 2px; LEFT: 82px" id=cmdClose onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick="bill_onclick(&quot;$eform('关闭窗口')&quot;)"></BUTTON><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 15px; TOP: 329px; LEFT: 19px" id=label10 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">用途分类</LABEL><SELECT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 373px; HEIGHT: 25px; TOP: 331px; LEFT: 105px" id=combobox3 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() async="否" controltype="combobox" dataset="dataset3" china="用途分类" field="useType" datasourceName tempvalue="多对多关系&#13;&#10;共享规则&#13;&#10;共享组织机构" temptext="多对多关系&#13;&#10;共享规则&#13;&#10;共享组织机构" check="1" sql><OPTION selected value=多对多关系>多对多关系</OPTION><OPTION value=共享规则>共享规则</OPTION><OPTION value=共享组织机构>共享组织机构</OPTION></SELECT></DIV>