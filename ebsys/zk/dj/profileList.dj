<script>&#13;&#10;&#13;&#10;function uf_permitTable()&#13;&#10;{&#13;&#10;	if(dataset1.RecordCount < 1){alert("没有要添加表权限的简档");return}&#13;&#10;	DjOpen("profilesub",dataset1);&#13;&#10;}&#13;&#10;function uf_mainMenu()&#13;&#10;{&#13;&#10;	DjOpen("zk_menu_save");&#13;&#10;	&#13;&#10;}&#13;&#10;function uf_permitUnit()&#13;&#10;{&#13;&#10;	if(dataset1.RecordCount < 1){alert("没有要设置功能点的简档");return}&#13;&#10;	//DjOpen("zk_unit_permit",dataset1);&#13;&#10;	var selUnit = uf_open();	&#13;&#10;	if(selUnit == "ok"){&#13;&#10;		uf_save(dataset2.Field('id').Value.split(","),dataset1.Field('profileId').Value);&#13;&#10;	}&#13;&#10;	&#13;&#10;	&#13;&#10;	function uf_open()&#13;&#10;	{&#13;&#10;		var profile = dataset1.Field('profileid').Value;&#13;&#10;		var str = "";&#13;&#10;		var sql = "select FCQ_UNIT.id,name from  FCQ_UNIT left join fcq_profilesub on FCQ_UNIT.id = fcq_profilesub.detail where fcq_unit.deleteMark <> 1 and fcq_profilesub.profileid='"+profile+"'";&#13;&#10;		dataset2.Open(sql);&#13;&#10;		if(dataset1.oDom.documentElement.childNodes.length > 1){&#13;&#10;			var l=dataset2.oDom.documentElement.childNodes.length-1;&#13;&#10;			for(var i=0;i<l;i++)&#13;&#10;			{&#13;&#10;				var id=dataset2.oDom.documentElement.childNodes(i).childNodes(0).text;&#13;&#10;				str+=id+",";	&#13;&#10;			}&#13;&#10;		}&#13;&#10;		var r = CommonSelect({&#13;&#10;			width:"600px",&#13;&#10;			height:"660px",&#13;&#10;			istree: 1,//可选项, 弹出窗口中是否有tree控件,其值=0或1.树控件可以单独用,或是和grid,radiolist,checkboxlist组合用,组合用时可以设置树控件的宽度.&#13;&#10;			obj : txtName, //必选项, 用于修改的前一窗口控件对象,包含是grid对象.&#13;&#10;			istreenewsql:1,&#13;&#10;	        idfieldname : "id", //可选项, 前一窗口的id字段名,用于按字段同名传递数据.只在isgrid!=1时才有效.&#13;&#10;			textfieldname : "name", //可选项, 前一窗口的text字段名,用于按字段同名传递数据.只在isgrid!=1时才有效&#13;&#10;			ismultisel : 1, //,//可选项, 是否多选,其值=0或1.&#13;&#10;	        selectedvalue : str ,//可选项,多选时,已选中的值,会用已选中的值来初始化弹出的选择输入窗口.&#13;&#10;			//roottext: "功能点", //树控件的根节点文本&#13;&#10;			sql : "select id,parentId,name ,id from  FCQ_UNIT where deleteMark=0 and modulexml is null and(winSize  is null or winSize='')  order by sortNo"  //必选项, 弹出窗口的显示数据用的SQL语句.&#13;&#10;		})	&#13;&#10;		&#13;&#10;		return r ;&#13;&#10;	}&#13;&#10;	&#13;&#10;	&#13;&#10;	function uf_save(unitIdArr,profile)&#13;&#10;	{&#13;&#10;		//var formtype=1;//1表单2报表&#13;&#10;		var sRet="";&#13;&#10;		//var unitname=GetDivCheckBoxValue(cheUnitName,'');&#13;&#10;		var sql = "select id,fromType from fcq_unit";&#13;&#10;		var xmlRet = SelectSql(sql,1,-1);&#13;&#10;		var oXml = SetDom(xmlRet);&#13;&#10;		if (oXml.documentElement == null) {&#13;&#10;		    alert(xmlRet);&#13;&#10;		    return;&#13;&#10;		}&#13;&#10;		&#13;&#10;		for(var i=0;i<unitIdArr.length;i++)&#13;&#10;		{&#13;&#10;			 var len = oXml.documentElement.childNodes.length - 1;&#13;&#10;             for (var j = 0; j < len; j++) {&#13;&#10;             	if(oXml.documentElement.childNodes[j].childNodes[0].text == unitIdArr[i]){//当前选中的功能点id等于功能点fcq_unit表中中的id，就获取功能点类型&#13;&#10;					sRet +="<insert tableName='FCQ_PROFILESUB'> <names>id,profileid,type,detail,permit</names> <values>'"+getMaxNo('PRO')+"','"+profile+"','1','"+unitIdArr[i]+"',1 </values> </insert>";&#13;&#10;				}&#13;&#10;			}&#13;&#10;		}&#13;&#10;		var del="<delete tableName='FCQ_PROFILESUB'><where> profileid = '"+profile +"'</where></delete>"&#13;&#10;		sRet=del+sRet;&#13;&#10;		doSaveData(sRet,function (){alert("保存成功")});&#13;&#10;		&#13;&#10;	}&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_delete(){&#13;&#10;	if(dataset1.RecordCount < 1){alert("没有要删除的记录");return}&#13;&#10;	$eform('标记方式删除')	&#13;&#10;}&#13;&#10;function uf_edit(){&#13;&#10;	if(dataset1.RecordCount < 1){alert("没有要修改的记录");return}&#13;&#10;	$eform('打开窗口修改记录');&#13;&#10;}&#13;&#10;&#13;&#10;function uf_contPermit(){&#13;&#10;	DjOpen("zk_control_permit",dataset1);	&#13;&#10;}</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true toolbar="自定义工具栏" BLONopenBefore runsave BLONclose center="  " BLONopen="fcpubdata.cardWinUrl='profileCard'" dj_sn="profileList" type="ZK" caption="用户简档列表" codeheader="QXI" keyfield="id" window="当前窗口" entertype="修改" posleft postop poswidth posheight isfile="是" OtherSave="否" idtype="1" billtaborder="<root><taborder>grid1</taborder><taborder>txtFind</taborder><taborder>txtName</taborder></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:2;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:11;text:3;hr:0;checkboxlist:0;radiolist:0;dropdownlist:0;grid:2;dataset:2;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;eblayout:0;test:undefined" contxml="<root><label><id>label2</id></label><text><id>txtFind</id><id>txtName</id></text><grid><id>grid1</id></grid><dataset><id>dataset1</id><id>dataset2</id></dataset></root>" userType alertType="1" isCheckPermit="否" jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" runParams BLONresizeBefore BLONresizeAfter allBrowser="否" useHelp envType="电脑" unselectable="on" userToolbar="<tr rowstate=&quot;add&quot;><td>add</td><td>新增</td><td></td><td>$eform('打开窗口新增记录')</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>edit</td><td>修改保存</td><td></td><td>uf_edit()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>del</td><td>删除</td><td></td><td>uf_delete()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>cmtTbPermit</td><td></td><td>表操作权限</td><td>uf_permitTable()</td><td>90px</td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>cmdUnitPermit</td><td></td><td>功能点权限</td><td>uf_permitUnit()</td><td>90px</td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>contPermit</td><td></td><td>控件权限</td><td>uf_contPermit()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>query</td><td>查询</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>upmove</td><td>上移</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>downmove</td><td>下移</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 154px; LEFT: 454px" id=dataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" controltype="dataset" opensortno="1" issubds="否" savetable="FCQ_PROFILE" submitno="1" submittype="1" isaddemptyrec="否" pubpara="否" saveastable="FCQ_PROFILE" isSubGrid="否" async="否" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll iscreatetable queryTableName="FCQ_PROFILE" formatxml="<root><tr rowstate=&quot;add&quot;><td>profileId</td><td>简档id</td><td>字符</td><td>11</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>profileName</td><td>角色名称</td><td>字符</td><td>50</td><td></td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>150</td><td></td><td></td><td></td><td></td><td></td><td>$eform('打开窗口修改记录')</td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>ISFIX</td><td>是否固定权限</td><td>整数</td><td>4</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>PUBAPP</td><td>应用程序默认权限</td><td>整数</td><td>4</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>PUBFIELD</td><td>字段的默认权限</td><td>整数</td><td>4</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>PUBIP</td><td>IP范围</td><td>字符</td><td>100</td><td></td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>180</td><td></td><td></td><td></td><td></td><td></td><td>$eform('打开窗口修改记录')</td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>PUBTABLE</td><td>表的默认权限</td><td>整数</td><td>4</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>PUBTIME</td><td>时间范围</td><td>字符</td><td>100</td><td></td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>180</td><td></td><td></td><td></td><td></td><td></td><td>$eform('打开窗口修改记录')</td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>PUBUNIT</td><td>功能点的默认权限</td><td>整数</td><td>4</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>sortNo</td><td>序列号</td><td>整数</td><td>16</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>right</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>deleteMark</td><td>删除标记</td><td>整数</td><td>4</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>right</td><td>80</td><td></td><td></td><td>$valid('整数');</td><td></td><td></td><td></td><td></td><td></td></tr></root>" opensql="select FCQ_PROFILE.* from FCQ_PROFILE where deleteMark <> 1 and profileId <> 'systemadmin ' and profileName LIKE':{txtFind.value}:%' Order By sortNo" subdsfield masterds masterdsfield datasourceName idparam="DDD" fieldtrans="<root><field><name>SORTNO</name><trans></trans><rtrans></rtrans></field></root>"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 343px; HEIGHT: 165px; TOP: 26px; LEFT: 9px" id=grid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" canselect="是" autoheight="是" autowidth="是" autoappend="否" readonly="否" visible="是" SetRowHeight="是" hideHscroll="auto" hideVscroll="auto" blRowNo="否" bodyrowheight="-1" bodyrows="-1" dataset="dataset1" controltype="grid" titlerowheight titlerows usertitlehtml usertitle iscrosstab="否" crosstabtitle crosstabsumtype="0" crosstabformat rowtitle coltitle rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否" crosstabsql crosstabdatatype="0"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 65px; HEIGHT: 15px; TOP: 3px; LEFT: 10px" id=label2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">查找角色</LABEL><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 294px; HEIGHT: 20px; TOP: 0px; LEFT: 80px" id=txtFind onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() size=53 controltype="text"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 173px; LEFT: 672px" id=dataset2 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" controltype="dataset" opensortno="1" issubds="否" savetable submitno="1" submittype="1" isaddemptyrec="否" pubpara="否" saveastable isSubGrid="否" async="否" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll queryTableName="FCQ_UNIT" formatxml='<root><tr rowstate="add"><td>ID</td><td>ID</td><td>字符</td><td>11</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>NAME</td><td>NAME</td><td>字符</td><td>50</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>200</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>type</td><td>类型</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' opensql subdsfield masterds masterdsfield datasourceName idparam><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 272px; DISPLAY: none; HEIGHT: 20px; TOP: 67px; LEFT: 289px" id=txtName onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() value=NAME size=49 dataset="dataset2" controltype="text" china="NAME" field="NAME"></DIV>