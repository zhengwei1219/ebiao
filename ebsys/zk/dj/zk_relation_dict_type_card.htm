<!Doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fc xmlns:v="urn:schemas-microsoft-com:vml">
	<HEAD>
	    <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	    <link rel="stylesheet" type="text/css" href="../../fceform/css/dj.css">
		<STYLE> .userData{behavior:url(#default#userData);}</STYLE>
		<script src="../../fceform/js/MicrosoftAjax.js"></script>
		<script src="../../fceform/js/fcpub.js"></script>
		<script src="../../fceform/js/fcrundj.js"></script>
		<script src="../../fceform/js/tabpane.js"></script>		
	</HEAD>
	<body onload="pub_window_onload()"
		onkeydown="RunTabindex()" onbeforeunload="pub_window_onbeforeunload()" onkeypress="pub_window_onkeypress()"
		onresize="pub_window_onresize()">
		<script>pub_djhtm();</script>
<script>function uf_save(){//保存后新增
	if(IsSpace($id('name').value)) {alert('关系类型名称不能为空');return;}
	var max = "";
	if(IsSpace(dataset3.Field('typeId').Value)) {max = getMaxNo("REL");}else{max = dataset3.Field('typeId').Value;}
	var table1 = $id('table1').value;
	var table2 = $id('table2').value;
	if(IsSpace($id('selFunc1').value) && IsSpace($id('sql1').value)){alert("表一的选择函数或表一的sql语句必须要输入或选择一个");return;}
	if(IsSpace($id('selFunc2').value) && IsSpace($id('sql2').value)){alert("表二的选择函数或表二的sql语句必须要输入或选择一个");return;}
	if(RepDqMarks($id('selFunc1')) == false) {alert("表一的选择函数中不能有双引号");return;}
	if(RepDqMarks($id('selFunc2')) == false) {alert("表二的选择函数中不能有双引号");return;}
	if(RepDqMarks($id('sql1')) == false) {alert("表一的sql语句中不能有双引号");return;}
	if(RepDqMarks($id('sql2')) == false) {alert("表一的sql语句中中不能有双引号");return;}	
	$eform('提交数据成功后刷新上一窗口');
}

function uf_retField(table){
	if(table == "fcq_role"){
		return  "roleId";
	}else 	if(table == "fcq_profile") {
		return  "profileId";
	}else	if(table == "fcq_user"){
		return  "userid";
	}else	if(table == "fcq_org"){
		return  "sID";
	}else	if(table == "fcq_manageType"){
		return  "id";
	}else{//在实体子表中查找id字段
		var r=SqlToField("select fdname from fc_entitysub where type='ID字段' and tbname='"+table+"'");
		return r;
	}
}

function  uf_getName(){//根据选择的表名自动输入关系词典类型
	if(IsSpace(uf_getText('table1')) == false || IsSpace(uf_getText('table2')) == false) {
		$id('name').value = uf_getText('table1') +"==》"+uf_getText('table2') ;	
		dataset3.Field("chnname").Value = $id("name").value;	
	}
}

function uf_getText(contId){//获取选中控件的text值（表名）
	var value="";
	for(i=0;i<$id(contId).length;i++)
    {
     	if($id(contId)[i].selected==true) value = $id(contId)[i].innerText;
    }
    return value;
}

function uf_open(){//表单打开后事件
	new Eform.SysForm().setButtonImage();
	PropWinOnload();
	//uf_getName();
}

function uf_selRelation(){
	dataset3.Open("select typeId,chnname,tbname1,tbname2,selFunc1,selFunc2,sql1,sql2 from fcq_relation_dict_type where typeid ='"+dataset3.Field('typeId').Value+"'");	
}

function uf_selFunc(selFunc){
	
	SelFunction($id(selFunc));
	var ret = $id(selFunc).value;
	if(IsSpace(ret) == false){
		dataset3.Field(selFunc).Value = ret;
	}	
}</script><script src='../../fceform/js/fcopendj.js'></script><script defer src='../../fceform/js/fcsavedj.js'></script><script src='../../fceform/js/fcselfuse.js'></script><script src='../../fceform/js/fcbasecont.js'></script><script defer src='../../fceform/js/fcother.js'></script><script defer src='../../fceform/js/selectdate.js'></script><script src='../../fceform/../fceformext/js/userfunc.js'></script><script src='../../fceform/htc/dataset.js'></script><script src='../../fceform/js/fcdataset.js'></script>
<DIV id=SKbillsheet toolbar="不带工具栏" runParams envType="电脑" useHelp allBrowser="是" BLONresizeAfter BLONresizeBefore jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" isCheckPermit="否" alertType="1" userType userToolbar="<tr rowstate=&quot;add&quot;><td>cmdOk</td><td>保存</td><td>保存后新增</td><td>uf_save()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>cmdClose</td><td>取消</td><td></td><td>$eform('关闭窗口')</td><td></td><td></td><td></td><td></td><td></td></tr>" contxml="<root><label><id>label3</id><id>label2</id><id>lab</id><id>label1</id><id>label4</id><id>label7</id><id>label8</id><id>label9</id><id>label10</id></label><textarea><id>sql1</id><id>sql2</id></textarea><combobox><id>table1</id><id>table2</id><id>combobox3</id></combobox><button><id>cmdDropDown2</id><id>cmdDropDown1</id><id>cmdOk</id><id>cmdClose</id></button><text><id>selFunc1</id><id>selFunc2</id><id>name</id></text><dataset><id>dataset3</id></dataset></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:10;radio:0;listbox:0;textarea:3;combobox:3;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:1;SKBILLgrid:0;shape:3;tab:0;div:2;DsMain_field:0;a:0;button:3;text:4;hr:0;checkboxlist:0;radiolist:0;dropdownlist:6;grid:0;dataset:3;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;eblayout:0;test:undefined" billtaborder="<root><taborder>name</taborder><taborder>table1</taborder><taborder>table2</taborder><taborder>cmdDropDown2</taborder><taborder>cmdDropDown1</taborder><taborder>selFunc1</taborder><taborder>selFunc2</taborder><taborder>sql1</taborder><taborder>sql2</taborder><taborder>cmdOk</taborder><taborder>cmdClose</taborder><taborder>combobox3</taborder></root>" BLONclose BLONopenBefore BLONopen="uf_open()" window="有模式窗口" posheight="450" poswidth="500" postop posleft center="居中" isfile="是" type="ZK" caption="添加关系词典类型" dj_sn="zk_relation_dict_type_card" AutoResizeXml><LABEL style="POSITION: absolute; WIDTH: 87px; HEIGHT: 19px; TOP: 32px; LEFT: 11px" id=label3 onmovestart=moveStart() controltype="label" inputTag="否">关系类型名称</LABEL>&nbsp; <LABEL style="POSITION: absolute; WIDTH: 74px; HEIGHT: 19px; TOP: 54px; LEFT: 11px" id=label2 onmovestart=moveStart() controltype="label" inputTag="否">表一的名称</LABEL><SELECT style="POSITION: absolute; WIDTH: 376px; HEIGHT: 21px; TOP: 50px; LEFT: 105px" id=table1 onmovestart=moveStart() onchange='bill_onclick("uf_getName()")' sqltrans="%F4%D8%E6%D8%D4%F6Xrn%F6%D2%EA%D0%E8%D8XrnXr%94%F6%D2%D4%DE%EA%EA%D0%E8%D8Xrn%DA%F2%EC%E8Xrn%DA%D4%CC%D8%EA%F6%E0%F6%u0100Xrn%EC%F2%D6%D8%F2Xrn%D2%u0100Xrn%F4%EC%F2%F6%AA%EC" async="否" controltype="combobox" dataset="dataset3" china="表1" field="tbname1" datasourceName tempvalue temptext check="2" sql></SELECT><LABEL style="POSITION: absolute; WIDTH: 93px; HEIGHT: 30px; TOP: 79px; LEFT: 11px" id=lab onmovestart=moveStart() controltype="label" inputTag="否">表一的选择函数</LABEL><INPUT style="POSITION: absolute; TEXT-ALIGN: left; BACKGROUND-COLOR: #ffffff; WIDTH: 357px; DISPLAY: block; HEIGHT: 16px; FONT-SIZE: 12px; TOP: 77px; LEFT: 105px" id=selFunc1 size=1 controltype="text" dataset="dataset3" china="函数1" field="selFunc1"><LABEL style="POSITION: absolute; WIDTH: 81px; HEIGHT: 18px; TOP: 192px; LEFT: 12px" id=label1 onmovestart=moveStart() controltype="label" inputTag="否">表二的名称</LABEL><SELECT style="POSITION: absolute; WIDTH: 377px; HEIGHT: 21px; TOP: 188px; LEFT: 105px" id=table2 onmovestart=moveStart() onchange='bill_onclick("uf_getName()")' sqltrans="%F4%D8%E6%D8%D4%F6Xrn%F6%D2%EA%D0%E8%D8XrnXr%94%F6%D2%D4%DE%EA%EA%D0%E8%D8Xrn%DA%F2%EC%E8Xrn%DA%D4%CC%D8%EA%F6%E0%F6%u0100Xrn%EC%F2%D6%D8%F2Xrn%D2%u0100Xrn%F4%EC%F2%F6%AA%EC" async="否" controltype="combobox" dataset="dataset3" china="表2" field="tbname2" datasourceName tempvalue temptext check="2" sql></SELECT><LABEL style="POSITION: absolute; WIDTH: 92px; HEIGHT: 19px; TOP: 217px; LEFT: 12px" id=label4 onmovestart=moveStart() controltype="label" inputTag="否">表二的选择函数</LABEL><INPUT style="POSITION: absolute; TEXT-ALIGN: left; BACKGROUND-COLOR: #ffffff; WIDTH: 357px; DISPLAY: block; HEIGHT: 16px; FONT-SIZE: 12px; TOP: 215px; LEFT: 105px" id=selFunc2 size=1 controltype="text" dataset="dataset3" china="函数2" field="selFunc2"><BUTTON style="BORDER-BOTTOM: 0px; POSITION: absolute; BORDER-LEFT: 0px; BACKGROUND-COLOR: #d4d0c8; WIDTH: 17px; DISPLAY: block; BACKGROUND-REPEAT: no-repeat; FONT-FAMILY: ; HEIGHT: 18px; FONT-SIZE: 12px; BORDER-TOP: 0px; TOP: 215px; BORDER-RIGHT: 0px; LEFT: 465px" id=cmdDropDown2 onmovestart=moveStart() controltype="button" dropstyle="是" onclick="bill_onclick(&quot;uf_selFunc('selFunc2')&quot;)"></BUTTON><BUTTON style="BORDER-BOTTOM: 0px; POSITION: absolute; BORDER-LEFT: 0px; BACKGROUND-COLOR: #d4d0c8; WIDTH: 17px; DISPLAY: block; BACKGROUND-REPEAT: no-repeat; FONT-FAMILY: ; HEIGHT: 18px; FONT-SIZE: 12px; BORDER-TOP: 0px; TOP: 77px; BORDER-RIGHT: 0px; LEFT: 464px" id=cmdDropDown1 onmovestart=moveStart() controltype="button" dropstyle="是" onclick="bill_onclick(&quot;uf_selFunc('selFunc1')&quot;)"></BUTTON><LABEL style="POSITION: absolute; WIDTH: 94px; HEIGHT: 21px; TOP: 103px; LEFT: 11px" id=label7 onmovestart=moveStart() controltype="label" inputTag="否">表一的选择sql</LABEL><LABEL style="POSITION: absolute; WIDTH: 96px; HEIGHT: 30px; TOP: 240px; LEFT: 12px" id=label8 onmovestart=moveStart() controltype="label" inputTag="否">表二的选择sql</LABEL><TEXTAREA style="POSITION: absolute; WIDTH: 372px; HEIGHT: 74px; TOP: 102px; LEFT: 105px" id=sql1 onmovestart=moveStart() rows=1 cols=53 controltype="textarea" dataset="dataset3" china="sql1" field="sql1" induce="否" value="textarea1"></TEXTAREA><TEXTAREA style="POSITION: absolute; WIDTH: 373px; HEIGHT: 85px; TOP: 240px; LEFT: 105px" id=sql2 onmovestart=moveStart() cols=53 controltype="textarea" dataset="dataset3" china="sql2" field="sql2" induce="否" value="textarea2"></TEXTAREA><?xml:namespace prefix = fc /><fc:dataset id=dataset3 idparam="REL" sqltrans="%F4%D8%E6%D8%D4%F6XrnbXrn%DA%F2%EC%E8Xrn%DA%D4%F0%CC%F2%D8%E6%D0%F6%E0%EC%EA%CC%D6%E0%D4%F6%CC%F6%u0100%EE%D8Xrn%FC%DE%D8%F2%D8Xrn%F6%u0100%EE%D8%E0%D6XrnXt%96Xr%7CXt%90X%7C%92%DA%D4%EE%F8%D2%D6%D0%F6%D0j%EC%D2%E2j%9A%E0%D8%E6%D6Xr%7EXr%7C%F6%u0100%EE%D8%A0%D6Xr%7CXr%80j%BA%D0%E6%F8%D8X%7C%96Xt%90Xr%7C" async="否" savetable="fcq_relation_dict_type" isSubGrid="否" issubds="否" submitno="1" submittype="2" isaddemptyrec="否" opensortno="1" pubpara="否" onValid='bill_ondatasetvalid("<dsid><typeId></typeId><chnname></chnname><tbname1></tbname1><tbname2></tbname2><selFunc1></selFunc1><selFunc2></selFunc2><sql1></sql1><sql2></sql2><useType></useType><deleteMark></deleteMark></dsid>")' onGetText='bill_ondatasetgettext("<dsid><typeId></typeId><chnname></chnname><tbname1></tbname1><tbname2></tbname2><selFunc1></selFunc1><selFunc2></selFunc2><sql1></sql1><sql2></sql2><useType></useType><deleteMark></deleteMark></dsid>")' onSetText='bill_ondatasetsettext("<dsid><typeId></typeId><chnname></chnname><tbname1></tbname1><tbname2></tbname2><selFunc1></selFunc1><selFunc2></selFunc2><sql1></sql1><sql2></sql2><useType></useType><deleteMark></deleteMark></dsid>")' format="<fields><field><fieldname>typeId</fieldname><datatype>字符</datatype><displaylabel>id</displaylabel><size>11</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>是</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>chnname</fieldname><datatype>字符</datatype><displaylabel>关系类型名称</displaylabel><size>50</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>tbname1</fieldname><datatype>字符</datatype><displaylabel>表1</displaylabel><size>50</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>tbname2</fieldname><datatype>字符</datatype><displaylabel>表2</displaylabel><size>50</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>selFunc1</fieldname><datatype>字符</datatype><displaylabel>函数1</displaylabel><size>300</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>selFunc2</fieldname><datatype>字符</datatype><displaylabel>函数2</displaylabel><size>300</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>sql1</fieldname><datatype>字符</datatype><displaylabel>sql1</displaylabel><size>500</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>sql2</fieldname><datatype>字符</datatype><displaylabel>sql2</displaylabel><size>500</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>useType</fieldname><datatype>字符</datatype><displaylabel>用途分类</displaylabel><size>20</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue>多对多关系</defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>deleteMark</fieldname><datatype>字符</datatype><displaylabel>新建字段</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue>0</defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields>" controltype="dataset" idtype="1" fieldtrans="<root><field><name>selFunc1</name><trans></trans><rtrans>unescape%28%24f_value%28%27selFunc1%27%29%29</rtrans><sql></sql></field><field><name>selFunc2</name><trans></trans><rtrans>unescape%28%24f_value%28%27selFunc2%27%29%29</rtrans><sql></sql></field><field><name>sql1</name><trans></trans><rtrans>unescape%28%24f_value%28%27sql1%27%29%29</rtrans><sql></sql></field><field><name>sql2</name><trans></trans><rtrans>unescape%28%24f_value%28%27sql2%27%29%29</rtrans><sql></sql></field></root>"></fc:dataset><LABEL style="POSITION: absolute; FONT-STYLE: normal; WIDTH: 386px; FONT-FAMILY: 宋体; HEIGHT: 53px; COLOR: #808080; TOP: 361px; LEFT: 101px" id=label9 onmovestart=moveStart() controltype="label" inputTag="否">表一的选择函数和表一的sql语句都是用来选择表一(数据库中的业务表)的信息的，如果用函数选择表一的信息就选择或输入一个函数名，如果用sql语句选择，就输入一条sql语句。表二的选择函数和表二的sql语句用法是一样的。</LABEL><INPUT style="POSITION: absolute; WIDTH: 372px; HEIGHT: 16px; TOP: 27px; LEFT: 105px" id=name onmovestart=moveStart() size=68 controltype="text" dataset="dataset3" china="关系类型名称" field="chnname"><BUTTON style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 2px; LEFT: 7px" id=cmdOk onmovestart=moveStart() controltype="button" onclick='bill_onclick("uf_save()")'></BUTTON><BUTTON style="POSITION: absolute; WIDTH: 75px; HEIGHT: 25px; TOP: 2px; LEFT: 82px" id=cmdClose onmovestart=moveStart() controltype="button" onclick="bill_onclick(&quot;$eform('关闭窗口')&quot;)"></BUTTON><LABEL style="POSITION: absolute; WIDTH: 65px; HEIGHT: 15px; TOP: 329px; LEFT: 19px" id=label10 onmovestart=moveStart() controltype="label" inputTag="否">用途分类</LABEL><SELECT style="POSITION: absolute; WIDTH: 373px; HEIGHT: 25px; TOP: 331px; LEFT: 105px" id=combobox3 onmovestart=moveStart() sqltrans async="否" controltype="combobox" dataset="dataset3" china="用途分类" field="useType" datasourceName tempvalue="多对多关系&#13;&#10;共享规则&#13;&#10;共享组织机构" temptext="多对多关系&#13;&#10;共享规则&#13;&#10;共享组织机构" check="1" sql><OPTION selected value=多对多关系>多对多关系</OPTION><OPTION value=共享规则>共享规则</OPTION><OPTION value=共享组织机构>共享组织机构</OPTION></SELECT></DIV><script>var dataset3=new dataset("dataset3"); </script></body></html>