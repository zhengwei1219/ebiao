<script>//增加子节点&#13;&#10;&#13;&#10;var arrTree=new Array();//树控件中添加到节点&#13;&#10;var profileId = "";//简档id&#13;&#10;var profilName = "";//简档名&#13;&#10;var unitName = "";//功能名称&#13;&#10;function uf_open()&#13;&#10;{&#13;&#10;	SetButtonImage($id("cmdTreeNodeUp"),"../../fceform/images/ef_run_button_up.gif") ;&#13;&#10;	SetButtonImage($id("cmdTreeNodeDown"),"../../fceform/images/ef_run_button_down.gif") ;&#13;&#10;	profileId = fcpubdata.obj.Field('profileid').Value;&#13;&#10;	profilName = fcpubdata.obj.Field('profilename').Value;&#13;&#10;	unitName = fcpubdata.obj.Field('unitname').Value;&#13;&#10;	txtProfileName.value = profilName;&#13;&#10;	if(IsSpace(unitName) == false) droTableName.value=unitName;//如果功能名没有就不赋值&#13;&#10;}&#13;&#10;function profileid(){&#13;&#10;	droTableName.sql1 = "select FCQ_UNIT.id,name from  FCQ_UNIT left join fcq_profilesub on FCQ_UNIT.id = fcq_profilesub.detail where fcq_profilesub.profileid='"+profileId+"'";&#13;&#10;}&#13;&#10;function uf_AddNode()&#13;&#10;{&#13;&#10;	var mAction = "javascript:"+unescape($id("tree1").clicknode);&#13;&#10;	if(Global.selectedItem == null)&#13;&#10;	{&#13;&#10;		alert("请选择要删除的节点！");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	if(Global.selectedItem != null)&#13;&#10;	{&#13;&#10;		var pos = Global.selectedItem.childNodes.length ;&#13;&#10;		var obj = new xtreeItem("","功能节点",mAction,"","","","","");&#13;&#10;		arrTree[arrTree.length]=obj;&#13;&#10;		Global.selectedItem.add(obj);&#13;&#10;	}&#13;&#10;	else&#13;&#10;	{&#13;&#10;		window.alert("请选择要增加节点的位置！");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;}&#13;&#10;//删除节点&#13;&#10;function uf_DelNode()&#13;&#10;{&#13;&#10;	if(Global.selectedItem == null)&#13;&#10;	{&#13;&#10;		alert("请选择要删除的节点！");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	if(Global.selectedItem == Global.selectedItem.root())&#13;&#10;	{&#13;&#10;		alert("不能删除根节点！");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	//var sId = Global.selectedItem.id;&#13;&#10;	//Global.selectedItem.code="del";&#13;&#10;	Global.selectedItem.remove(Global.selectedItem); &#13;&#10;	//alert(Global.all[sId]==null)	&#13;&#10;}&#13;&#10;//修改保存&#13;&#10;function uf_edit()&#13;&#10;{&#13;&#10;	if(Global.selectedItem == null)&#13;&#10;	{&#13;&#10;		alert("请选择要修改保存的节点！");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	Global.selectedItem.setText(droTableName.value);&#13;&#10;	Global.selectedItem.code = txtUrl.value;&#13;&#10;	Global.selectedItem.title = droTableName.value;&#13;&#10;}&#13;&#10;//保存&#13;&#10;function uf_save()&#13;&#10;{&#13;&#10;	if(uf_validate()) return;//ret=='false'有未添加功能的节点就返回&#13;&#10;	var treeNodeX = tree1.getNodeXml();&#13;&#10;	var menuDesign = escape(treeNodeX);&#13;&#10;	treeNodeX=RepStr(treeNodeX,'target="_parent"',' target="rightWin"');&#13;&#10;    var menuRunning = escape(RepStr(treeNodeX,' code="',' href="'));&#13;&#10;	var xmlSql = "<update tableName='FCQ_PROFILE'>"+"<set>menuDesign='"+menuDesign+"',menuRunning='"+menuRunning+"' </set>"+" <where>   profileId='"+profileId+"'</where>"+"</update>";&#13;&#10;	doSaveData(xmlSql);&#13;&#10;}&#13;&#10;//增加节点&#13;&#10;function uf_insertNode(bAfter) {&#13;&#10;	if(Global.selectedItem == null)&#13;&#10;	{&#13;&#10;		alert("请选择要增加节点的位置！");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	if(Global.selectedItem == Global.selectedItem.root())&#13;&#10;	{&#13;&#10;		alert("不能增加根节点！");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	if(Global.selectedItem != null)&#13;&#10;	{&#13;&#10;		var mAction = "javascript:"+unescape($id("tree1").clicknode);&#13;&#10;		var obj= new xtreeItem("","功能节点",mAction,"","","","","");&#13;&#10;		arrTree[arrTree.length]=obj&#13;&#10;		Global.selectedItem.insert(obj,bAfter);&#13;&#10;	}&#13;&#10;	else&#13;&#10;	{&#13;&#10;		window.alert("请选择要增加节点的位置！");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	&#13;&#10;}&#13;&#10;//取出树控件的xml数据&#13;&#10;function uf_openTree()&#13;&#10;{&#13;&#10;	var sql = "select menuDesign from FCQ_PROFILE where profileId='"+profileId+"'";&#13;&#10;	var sqlRet = SqlToField(sql);&#13;&#10;	tree1.loadXmlStr(unescape(sqlRet));&#13;&#10;	tree1.expand();&#13;&#10;}&#13;&#10;&#13;&#10;//取fcq_unit表的url字段的值&#13;&#10;function uf_url(){&#13;&#10;	var sSql = "select url from fcq_unit where id='"+txtId.value+"'";&#13;&#10;	var sqlRet = SqlToField(sSql);&#13;&#10;	if(IsSpace(sqlRet) == false) sqlRet = "&" + sqlRet;&#13;&#10;	txtUrl.value = "javascript:loadUrl('"+sqlRet+"')";&#13;&#10;&#13;&#10;}&#13;&#10;//查看是否给节点添加了功能&#13;&#10;function uf_validate()&#13;&#10;{&#13;&#10;	//tree1.FindNode(tree1,"code","")&#13;&#10;	tree1.FindNode(tree1,"text","功能点");&#13;&#10;	if(Global.selectedItem == Global.selectedItem.root())&#13;&#10;	{&#13;&#10;		if(Global.selectedItem.getFirstChild().text == "功能点")&#13;&#10;		{&#13;&#10;			alert("没有可保存的信息")&#13;&#10;			return true;&#13;&#10;		}&#13;&#10;	}&#13;&#10;	for(var i=0;i<arrTree.length;i++)&#13;&#10;	{&#13;&#10;		//alert(arrTree[i]==null);&#13;&#10;		//alert(arrTree[i].id);&#13;&#10;		if(Global.all[arrTree[i].id] == null) continue;&#13;&#10;		if(arrTree[i].code == "")&#13;&#10;		{&#13;&#10;			alert("请给没有添加功能的节点，在下拉列表中增加功能");&#13;&#10;			return true;&#13;&#10;		}&#13;&#10;	}	&#13;&#10;	return false;&#13;&#10;}&#13;&#10;//取消简档FCQ_PROFILE表的menuDesign，menuDesign字段值。&#13;&#10;function uf_delete()&#13;&#10;{&#13;&#10;	var xmlSql = "<update tableName='FCQ_PROFILE'>"+"<set>menuDesign='',menuRunning='' </set>"+" <where>   profileId='"+profileId+"'</where>"+"</update>";&#13;&#10;	doSaveData(xmlSql);&#13;&#10;	$id("tree1").innerHTML = "";&#13;&#10;	TreeRefresh($id("tree1"),'');&#13;&#10;	tree1.loadXmlStr('<TreeNode id="1" text="功能点1"  target="_self" title="功能点"  icon=""  check="undefined" code=""></TreeNode>');&#13;&#10;	&#13;&#10;}&#13;&#10;//简档名为系统管理员时，显示提示信息；&#13;&#10;function uf_systemAdmini(){&#13;&#10;	if(profileId == "systemadmin"){labCue.style.display="block"};&#13;&#10;}&#13;&#10;//打开默认菜单&#13;&#10;function uf_openDefaultMenu(){&#13;&#10;	$id("tree1").innerHTML = "";&#13;&#10;	TreeRefresh($id("tree1"),'');&#13;&#10;	var sql="select menuDesign from FCQ_PROFILE where profileId='systemadmin'";&#13;&#10;	var sqlRet = SqlToField(sql);&#13;&#10;	tree1.loadXmlStr(unescape(sqlRet));&#13;&#10;	tree1.expand();&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_moveNode(isUp){&#13;&#10;	var oNode = Global.selectedItem;&#13;&#10;	if(oNode != null){&#13;&#10;		oNode.moveNode(isUp);	&#13;&#10;	}&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10; &#13;&#10;</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcstring.js&#13;&#10;fcnumdate.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" unselectable="on" center="居中" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:9;radio:0;listbox:0;textarea:0;combobox:3;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:3;div:0;DsMain_field:0;a:1;button:14;text:7;hr:0;checkboxlist:0;radiolist:0;dropdownlist:2;grid:0;dataset:2;spin:0;excel:0;tree:5;ebshow:0;ebiao:0;layout:0;page:0" posheight="650" poswidth="500" caption="简档权限管理" type="ZK" dj_sn="zk_select_unit" billtaborder="<root><taborder>FCButton8</taborder><taborder>FCButton4</taborder><taborder>FCButton5</taborder><taborder>txtUrl</taborder><taborder>button4</taborder><taborder>button5</taborder><taborder>droTableName</taborder><taborder>txtId</taborder><taborder>button9</taborder><taborder>txtProfileName</taborder><taborder>button12</taborder><taborder>cmdTreeNodeUp</taborder><taborder>cmdTreeNodeDown</taborder></root>" contxml="<root><label><id>label5</id><id>label7</id><id>labCue</id></label><button><id>FCButton8</id><id>FCButton4</id><id>FCButton5</id><id>button4</id><id>button5</id><id>button9</id><id>button12</id><id>cmdTreeNodeUp</id><id>cmdTreeNodeDown</id></button><text><id>txtUrl</id><id>txtId</id><id>txtProfileName</id></text><dropdownlist><id>droTableName</id></dropdownlist><dataset><id>dataset2</id></dataset><tree><id>tree1</id></tree></root>" BLONopen="uf_open();uf_systemAdmini();uf_openTree();" window="当前窗口" posleft postop isfile="是" BLONopenBefore BLONclose userType alertType="1" isCheckPermit="否" toolbar="不带工具栏" idtype="1" mkbh runsave keyfield="sid" entertype="展现" codeheader="CSM" OtherSave="否"><IMG id=tree1 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() style="BORDER-RIGHT: 1px solid; BORDER-TOP: 1px solid; DISPLAY: block; LEFT: 7px; BORDER-LEFT: 1px solid; WIDTH: 320px; BORDER-BOTTOM: 1px solid; POSITION: absolute; TOP: 6px; HEIGHT: 622px" onmovestart=moveStart() src="../../fceform/images/ef_designer_tree.gif" datasourceName controltype="tree" sql=" select NAME,parentid,URL,fromName from FCQ_UNIT" sql2 xml='<TreeNode id="1" text="treeItem" roottarget="_self" rootaction="%20droTableName.value%3DGlobal.selectedItem.text%3B%0D%0A%20txtUrl.value%3DGlobal.selectedItem.code%3B%0D%0A%0D%0A%0D%0A%20%20"  target="_self" title="treeItem"  icon=""  check="undefined" code=""><TreeNode id="2" text="增加节点"  target="_self" title="增加节点"  icon=""  check="undefined" code=""/></TreeNode>' clicknode=" droTableName.value=Global.selectedItem.text;&#13;&#10; txtUrl.value=Global.selectedItem.code;&#13;&#10;&#13;&#10;&#13;&#10;  " roottext="功能点" sourcetype="2" ischecked="否" isAll="是" opentb="_self" xmlpath AutoSizeXml="<record id ='tree1'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>百分比设置</WSetType><Width></Width><WExt></WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>伸缩设置</HSetType><Height></Height><HExt>5</HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>"><BUTTON onmove=move() oncontrolselect=controlselect() id=FCButton8 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="DISPLAY: block; FONT-SIZE: 12px; LEFT: 376px; WIDTH: 123px; FONT-FAMILY: ; POSITION: absolute; TOP: 175px; HEIGHT: 25px; BACKGROUND-COLOR: #d4d0c8" onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("uf_insertNode(true)")' dropstyle="否">增加功能点</BUTTON><BUTTON onmove=move() oncontrolselect=controlselect() id=FCButton4 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="DISPLAY: block; FONT-SIZE: 12px; LEFT: 376px; WIDTH: 123px; FONT-FAMILY: ; POSITION: absolute; TOP: 215px; HEIGHT: 25px; BACKGROUND-COLOR: #d4d0c8" onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("uf_AddNode()")' dropstyle="否">增加子功能点</BUTTON><BUTTON onmove=move() oncontrolselect=controlselect() id=FCButton5 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="DISPLAY: block; FONT-SIZE: 12px; LEFT: 376px; WIDTH: 123px; FONT-FAMILY: ; POSITION: absolute; TOP: 254px; HEIGHT: 25px; BACKGROUND-COLOR: #d4d0c8" onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("uf_DelNode()")' dropstyle="否">删除功能点</BUTTON><INPUT onmove=move() oncontrolselect=controlselect() id=txtUrl onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="DISPLAY: none; LEFT: 620px; WIDTH: 491px; POSITION: absolute; TOP: 90px; HEIGHT: 20px" onmovestart=moveStart() size=78 controltype="text"><BUTTON onmove=move() oncontrolselect=controlselect() id=button4 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="LEFT: 376px; WIDTH: 123px; POSITION: absolute; TOP: 136px; HEIGHT: 25px; BACKGROUND-COLOR: #d2d0ca" onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("uf_insertNode(false)")' dropstyle="否">插入功能点</BUTTON><LABEL onmove=move() oncontrolselect=controlselect() id=label5 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="LEFT: 376px; WIDTH: 82px; COLOR: #0000ff; FONT-STYLE: normal; FONT-FAMILY: 宋体; POSITION: absolute; TOP: 83px; HEIGHT: 20px" onmovestart=moveStart() controltype="label" inputTag="否" NotBg="否">选择功能点</LABEL><IMG id=dataset2 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() style="LEFT: 649px; WIDTH: 39px; POSITION: absolute; TOP: 229px; HEIGHT: 47px" onmovestart=moveStart() src="../../fceform/images/ef_designer_dataset.gif" queryTableName="FCQ_UNIT" formatxml='<root><tr rowstate="add"><td>NAME</td><td>NAME</td><td>字符</td><td>50</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>fromName</td><td>表单sn</td><td>字符</td><td>50</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>ID</td><td>ID</td><td>字符</td><td>11</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' masterdsfield masterds subdsfield idparam opensql datasourceName async="否" AfterScroll BeforeScroll AfterPost BeforePost BeforeOpen AfterOpen issubds="否" savetable submitno="1" submittype="1" isaddemptyrec="否" saveastable pubpara="否" opensortno="1" isSubGrid="否" controltype="dataset" idtype="1"><BUTTON onmove=move() oncontrolselect=controlselect() id=button5 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="DISPLAY: block; FONT-SIZE: 12px; LEFT: 376px; WIDTH: 123px; FONT-FAMILY: ; POSITION: absolute; TOP: 292px; HEIGHT: 25px; BACKGROUND-COLOR: #d4d0c8" onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("uf_save()")' dropstyle="否">保存全部功能点</BUTTON><IMG id=droTableName onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() style="LEFT: 376px; WIDTH: 216px; POSITION: absolute; TOP: 103px; HEIGHT: 20px; ButtonWidth: 10" onmovestart=moveStart() src="../../fceform/images/ef_designer_fccode.gif" datasourceName controltype="dropdownlist" check="2" sql="select FCQ_UNIT.id,name from  FCQ_UNIT left join fcq_profilesub on FCQ_UNIT.id = fcq_profilesub.detail where fcq_profilesub.profileid=':{profileId}:'" tempvalue temptext format="| 选择需要的功能名称 !" china="NAME" xml blninput="是" blnempty="否" addrow="否" multiselect="否" onchange='bill_onclick("uf_url(); uf_edit();")' visible="是" field="NAME" dataset="dataset2"><INPUT onmove=move() oncontrolselect=controlselect() id=txtId onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="DISPLAY: none; LEFT: 475px; WIDTH: 110px; POSITION: absolute; TOP: 55px; HEIGHT: 20px" onmovestart=moveStart() controltype="text" china="ID" field="ID" dataset="dataset2"><LABEL onmove=move() oncontrolselect=controlselect() id=label7 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="LEFT: 376px; WIDTH: 98px; COLOR: #0000ff; FONT-STYLE: normal; FONT-FAMILY: 宋体; POSITION: absolute; TOP: 37px; HEIGHT: 15px" onmovestart=moveStart() controltype="label" inputTag="否" NotBg="否">简档名</LABEL><BUTTON onmove=move() oncontrolselect=controlselect() id=button9 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="LEFT: 376px; WIDTH: 123px; POSITION: absolute; TOP: 329px; HEIGHT: 25px; BACKGROUND-COLOR: #c6c5bb" onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("uf_delete()")' dropstyle="否">删除简档功能</BUTTON><INPUT onmove=move() oncontrolselect=controlselect() id=txtProfileName onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="LEFT: 376px; WIDTH: 214px; POSITION: absolute; TOP: 56px; HEIGHT: 20px" onmovestart=moveStart() readOnly size=38 controltype="text"><BUTTON onmove=move() oncontrolselect=controlselect() id=button12 onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="LEFT: 376px; WIDTH: 122px; POSITION: absolute; TOP: 370px; HEIGHT: 25px; BACKGROUND-COLOR: #cac4b7" onmovestart=moveStart() controltype="button" fc_onclick='bill_onclick("uf_openDefaultMenu()")' dropstyle="否">使用默认菜单</BUTTON><LABEL onmove=move() oncontrolselect=controlselect() id=labCue onresizeend=resizeEnd() onresizestart=resizeStart() onmoveend=moveEnd() onresize=resize() style="DISPLAY: none; LEFT: 606px; WIDTH: 295px; POSITION: absolute; TOP: 50px; HEIGHT: 30px" onmovestart=moveStart() controltype="label" inputTag="否" NotBg="否">简档名为系统管理员时，设计的功能菜单为默认菜单，仅供其他简档名的功能菜单为空时使用。</LABEL><INPUT id=cmdTreeNodeUp style="DISPLAY: block; FONT-SIZE: 12px; LEFT: 340px; WIDTH: 22px; POSITION: absolute; TOP: 210px; HEIGHT: 23px; BACKGROUND-COLOR: #d4d0c8" type=button controltype="button" fc_onclick='bill_onclick("uf_moveNode(true)")' dropstyle="否"><INPUT id=cmdTreeNodeDown style="DISPLAY: block; FONT-SIZE: 12px; LEFT: 340px; WIDTH: 22px; POSITION: absolute; TOP: 238px; HEIGHT: 22px; BACKGROUND-COLOR: #d4d0c8" type=button controltype="button" fc_onclick='bill_onclick("uf_moveNode(false)")' dropstyle="否"></DIV>