<script>// JScript source code&#13;&#10;var xmlSql = "";&#13;&#10;var clickUnitId = ""; //树控件单击的功能点id&#13;&#10;function uf_open() {&#13;&#10;    e_PropWinOnload();&#13;&#10;    uf_openTree();&#13;&#10;    TreeRootNodeHide($id('tree1'), 'none');&#13;&#10;}&#13;&#10;&#13;&#10;function uf_radioValue() {&#13;&#10;    var sql = "select id,name from  FCQ_UNIT where deleteMark=0 and envType='电脑' and (sFName is null or sFName='')"&#13;&#10;    if ($id("cheIsAll").value == "是") sql = "select id,name from  FCQ_UNIT where deleteMark=0 and envType='电脑'"&#13;&#10;    if (IsSpace($id('txtQuery').value) == false) {&#13;&#10;        sql = "select id,name from  FCQ_UNIT where deleteMark=0 and name like'" + $id('txtQuery').value + "%'"&#13;&#10;    }&#13;&#10;    $id('radiolist1').innerHTML = "";&#13;&#10;    DivRadioInitLoad($id('radiolist1'), sql, "", "");&#13;&#10;&#13;&#10;}&#13;&#10;function uf_selAll() {&#13;&#10;    var sql = "select id,name from  FCQ_UNIT where deleteMark=0 "&#13;&#10;    if ($id("cheIsAll").value == "否") sql = "select id,name from  FCQ_UNIT where deleteMark=0 and envType='电脑' and (sFName is null or sFName='')"&#13;&#10;    $id('radiolist1').innerHTML = "";&#13;&#10;    DivRadioInitLoad($id('radiolist1'), sql, "", "");&#13;&#10;}&#13;&#10;function uf_AddNode() {&#13;&#10;	if (Global.selectedItem == null) {&#13;&#10;        alert("请选择要添加子菜单的节点！");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;    if (Global.selectedItem.parent != null && Global.selectedItem.parent.parent != null && Global.selectedItem.parent.parent.parent != null) return alert("最多只能添加到三级菜单");&#13;&#10;&#13;&#10;    if (Global.selectedItem != null) {&#13;&#10;        var sNodeName = GetDivRadioValue(radiolist1, 'text');&#13;&#10;        if (IsSpace(sNodeName) == false) {&#13;&#10;            uf_validOther(Global.selectedItem, sNodeName, "add"); //查看是否是其它选项并加入节点&#13;&#10;            //Global.selectedItem.add(obj);&#13;&#10;            TreeRootNodeHide($id('tree1'), 'none');&#13;&#10;        } /*else {&#13;&#10;            alert("请在右边区域选择菜单功能");&#13;&#10;            return;&#13;&#10;        }*/&#13;&#10;    }&#13;&#10;    else {&#13;&#10;        alert("请选择要增加节点的位置！");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;}&#13;&#10;//删除节点&#13;&#10;function uf_DelNode() {&#13;&#10;    if (Global.selectedItem == null) {&#13;&#10;        alert("请选择要删除的节点！");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;    if (Global.selectedItem == Global.selectedItem.root()) {&#13;&#10;        alert("不能删除根节点！");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;    if (tree1.childNodes.length == 1 && Global.selectedItem.parent.parent == null) { alert("必须保留一个节点"); return } // && tree1.childNodes[0].childNodes.length == 0&#13;&#10;    uf_createSql(Global.selectedItem)//删除节点时生成xml格式的sql语句&#13;&#10;&#13;&#10;    for (var g = 0; g < Global.selectedItem.childNodes.length; g++) {&#13;&#10;        uf_createSql(Global.selectedItem.childNodes[g]);&#13;&#10;    }&#13;&#10;    Global.selectedItem.remove(Global.selectedItem);&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;function uf_createSql(nodeObj) {&#13;&#10;    var nodeCode = nodeObj.code.split(','); //code变成数组&#13;&#10;    if (nodeCode.length > 4) {//超链接是第五个&#13;&#10;        if (IsSpace(nodeCode[4])) {&#13;&#10;            xmlSql += "<delete tableName='fcq_unit'><where>  id= '" + nodeCode[0] + "'</where></delete>"; //删除其他项添加的功能点&#13;&#10;        } else {//修改功能点的父节点和全路径为空&#13;&#10;            xmlSql += "<update tableName='fcq_unit'><set>parentId='',sFName=''</set><where> id = '" + nodeCode[0] + "'</where></update>";&#13;&#10;        }&#13;&#10;    }&#13;&#10;}&#13;&#10;//修改保存&#13;&#10;function uf_edit() {&#13;&#10;    if (Global.selectedItem == null) {&#13;&#10;        alert("请选择要修改的节点！");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;    var arr = new Array();&#13;&#10;    var sNodeName = GetDivRadioValue(radiolist1, 'text');&#13;&#10;    if (IsSpace(sNodeName) == false) {&#13;&#10;        if (sNodeName.indexOf('other|&|', 0) != '-1') {//当前节点的新功能点为其他类型的功能点&#13;&#10;            sNodeName = RepStr(sNodeName, 'other|&|', '');&#13;&#10;            //Global.selectedItem.href = "javascript:void(0)";&#13;&#10;            //Global.selectedItem.code = "";&#13;&#10;            //var unitId = getMaxNo("UNI");&#13;&#10;            //var sortNo = getMaxIntNo("SOR");&#13;&#10;            arr[1] = "";&#13;&#10;            arr[2] = sNodeName;&#13;&#10;            //arr[3] = unitId;&#13;&#10;            arr[3] = "";&#13;&#10;            //xmlSql += "<insert tableName='fcq_unit'>" + "<names>id,name,sortNo,deleteMark</names>" + "<values>'" + unitId + "','" + sNodeName + "'," + sortNo + ",0</values> </insert>";&#13;&#10;        } else {//当前节点的新功能点不是其他类型的功能点&#13;&#10;            //Global.selectedItem.code = uf_url();&#13;&#10;            arr = uf_url();&#13;&#10;            //Global.selectedItem.href = arr[1];&#13;&#10;            //Global.selectedItem.code = arr[1];&#13;&#10;        }&#13;&#10;        if (Global.selectedItem.parent == Global.selectedItem.root()) {//在根节点下的第一级修改&#13;&#10;            uf_createSql(Global.selectedItem); //如果是其他类型功能点就生成deletesql语句，否则生成update语句&#13;&#10;            //Global.selectedItem.code = arr[3] + "," + arr[2] + ",,/" + sNodeName + "," + escape(arr[1]);&#13;&#10;            Global.selectedItem.code = arr[3] + "," + arr[2] + escape($id('txtPosition').value) + ",/" + sNodeName + "," + escape(arr[1]);&#13;&#10;            xmlSql += "<update tableName='fcq_unit'><set>sFName='/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;&#13;&#10;        } else {//不是一级菜单，要获取上级菜单的父id，和全路径名&#13;&#10;            uf_createSql(Global.selectedItem);&#13;&#10;            if (IsSpace(Global.selectedItem.parent.code) == false) parNodeObj = Global.selectedItem.parent.code.split(",");&#13;&#10;            //xmlSql += "<update tableName='fcq_unit'><set>parentId='" + parNodeObj[0] + "',sFName='" + parNodeObj[3] + "/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;            xmlSql += "<update tableName='fcq_unit'><set> sFName='" + parNodeObj[3] + "/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;            //Global.selectedItem.code = arr[3] + "," + arr[2] + "," + parNodeObj[0] + "," + parNodeObj[3] + "/" + arr[2] + "," + escape(arr[1]) ;&#13;&#10;            Global.selectedItem.code = arr[3] + "," + arr[2] + "," + escape($id('txtPosition').value) + "," + parNodeObj[3] + "/" + arr[2] + "," + escape(arr[1]); &#13;&#10;        }&#13;&#10;        Global.selectedItem.setText(sNodeName);&#13;&#10;        if (arr != null && IsSpace(arr[0]) == false) sNodeName = arr[0];&#13;&#10;        Global.selectedItem.setTitle(sNodeName);&#13;&#10;&#13;&#10;        var nodeCode = Global.selectedItem.code.split(','); //code变成数组&#13;&#10;        for (var g = 0; g < Global.selectedItem.childNodes.length; g++) {//修改节点下有子节点&#13;&#10;            var childNode = Global.selectedItem.childNodes[g];&#13;&#10;            var code = childNode.code.split(',')//子节点的code属性值&#13;&#10;            if (code.length > 4) {//新的code属性值id,name parentId,sFName,href&#13;&#10;                xmlSql += "<update tableName='fcq_unit'><set>parentId='" + nodeCode[0] + "',sFName='" + nodeCode[3] + "/" + code[1] + "'</set><where> id = '" + code[0] + "'</where></update>";&#13;&#10;            } else {//以前的只有连接地址&#13;&#10;                var unitId = childNode.code.substring(childNode.code.indexOf("&unitid=") + 8, childNode.code.length)&#13;&#10;                xmlSql += "<update tableName='fcq_unit'><set>parentId='" + nodeCode[0] + "',sFName='" + nodeCode[3] + "/" + childNode.text + "'</set><where> id = '" + unitId + "'</where></update>";&#13;&#10;            }&#13;&#10;        }&#13;&#10;    } else {&#13;&#10;        alert("请在右边区域选择菜单功能");&#13;&#10;    }&#13;&#10;	$id("tree1").setAttribute("rootaction", escape("uf_clickTree(Global.selectedItem.code)"));&#13;&#10;}&#13;&#10;//保存&#13;&#10;function uf_save() {&#13;&#10;    if (tree1.childNodes.length == 0) {&#13;&#10;        alert("没有可保存的节点");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;    //var treeNodeX = tree1.getNodeXml();&#13;&#10;    /*var menuDesign = escape(treeNodeX);&#13;&#10;    var menuRunning = escape(RepStr(treeNodeX,' code="',' href="'));&#13;&#10;    var xmlSql = "<update tableName='FCQ_PROFILE'>"+"<set>menuDesign='"+menuDesign+"',menuRunning='"+menuRunning+"' </set>"+" <where>   profileId='systemadmin'</where>"+"</update>";&#13;&#10;    doSaveData(xmlSql,function(){alert("保存成功")});//*/&#13;&#10;    /*var xmlRet = SelectSql("select id,imgPos from fcq_unit where deleteMark=0", 1, -1);&#13;&#10;    var oXml = SetDom(xmlRet);&#13;&#10;    if (oXml.documentElement == null) {&#13;&#10;    alert(xmlRet1);&#13;&#10;    return;&#13;&#10;    }&#13;&#10;    if (oXml.documentElement.childNodes.length < 1) return;&#13;&#10;    var arr = new Array();&#13;&#10;    for(var x=0;x<oXml.documentElement.childNodes.length-1;x++){&#13;&#10;    arr[oXml.documentElement.childNodes[x].childNodes[0].text] = oXml.documentElement.childNodes[x].childNodes[1].text;	&#13;&#10;    }*/&#13;&#10;    //if (havImgPos == 0) { uf_getImgPos() }; //没有查询过功能点表的图片坐标&#13;&#10;    var menuDesign = tree1.getNodeXml();&#13;&#10;    var menuRunning = "";&#13;&#10;    for (var i = 0; i < tree1.childNodes.length; i++) {&#13;&#10;        menuRunning += tree1.childNodes[i].getMenuXml();&#13;&#10;    }&#13;&#10;    var arrMenu = new Array(menuDesign, menuRunning);&#13;&#10;    var ret = "";&#13;&#10;    for (var ii = 0; ii < arrMenu.length; ii++) {&#13;&#10;        var newXml = arrMenu[ii];&#13;&#10;        var shead = '<?xml version="1.0" encoding="utf-8"?>';&#13;&#10;        var filePath = "<file>" + "/zk/main/admin_design_menu.xml</file>";&#13;&#10;        if (ii == 1) {&#13;&#10;            filePath = "<file>" + "/zk/workflat/MainMenu.xml</file>";&#13;&#10;            newXml = "<root><NavigationBar>" + newXml + "</NavigationBar></root>";&#13;&#10;        }&#13;&#10;        var sxml = filePath + "<text><![" + "CDATA[" + shead + newXml + "]]" + "></text>";&#13;&#10;        ret += savedesignhtml(sxml)&#13;&#10;    }&#13;&#10;    if (ret == "") {&#13;&#10;        //alert("文件保存成功");&#13;&#10;        doSaveData(xmlSql, function() { xmlSql = ""; alert("保存成功"); });&#13;&#10;    } else { alert(ret) }&#13;&#10;&#13;&#10;}&#13;&#10;//增加节点&#13;&#10;function uf_insertNode() {&#13;&#10;    if (Global.selectedItem == null) {&#13;&#10;        alert("请选择要增加节点的位置！");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;    if (Global.selectedItem == Global.selectedItem.root()) {&#13;&#10;        alert("不能增加根节点！");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;&#13;&#10;    if (Global.selectedItem != null) {&#13;&#10;        var sNodeName = GetDivRadioValue(radiolist1, 'text');&#13;&#10;        if (IsSpace(sNodeName) == false) {&#13;&#10;            uf_validOther(Global.selectedItem, sNodeName, "inset"); //查看是否是其它选项并插入节点&#13;&#10;            TreeRootNodeHide($id('tree1'), 'none');&#13;&#10;        } else {&#13;&#10;            alert("请在右边区域选择菜单功能");&#13;&#10;            return;&#13;&#10;        }&#13;&#10;    }&#13;&#10;    else {&#13;&#10;        alert("请选择要增加节点的位置！");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;&#13;&#10;}&#13;&#10;//取出树控件的xml数据&#13;&#10;function uf_openTree() {&#13;&#10;    /*var sql = "select menuDesign from FCQ_PROFILE where profileId='systemadmin'";&#13;&#10;    var sqlRet = SqlToField(sql);&#13;&#10;    tree1.loadXmlStr(unescape(sqlRet));&#13;&#10;    tree1.expand(); //*/&#13;&#10;    var xmlpath = location.protocol + "//" + location.host + fcpubdata.path + "/zk/main/admin_design_menu.xml";&#13;&#10;    //tree1.loadXmlFile(xmlpath);//调用树控件中的装入xml文件生成树也可以用下两行代码把xml文件生成dom对象然后在装入树&#13;&#10;    var oXml = SetDomFile(xmlpath);&#13;&#10;    oXml.documentElement.setAttribute("rootaction", escape("uf_clickTree(Global.selectedItem.code)"));&#13;&#10;    tree1.loadXmlStr(oXml.documentElement.xml);&#13;&#10;    tree1.expand();&#13;&#10;}&#13;&#10;&#13;&#10;//取fcq_unit表的url字段的值&#13;&#10;function uf_url() {&#13;&#10;    var arr = new Array();&#13;&#10;    var sId = GetDivRadioValue(radiolist1);&#13;&#10;    var sSql = "select name,url,fromType,fromName,id,paramUrl,title from fcq_unit where id='" + sId + "'";&#13;&#10;    var xmlRet = SelectSql(sSql, 1, 1);&#13;&#10;    //var sqlRet = SqlToField(sSql);&#13;&#10;    var oXml = SetDom(xmlRet);&#13;&#10;    var name = oXml.documentElement.childNodes(0).childNodes(0).text;&#13;&#10;    var sUrl = oXml.documentElement.childNodes(0).childNodes(1).text;&#13;&#10;    var fromtype = oXml.documentElement.childNodes(0).childNodes(2).text; //判断是表单还是报表&#13;&#10;    var djsn = oXml.documentElement.childNodes(0).childNodes(3).text;&#13;&#10;    var unitId = oXml.documentElement.childNodes(0).childNodes(4).text;&#13;&#10;    var paramUrl = oXml.documentElement.childNodes(0).childNodes(5).text;&#13;&#10;    arr[0] = oXml.documentElement.childNodes(0).childNodes(6).text; //功能点说明&#13;&#10;    if ((fromtype == 1) || (fromtype == 2)) {&#13;&#10;        /*var reportInForm = false; //报表文件在表单中运行&#13;&#10;        if(tbName=='ebr_file' || tbName == 'ebr_m_file' || tbName=='ebr_db' || tbName == 'ebr_m_db') reportInForm = true;&#13;&#10;        if(!(IsSpace(sUrl) == true && reportInForm == false) ){alert("没有表单的路径");return;}&#13;&#10;        //if(reportInForm) paramUrl = unescape(paramUrl);&#13;&#10;        //if(tbName=='ebr_db' || tbName == 'ebr_m_db') paramUrl += "&fromdb=yes";*/&#13;&#10;        sUrl = "../../fceform/common/djframe.htm?djsn=" + djsn + sUrl + paramUrl + "&unitid=" + unitId;&#13;&#10;    }&#13;&#10;    if (fromtype == 3) sUrl = "../../fceform/ereport/ebrun.htm?file=" + djsn + "&fromdb=yes&unitid=" + unitId;&#13;&#10;    if (fromtype == 4) sUrl = "../../fceform/ereport/ebrun.htm?file=/ebfile/" + djsn + "&unitid=" + unitId;&#13;&#10;    if (fromtype == 5) {&#13;&#10;        var link = "?";&#13;&#10;        if (sUrl.indexOf('?') != -1) link = "&";&#13;&#10;        sUrl = sUrl + link + "unitid=" + unitId;&#13;&#10;    }&#13;&#10;    if (fromtype == 6) sUrl = "../../fceform/common/djframe.htm?djsn=" + djsn + sUrl + paramUrl + "&unitid=" + unitId;&#13;&#10;    //sUrl="javascript:zkLoadMod('"+tbName+"','"+sUrl+"')";&#13;&#10;    arr[1] = sUrl;&#13;&#10;    arr[2] = name;&#13;&#10;    arr[3] = unitId;&#13;&#10;    return arr;&#13;&#10;&#13;&#10;}&#13;&#10;function uf_moveNode(isUp) {&#13;&#10;    var oNode = Global.selectedItem;&#13;&#10;    if (oNode != null) {&#13;&#10;        oNode.moveNode(isUp);&#13;&#10;        TreeRootNodeHide($id('tree1'), 'none');&#13;&#10;&#13;&#10;    }&#13;&#10;&#13;&#10;}&#13;&#10;//检查是否是其他选项，nodeName是节点值，addWay是增加节点的方式：子节点或同级节点&#13;&#10;&#13;&#10;function uf_validOther(nodeObj, nodeName, addWay) {&#13;&#10;    var obj;&#13;&#10;    var arr = new Array();&#13;&#10;    //var idNameHrefArr = new Array();//id,父id，名称，全名称，超链接&#13;&#10;    var idNameHrefArr = ""; //id,父id，名称，全名称，超链接&#13;&#10;    var title = "";&#13;&#10;    if (nodeName.indexOf('other|&|', 0) != '-1') {&#13;&#10;        nodeName = RepStr(nodeName, 'other|&|', '');&#13;&#10;        //obj = new xtreeItem("", nodeName, "", "_parent", "", "", "", "");&#13;&#10;        arr[0] = nodeName;&#13;&#10;        arr[1] = "";&#13;&#10;        arr[2] = nodeName;&#13;&#10;        //var unitId = getMaxNo("UNI");&#13;&#10;        //var sortNo = getMaxIntNo("SOR");&#13;&#10;        //xmlSql += "<insert tableName='fcq_unit'>" + "<names>id,name,sortNo,deleteMark</names>" + "<values>'" + unitId + "','" + nodeName + "'," + sortNo + ",0</values> </insert>";&#13;&#10;        //arr[3] = unitId;&#13;&#10;        arr[3] = "";&#13;&#10;    } else {//不是选择其它功能点&#13;&#10;        arr = uf_url();&#13;&#10;    }&#13;&#10;&#13;&#10;    idNameHref = arr[3] + "," + arr[2] + ","; //id + name&#13;&#10;    var nodeObjArr = new Array();&#13;&#10;    if (IsSpace(nodeObj.code) == false) nodeObjArr = nodeObj.code.split(",");&#13;&#10;    var parNodeObj = new Array();&#13;&#10;    $id('txtPosition').value = "";//清空图标坐标&#13;&#10;    if (nodeObj.parent == Global.selectedItem.root()) {//在根节点下增加&#13;&#10;        if (addWay != "add") {//跟节点增加节点&#13;&#10;            //idNameHref += "," + "/" + arr[2]; //parentId sFname&#13;&#10;            idNameHref += $id('txtPosition').value +"," + "/" + arr[2]; //parentId sFname&#13;&#10;            xmlSql += "<update tableName='fcq_unit'><set>sFName='/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;        } else {//根节点加子节点&#13;&#10;            //idNameHref += nodeObjArr[0] + "," + nodeObjArr[3] + "/" + arr[2]; //parentId sFname&#13;&#10;            idNameHref += $id('txtPosition').value + "," + nodeObjArr[3] + "/" + arr[2]; //parentId sFname&#13;&#10;            if (IsSpace(nodeObjArr[0])) nodeObjArr[0] = "";&#13;&#10;            //xmlSql += "<update tableName='fcq_unit'><set>parentId='" + nodeObjArr[0] + "',sFName='" + nodeObjArr[3] + "/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;            xmlSql += "<update tableName='fcq_unit'><set> sFName='" + nodeObjArr[3] + "/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;        }&#13;&#10;    } else {&#13;&#10;        if (addWay != "add") {//节点增加节点&#13;&#10;            if (IsSpace(nodeObj.parent.code) == false) parNodeObj = nodeObj.parent.code.split(",");&#13;&#10;            //idNameHref += parNodeObj[0] + "," + parNodeObj[3] + "/" + arr[2]; //parentId sFname&#13;&#10;            idNameHref += $id('txtPosition').value + "," + parNodeObj[3] + "/" + arr[2]; //parentId sFname&#13;&#10;            if (IsSpace(parNodeObj[0])) parNodeObj[0] = "";&#13;&#10;            //xmlSql += "<update tableName='fcq_unit'><set>parentId='" + parNodeObj[0] + "',sFName='" + parNodeObj[3] + "/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;            xmlSql += "<update tableName='fcq_unit'><set> sFName='" + parNodeObj[3] + "/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;        } else {//节点加子节点&#13;&#10;            //idNameHref += nodeObjArr[0] + "," + nodeObjArr[3] + "/" + arr[2]; //parentId sFname&#13;&#10;            idNameHref += $id('txtPosition').value + "," + nodeObjArr[3] + "/" + arr[2]; &#13;&#10;            if (IsSpace(nodeObjArr[0])) nodeObjArr[0] = "";&#13;&#10;            //xmlSql += "<update tableName='fcq_unit'><set>parentId='" + nodeObjArr[0] + "',sFName='" + nodeObjArr[3] + "/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;        	xmlSql += "<update tableName='fcq_unit'><set> sFName='" + nodeObjArr[3] + "/" + arr[2] + "'</set><where> id = '" + arr[3] + "'</where></update>";&#13;&#10;        }&#13;&#10;    }&#13;&#10;    idNameHref += "," + escape(arr[1]); //href&#13;&#10;    //idNameHref += "," + escape($id('txtPosition').value);//图标坐标&#13;&#10;    if (arr != null && IsSpace(arr[0]) == false) title = arr[0];&#13;&#10;    obj = new xtreeItem("", nodeName, "javascript:uf_clickTree(Global.selectedItem.code);", "_parent", title, "", "", idNameHref);&#13;&#10;&#13;&#10;    if (addWay == "add") {//判断是增加子节点还是同级节点&#13;&#10;        Global.selectedItem.add(obj);&#13;&#10;    } else {&#13;&#10;        Global.selectedItem.insert(obj, true);&#13;&#10;    }&#13;&#10;    //$id("tree1").setAttribute("rootaction", escape("uf_clickTree(Global.selectedItem.code)"));&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_show() {&#13;&#10;    if (Global.selectedItem == null) return alert("先选择主菜单上的功能点");&#13;&#10;    var href = Global.selectedItem.code;&#13;&#10;    var unitId = href.split(",")[0];&#13;&#10;    if (Global.selectedItem.code != "") {&#13;&#10;        DjOpen("../../fceform/common/djframe.htm?djsn=zk_menu_unit&djtype=ZK&unitId=" + unitId);&#13;&#10;    } else {&#13;&#10;        alert("请查看此节点下的功能点");&#13;&#10;    }&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;function uf_editImg() {&#13;&#10;	if (Global.selectedItem == null) {&#13;&#10;        alert("请选择要修改菜单图标的节点！");&#13;&#10;        return;&#13;&#10;    }&#13;&#10;    var ret = DjOpen('zk_set_menu_img', $id('txtPosition').value, '展现');&#13;&#10;    if (IsSpace(ret) == false) {&#13;&#10;        //var xmlSql = "<update tableName='fcq_unit'><set>imgPos='" + ret + "'</set><where> id = '" + clickUnitId + "'</where></update>";&#13;&#10;       //doSaveData(xmlSql); //修改功能点表的坐标&#13;&#10;        //arrImgPos[clickUnitId] = ret; //修改功能点图片坐标数组中的坐标&#13;&#10;         $id('txtPosition').value = ret;&#13;&#10;        var arrCode = Global.selectedItem.code.split(",");&#13;&#10;        Global.selectedItem.code = arrCode[0] + "," + arrCode[1] + "," + escape(ret)+","+arrCode [3]+","+arrCode[4];&#13;&#10;        uf_initImg(ret);&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;function uf_clickTree(sCode) {//单击树控件显示菜单图标&#13;&#10;    var arr = sCode.split(',');&#13;&#10;    var unitId = arr[0];&#13;&#10;    clickUnitId = unitId;&#13;&#10;    // if (havImgPos == 0) { uf_getImgPos() };&#13;&#10;    $id('txtPosition').value = unescape(arr[2]); //给txtPposition控件赋值&#13;&#10;    //if (IsSpace($id('txtPosition').value)) $id('txtPosition').value = "10,9";&#13;&#10;    uf_initImg($id('txtPosition').value);&#13;&#10;}&#13;&#10;function uf_initImg(pos) {&#13;&#10;    var arrPos = pos.split(",");&#13;&#10;    var imgPosX = -40 * parseInt(arrPos[0]) + "px";&#13;&#10;    var imgPosY = -30 * parseInt(arrPos[1]) + "px";&#13;&#10;    if(imgPosX == "NaNpx" && imgPosY == "NaNpx"){&#13;&#10;    	checkedImg.style.cssText="cursor:hand;position:absolute;left:0px;top=0px;";&#13;&#10;    }else{&#13;&#10;    	checkedImg.style.cssText = "cursor:hand;position:absolute;left:0px;top=0px; z-index:1000;background-image:url(../workflat/img/menu-all.png); background-position:" + imgPosX + " " + imgPosY + "; background-repeat:no-repeat; width:16px; height:16px;";&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true toolbar="自定义工具栏" userToolbar='<tr rowstate="add"><td>add</td><td>新增</td><td></td><td>uf_insertNode()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>cmdAddSub</td><td></td><td>添加子</td><td>uf_AddNode()</td><td>52px</td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>edit</td><td>修改保存</td><td></td><td>uf_edit()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>del</td><td>删除</td><td></td><td>uf_DelNode();</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>save</td><td>提交数据成功后提示</td><td></td><td>uf_save()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>upmove</td><td>上移</td><td></td><td>uf_moveNode(true)</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>downmove</td><td>下移</td><td></td><td>uf_moveNode(false)</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>show</td><td></td><td>详细信息</td><td>uf_show()</td><td></td><td></td><td></td><td></td><td></td></tr>' jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcstring.js&#13;&#10;fcnumdate.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;design.js&#13;&#10;~userfunc.js" isCheckPermit="否" alertType="1" userType contxml="<root><checkbox><id>cheIsAll</id></checkbox><label><id>label11</id><id>label13</id><id>label14</id></label><div><id>div4</id><id>checkedImg</id></div><button><id>cmdQuery</id><id>button21</id></button><text><id>txtQuery</id><id>txtPosition</id></text><radiolist><id>radiolist1</id></radiolist><tree><id>tree1</id></tree></root>" controlno="SKButton:0;SKDBedit:0;checkbox:1;label:14;radio:0;listbox:0;textarea:0;combobox:4;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:1;tab:3;div:0;DsMain_field:0;a:1;button:21;text:11;hr:0;checkboxlist:0;radiolist:1;dropdownlist:3;grid:0;dataset:3;spin:0;excel:0;tree:5;ebshow:0;ebiao:0;layout:0;page:0;eblayout:0;test:undefined" billtaborder="<root><taborder>cmdQuery</taborder><taborder>txtQuery</taborder><taborder>cheIsAll</taborder><taborder>button21</taborder><taborder>txtPosition</taborder></root>" idtype="1" OtherSave="否" isfile="是" posheight="720" poswidth="850" postop posleft entertype="展现" window="当前窗口" keyfield="sid" codeheader="CSM" caption="主菜单设置" type="ZK" dj_sn="zk_menu_save" BLONopen="uf_open()" center="  " BLONclose runsave BLONopenBefore unselectable="on" useHelp allBrowser="否" BLONresizeAfter BLONresizeBefore mkbh><IMG onresizeend=resizeEnd() style="BORDER-BOTTOM: 1px solid; POSITION: absolute; BORDER-LEFT: 1px solid; WIDTH: 332px; HEIGHT: 622px; BORDER-TOP: 1px solid; TOP: 24px; BORDER-RIGHT: 1px solid; LEFT: 7px" id=tree1 class=control-border-color onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_tree.gif" controltype="tree" datasourceName sql=" select NAME,parentid,URL,fromName from FCQ_UNIT" xml='<TreeNode id="1" text="" roottarget="_self" rootaction="uf_clickTree%28Global.selectedItem.code%29"  target="_self" title=""  icon=""  check="undefined" code=""/>' sql2 xmlpath opentb="_self" isAll="是" ischecked="否" sourcetype="0" roottext clicknode="uf_clickTree(Global.selectedItem.code)" AutoSizeXml="<record id ='tree1'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>百分比设置</WSetType><Width></Width><WExt></WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>伸缩设置</HSetType><Height>90</Height><HExt>10</HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>">&nbsp; 
<DIV onresizeend=resizeEnd() style="BORDER-BOTTOM: 1px solid; POSITION: absolute; BORDER-LEFT: 1px solid; FONT-STYLE: normal; WIDTH: 777px; FONT-FAMILY: 宋体; HEIGHT: 595px; FONT-SIZE: 12px; OVERFLOW: auto; BORDER-TOP: 1px solid; TOP: 49px; BORDER-RIGHT: 1px solid; LEFT: 344px" id=radiolist1 class=control-border-color onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="radiolist" async="否" datasourceName sql="select id,name from  FCQ_UNIT where deleteMark=0 and (sFName is null or sFName='')" check="2" temptext tempvalue other="是" rows="3" AutoSizeXml="<record id ='radiolist1'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>伸缩设置</WSetType><Width></Width><WExt>10</WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>伸缩设置</HSetType><Height></Height><HExt>10</HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>">radiolist</DIV><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 71px; FONT-FAMILY: 宋体; HEIGHT: 21px; COLOR: #000040; FONT-SIZE: 16px; TOP: 2px; FONT-WEIGHT: bold; LEFT: 7px" id=label11 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">主菜单</LABEL><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 127px; FONT-FAMILY: 宋体; HEIGHT: 19px; COLOR: #000040; FONT-SIZE: 16px; TOP: 2px; FONT-WEIGHT: bold; LEFT: 348px" id=label13 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">选择菜单功能</LABEL><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 309px; HEIGHT: 20px; TOP: 25px; LEFT: 344px" id=txtQuery onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() size=55 controltype="text" fc_onkeydown='bill_onkeydown("uf_radioValue()")'><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 63px; HEIGHT: 25px; TOP: 24px; LEFT: 657px" id=cmdQuery onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_radioValue()")'></BUTTON> 
<DIV onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 80px; HEIGHT: 20px; TOP: 24px; LEFT: 748px" id=cheIsAll onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() noWrap controltype="checkbox" fc_onclick='bill_onclick("uf_selAll()")' value="否" truevalue="是" falsevalue="否"><INPUT oncontrolselect=controlselectcancel() type=checkbox><SPAN>显示全部功能点</SPAN></DIV><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 69px; HEIGHT: 21px; TOP: 29px; LEFT: 892px" id=label14 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" inputTag="否">菜单图标：</LABEL> 
<DIV onresizeend=resizeEnd() oncontrolselect=controlselect() style="BORDER-BOTTOM: 1px solid; POSITION: absolute; BORDER-LEFT: 1px solid; WIDTH: 18px; HEIGHT: 18px; BORDER-TOP: 1px solid; TOP: 25px; BORDER-RIGHT: 1px solid; LEFT: 949px" id=div4 onresize=resize() onmove=move() class=control-border-color onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="div">
<DIV onresizeend=resizeEnd() oncontrolselect=controlselect() style="BORDER-BOTTOM: 1px solid; POSITION: absolute; BORDER-LEFT: 1px solid; WIDTH: 18px; HEIGHT: 18px; BORDER-TOP: 1px solid; TOP: 0px; BORDER-RIGHT: 1px solid; LEFT: 0px" id=checkedImg onresize=resize() onmove=move() class=control-border-color onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="div"></DIV></DIV><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 63px; HEIGHT: 25px; TOP: 23px; LEFT: 990px" id=button21 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_editImg()")'>修改图标</BUTTON><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 73px; HEIGHT: 20px; TOP: 3px; LEFT: 810px" id=txtPosition onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() size=13 controltype="text"></DIV>