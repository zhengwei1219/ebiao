<script>function uf_open(){&#13;&#10;	TreeRootNodeHide($id('tree1'), 'none');&#13;&#10;}&#13;&#10;&#13;&#10;function uf_clickTree(nodeValue){&#13;&#10;	var sWhere = "where  deleteMark <> 1 and parentid='"+nodeValue+"'order by sortNo";&#13;&#10;	if(IsSpace(nodeValue) == true)   sWhere = "where  deleteMark <> 1 and parentid is null order by sortNo";&#13;&#10;	dataset1.Open("select roleid,parentid,rolename,roleid,sortno from FCQ_ROLE  "+sWhere);&#13;&#10;}&#13;&#10; &#13;&#10;function uf_deleteMark(){&#13;&#10;	if(IsSpace(grid1.Row) == false){&#13;&#10;		var ret = window.confirm("确定删除当前行信息吗？");	&#13;&#10;		if(ret == false) return;&#13;&#10;		var xmlSql= "<update tableName='fcq_role'><set>deleteMark=1</set><where> roleid='"+dataset1.Field('roleid').Value+"' or parentid='"+dataset1.Field('roleid').Value+"'</where> </update>"&#13;&#10;		doSaveData(xmlSql,function (){alert("删除成功");$id("tree1").innerHTML="";TreeRefresh($id("tree1"));TreeRootNodeHide($id('tree1'), 'none');});&#13;&#10;		uf_clickTree(dataset1.Field('parentid').Value);&#13;&#10;		tree1.FindNode(tree1,"code",dataset1.Field('parentid').Value);&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;function uf_moveUp(isUp){&#13;&#10;	if(IsSpace(grid1.Row) == false){&#13;&#10;		if(isUp == true){&#13;&#10;			GridChangeRowSort(true,grid1);&#13;&#10;		}else{&#13;&#10;			GridChangeRowSort(false,grid1);&#13;&#10;		}&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_add(){&#13;&#10;	$eform('打开窗口新增记录');&#13;&#10;	$id("tree1").innerHTML="";&#13;&#10;	TreeRefresh($id("tree1"));&#13;&#10;	TreeRootNodeHide($id('tree1'), 'none');&#13;&#10;	uf_clickTree(dataset1.Field('parentid').Value);&#13;&#10;	//tree1.FindNode(tree1,"text","库房二部");&#13;&#10;	tree1.FindNode(tree1,"code",dataset1.Field('parentid').Value)&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;function uf_updata(){&#13;&#10;	if(IsSpace(grid1.Row) == false){&#13;&#10;		$eform('打开窗口修改记录');&#13;&#10;		$id("tree1").innerHTML="";&#13;&#10;		TreeRefresh($id("tree1"));&#13;&#10;		TreeRootNodeHide($id('tree1'), 'none');	&#13;&#10;		uf_clickTree(dataset1.Field('parentid').Value);&#13;&#10;		//tree1.FindNode(tree1,"text","库房二部");&#13;&#10;		tree1.FindNode(tree1,"code",dataset1.Field('parentid').Value)&#13;&#10;&#13;&#10;	}	&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true toolbar="自定义工具栏" userToolbar='<tr rowstate="add"><td>add</td><td>新增</td><td></td><td>uf_add()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>edit</td><td>修改保存</td><td></td><td>uf_updata()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>del</td><td>删除</td><td></td><td>uf_deleteMark()</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>query</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>upmove</td><td>上移</td><td></td><td>uf_moveUp(true)</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate="add"><td>downmove</td><td>下移</td><td></td><td>uf_moveUp(false)</td><td></td><td></td><td></td><td></td><td></td></tr>' jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcstring.js&#13;&#10;fcnumdate.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" contxml="<root><grid><id>grid1</id></grid><dataset><id>dataset1</id></dataset><tree><id>tree1</id></tree></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:6;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:3;div:0;DsMain_field:0;a:1;button:12;text:5;hr:0;checkboxlist:0;radiolist:0;dropdownlist:0;grid:1;dataset:2;spin:0;excel:0;tree:5;ebshow:0;ebiao:0;layout:0;page:0" isCheckPermit="否" alertType="1" userType BLONclose BLONopenBefore BLONopen="uf_open();fcpubdata.cardWinUrl='fcq_role1';" window="当前窗口" posheight poswidth postop posleft center="  " isfile="是" type="ZK" caption="角色信息" dj_sn="fcq_role" billtaborder="<root><taborder>grid1</taborder></root>" idtype="1" runsave keyfield="sid" entertype="展现" codeheader="CSM" OtherSave="否" mkbh unselectable="on"><IMG onresizeend=resizeEnd() style="BORDER-BOTTOM: 1px solid; POSITION: absolute; BORDER-LEFT: 1px solid; WIDTH: 269px; DISPLAY: block; HEIGHT: 610px; BORDER-TOP: 1px solid; TOP: 0px; BORDER-RIGHT: 1px solid; LEFT: 6px" id=tree1 class=control-border-color onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_tree.gif" controltype="tree" xml='<TreeNode id="1" text="treeItem" roottarget="_self" rootaction=""  target="_self" title="treeItem"  icon=""  check="undefined" code=""><TreeNode id="2" text="增加节点"  target="_self" title="增加节点"  icon=""  check="undefined" code=""/></TreeNode>' opentb="_self" isAll="是" ischecked="否" sourcetype="3" roottext="角色" clicknode=" &#13;&#10;uf_clickTree(Global.selectedItem.code)&#13;&#10; &#13;&#10;&#13;&#10; " sql2="select roleid,parentid,rolename,roleid from FCQ_ROLE where deleteMark <> 1 order by sortNo" datasourceName AutoSizeXml="<record id ='tree1'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>百分比设置</WSetType><Width></Width><WExt></WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>伸缩设置</HSetType><Height></Height><HExt>5</HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>" sql><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 826px; HEIGHT: 373px; TOP: 0px; LEFT: 283px" id=grid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" controltype="grid" dataset="dataset1" canselect="是" autoheight="是" autowidth="是" autoappend="否" readonly="是" SetRowHeight="是" hideVscroll="否" bodyrowheight="-1" bodyrows="-1" visible="是" hideHscroll="auto" blRowNo="否" crosstabdatatype="0" crosstabsql cavg="否" cmax="否" cmin="否" csum="否" ccount="否" ravg="否" rmax="否" rmin="否" rsum="否" rcount="否" coltitle rowtitle crosstabformat crosstabsumtype="0" crosstabtitle iscrosstab="否" usertitle usertitlehtml titlerows titlerowheight><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 405px; LEFT: 932px" id=dataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" savetable="FCQ_ROLE" idparam issubds="否" submitno="1" submittype="1" isaddemptyrec="否" saveastable pubpara="否" opensortno="1" isSubGrid="否" controltype="dataset" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll datasourceName formatxml="<root><tr rowstate=&quot;add&quot;><td>deleteMark</td><td>删除标记</td><td>整数</td><td>4</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>right</td><td>80</td><td></td><td></td><td>$valid('整数');</td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>rolename</td><td>角色名</td><td>字符</td><td>50</td><td></td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>220</td><td></td><td></td><td></td><td></td><td></td><td>uf_updata()</td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>PARENTID</td><td>父id</td><td>字符</td><td>11</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>sortno</td><td>序列号</td><td>整数</td><td>4</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>right</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>ROLEID</td><td>角色id</td><td>字符</td><td>11</td><td></td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>是</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>" opensql subdsfield masterds masterdsfield queryTableName="FCQ_ROLE" async="否"></DIV>