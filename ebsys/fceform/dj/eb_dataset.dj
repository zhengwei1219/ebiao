<script>var obj ;&#13;&#10;//var oXmlConfig;&#13;&#10;function uf_open(){&#13;&#10;	//CopyToPub(dataset1.xml);&#13;&#10;	//return ;&#13;&#10;	obj = fcpubdata.obj[0] ; //t对象&#13;&#10;	var sds = obj.e_datasetbak ; &#13;&#10;	if(IsSpace(sds) == false){&#13;&#10;		var s = dataset1.xml;&#13;&#10;		var pos = s.indexOf("<set><pages>");&#13;&#10;		&#13;&#10;		dataset1.OpenXmlData("<root>"+unescape(sds) +s.substring(pos,s.length));  //"<set><pages>0</pages><fields><field><fieldname>dsname</fieldname><datatype>字符</datatype><displaylabel>名称</displaylabel><size>50</size><precision>0</precision><fieldkind>变量默认值</fieldkind><defaultvalue>'ds'+(mRecordCount+1)</defaultvalue><displayformat></displayformat><isnull>是</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>dstype</fieldname><datatype>字符</datatype><displaylabel>类型</displaylabel><size>12</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue>SQL语句</defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>stext</fieldname><datatype>字符</datatype><displaylabel>SQL语句</displaylabel><size>8000</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid>%28dataset1.Fields.Field%5B%27dstype%27%5D.Value%3D%3D%27SQL%u8BED%u53E5%27%20%26%26%20%20Valid.checkValue%28%27Require%27%2Cdataset1.Fields.Field%5B%27stext%27%5D.Value%29%3D%3Dfalse%29%20%3F%27SQL%u8BED%u53E5%u4E0D%u80FD%u4E3A%u7A7A%21%27%3A%27%27%20</fieldvalid><tag></tag></field><field><fieldname>dsn</fieldname><datatype>字符</datatype><displaylabel>数据源</displaylabel><size>20</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>param</fieldname><datatype>字符</datatype><displaylabel>参数串</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>fieldchn</fieldname><datatype>字符</datatype><displaylabel>字段中文名串</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>beginrow</fieldname><datatype>字符</datatype><displaylabel>开始行</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>endrow</fieldname><datatype>字符</datatype><displaylabel>结束行</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>indexcols</fieldname><datatype>字符</datatype><displaylabel>索引列</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>indexsorted</fieldname><datatype>字符</datatype><displaylabel>排序索引字段</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>indexunique</fieldname><datatype>字符</datatype><displaylabel>唯一的索引字段</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>dsin1</fieldname><datatype>字符</datatype><displaylabel>内置数据集结构</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>dsin2</fieldname><datatype>字符</datatype><displaylabel>内置数据集记录</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>");&#13;&#10;	}else{&#13;&#10;		dataset1.Delete();&#13;&#10;	}&#13;&#10;	e_PropWinOnload();&#13;&#10;	&#13;&#10;	//设置表格中的下拉列表&#13;&#10;	getDsnList(grid1.tab.children[0].children[4]);&#13;&#10;	&#13;&#10;&#13;&#10;}&#13;&#10;// e_dataset="name=ds1,sql=&quot;SELECT sarea,sitem,sperson,imoney &#13;&#10;// FROM e_group1 &quot;,type=normal,dsn=sqlserver1,param=&quot;arg1:6;arg2:9&quot;,beginrow=1,endrow=100,cached=0,&#13;&#10;// fieldText=中草药1:中草药2,&#13;&#10;// indexCols=&quot;aaa,bbb&quot;,indexSorted=true,indexIsUnique=false;&#13;&#10;function uf_ok() {&#13;&#10;	//如未离开当前行则要强行更新.	&#13;&#10;	if(DsBeforeSave(dataset1,grid1)) return;&#13;&#10;	var sDataSource="";&#13;&#10;	var isHaveDefault=false;&#13;&#10;	&#13;&#10;	var sds = new Sys.StringBuilder();&#13;&#10;	var trLen = dataset1.oDom.documentElement.childNodes.length-1 ;&#13;&#10;	for(var i=0;i<trLen;i++){&#13;&#10;		var oo = dataset1.oDom.documentElement.childNodes(i);&#13;&#10;		sds.append("name="+oo.childNodes(0).text+",");&#13;&#10;		if(oo.childNodes(1).text == "内建数据集"){&#13;&#10;			//name=ds2,sql=\"types=\\\"6\\\\t6\\\\t6\\\";data=\\\"\\\\\\\"a\\\\\\\"\\\\t\\\\\\\"c\\\\\\\"\\\\t\\\\\\\"e\\\\\\\"\\\\n\\\\\\\"b\\\\\\\"\\\\t\\\\\\\"d\\\\\\\"\\\\t\\\\\\\"f\\\\\\\"\\\";names=\\\"字段1\\\\t字段2\\\\t字段3\\\"\",type=buildin,cached=0,,indexSorted=false,indexIsUnique=false;&#13;&#10;			//var arrTmp=uf_stru(oo.childNodes(11).text);&#13;&#10;			var sType="";&#13;&#10;			var sName="";&#13;&#10;			var sxml = unescape(oo.childNodes(11).text);&#13;&#10;			if(sxml.substring(0,6) != "<root>") sxml = "<root>"+sxml+"<set></set></root>";&#13;&#10;			var oXml = SetDom(sxml);&#13;&#10;			if(oXml.documentElement == null) continue;&#13;&#10;			var l = oXml.documentElement.childNodes.length-1;&#13;&#10;			for(var ii=0;ii<l;ii++){&#13;&#10;				sType += e_ConvertDataTypeToValue(oXml.documentElement.childNodes(ii).childNodes(1).text);&#13;&#10;				sName += oXml.documentElement.childNodes(ii).childNodes(0).text;&#13;&#10;				if(ii<l-1){&#13;&#10;					sType +="\\\\t";&#13;&#10;					sName +="\\\\t";&#13;&#10;				}&#13;&#10;	&#13;&#10;			}&#13;&#10;			sType = "\\\""+sType +"\\\"";&#13;&#10;			sName = "\\\""+sName +"\\\"";&#13;&#10;			&#13;&#10;			var s11 = "sql=\"types="+sType+";data=\\\""+uf_data(oo.childNodes(12).text)+"\\\";names="+sName+"\",type=buildin,cached=0,,indexSorted=false,indexIsUnique=false;"&#13;&#10;			//s11=RepStr(s11,"\\\\","\\\\\\\\\\\\\\\\");&#13;&#10;			sds.append(s11);&#13;&#10;		}else if(oo.childNodes(1).text == "自定义数据集"){	&#13;&#10;			//sds.append("name=ds1,sql=\"args=\\\"arg1,arg1value;arg2,arg2value\\\";class=\\\"cn.com.fcsoft.report.dataset.XMLDataSetFactory\\\"\",type=self,cached=0,,indexSorted=false,indexIsUnique=false;");&#13;&#10;			var s11="";&#13;&#10;			var oXml1 = SetDom("<root>"+oo.childNodes(2).text+"</root>");&#13;&#10;			if(oXml1.documentElement != null){&#13;&#10;				var ll = oXml1.documentElement.childNodes.length;&#13;&#10;				for(var j=0;j<ll;j++){&#13;&#10;					s11 += oXml1.documentElement.childNodes(j).childNodes(0).text+","+	escape(oXml1.documentElement.childNodes(j).childNodes(1).text); //自定义参数值加escape&#13;&#10;					if(j<ll-1) s11 += ";" ;&#13;&#10;				}	&#13;&#10;				s11 = "args=\\\""+s11+"\\\";";&#13;&#10;			}&#13;&#10;			sds.append("sql=\""+s11+"class=\\\"cn.com.fcsoft.report.dataset.XMLDataSetFactory\\\"\",type=self,cached=0,,indexSorted=false,indexIsUnique=false;");&#13;&#10;		&#13;&#10;		}else{&#13;&#10;			var sTypeTmp = "normal";&#13;&#10;			if(oo.childNodes(1).text == "存储过程") sTypeTmp = "proc";&#13;&#10;			&#13;&#10;			sds.append("sql=\""+oo.childNodes(2).text+"\",type="+sTypeTmp+",");&#13;&#10;			if(IsSpace(oo.childNodes(3).text) == false) {&#13;&#10;				sds.append("dsn="+oo.childNodes(3).text+",");&#13;&#10;				sDataSource += oo.childNodes(3).text+",";&#13;&#10;			}else{&#13;&#10;				isHaveDefault=true;&#13;&#10;			}&#13;&#10;			if(IsSpace(oo.childNodes(4).text) == false) &#13;&#10;				sds.append("param=\""+oo.childNodes(4).text+"\",");&#13;&#10;			if(IsSpace(oo.childNodes(5).text) == false) &#13;&#10;				sds.append("fieldText="+oo.childNodes(5).text+",");&#13;&#10;			if(IsSpace(oo.childNodes(6).text) == false) &#13;&#10;				sds.append("beginrow="+oo.childNodes(6).text+",");&#13;&#10;			if(IsSpace(oo.childNodes(7).text) == false) &#13;&#10;				sds.append("endrow="+oo.childNodes(7).text+",");&#13;&#10;			if(IsSpace(oo.childNodes(8).text) == false) &#13;&#10;				sds.append("indexCols="+oo.childNodes(8).text+",");&#13;&#10;				&#13;&#10;			sds.append("cached=0,indexSorted="+oo.childNodes(9).text+",indexIsUnique="+oo.childNodes(10).text+";"	);&#13;&#10;		}	&#13;&#10;	}&#13;&#10;	var s1 = sds.toString();&#13;&#10;	//alert(s1);&#13;&#10;	obj.e_dataset = escape(s1);&#13;&#10;	obj.e_datasetbak = escape(dataset1.RecordData);&#13;&#10;	//计算数据库连接串&#13;&#10;	if(isHaveDefault) sDataSource = "default,"+sDataSource;&#13;&#10;	if(sDataSource != "") {&#13;&#10;		sDataSource = sDataSource.substring(0,sDataSource.length-1);&#13;&#10;		obj.e_datasource = sDataSource;&#13;&#10;	}else{&#13;&#10;		obj.e_datasource ="";&#13;&#10;		obj.removeAttribute("e_datasource");&#13;&#10;	}&#13;&#10;	//处理其它属性&#13;&#10;	&#13;&#10;	window.returnValue = "ok";&#13;&#10;	&#13;&#10;	CloseBill();&#13;&#10;	&#13;&#10;	//计算内建数据集的结构串&#13;&#10;	//function uf_stru(s){&#13;&#10;	//	return [sType,sName];&#13;&#10;	//}&#13;&#10;	&#13;&#10;	//计算内建数据集的数据串&#13;&#10;	function uf_data(s){&#13;&#10;		var sData=new Sys.StringBuilder();&#13;&#10;		var sxml = unescape(s);&#13;&#10;		//if(sxml.substring(0,6) != "<root>") sxml = "<root>"+sxml+"<set></set></root>";&#13;&#10;		var oXml = SetDom(sxml);&#13;&#10;		var l = oXml.documentElement.childNodes.length-1;&#13;&#10;		var ll= oXml.documentElement.childNodes(l).childNodes(1).childNodes.length;&#13;&#10;		for(var i=0;i<l;i++){&#13;&#10;			//var ll= oXml.documentElement.childNodes(i).childNodes.length;&#13;&#10;			for(var j=0;j<ll;j++){&#13;&#10;				sData.append("\\\\\\\""+oXml.documentElement.childNodes(i).childNodes(j).text+"\\\\\\\"");&#13;&#10;				if(j<ll-1) sData.append("\\\\t");&#13;&#10;			}&#13;&#10;			if(i<l-1) sData.append("\\\\n");&#13;&#10;		}&#13;&#10;		return sData.toString();&#13;&#10;	}	&#13;&#10;}&#13;&#10;//设置数据集的其它属性&#13;&#10;function uf_other() {&#13;&#10;	if(grid1.tab.rows.length <= 1 ) return;&#13;&#10;	if(dataset1.Field('dstype').Value=="内建数据集"){&#13;&#10;		var o = [dataset1.Field("dsin1").Value,dataset1.Field("dsin2").Value];&#13;&#10;		var oRet = DjOpen("eb_dataset2",o,"展现","有模式窗口","直接","编辑内置数据集");&#13;&#10;		if(IsSpace(oRet)==false){&#13;&#10;			dataset1.bEdit = true;&#13;&#10;			dataset1.Field("dsin1").Value=oRet[0];&#13;&#10;			dataset1.Field("dsin2").Value=oRet[1];&#13;&#10;			dataset1.Update("不检查");&#13;&#10;		}&#13;&#10;	}else if(dataset1.Field('dstype').Value=="自定义数据集"){&#13;&#10;		var sxml1 = dataset1.Field("stext").Value;&#13;&#10;		sxml1 = new Eapi.Str().trim(sxml1);&#13;&#10;		//检查是否是合法的xml串&#13;&#10;		if(sxml1.substring(0,6) == "select") sxml1 = "";&#13;&#10;		if(sxml1.substring(0,3) != "<tr") sxml1 = "";&#13;&#10;&#13;&#10;		var oRet = DjOpen("eb_dataset3",sxml1,"展现","有模式窗口","直接","自定义数据集");&#13;&#10;		if(typeof oRet != "undefined"){&#13;&#10;			dataset1.bEdit = true;&#13;&#10;			dataset1.Field("stext").Value=oRet;&#13;&#10;			dataset1.Update("不检查");&#13;&#10;			grid1.hide();&#13;&#10;			dataset1.fset_cont();&#13;&#10;		}&#13;&#10;		&#13;&#10;	}else{&#13;&#10;		var o = new Object();&#13;&#10;		o.stext = dataset1.Field("stext").Value ;&#13;&#10;		o.param = dataset1.Field("param").Value ;&#13;&#10;		o.fieldchn = dataset1.Field("fieldchn").Value ;&#13;&#10;		o.beginrow = dataset1.Field("beginrow").Value ;&#13;&#10;		o.endrow = dataset1.Field("endrow").Value ;&#13;&#10;		o.indexcols = dataset1.Field("indexcols").Value ;&#13;&#10;		o.indexsorted = dataset1.Field("indexsorted").Value ;&#13;&#10;		o.indexunique = dataset1.Field("indexunique").Value ;&#13;&#10;		//找数据源连接串&#13;&#10;		o.datasourceName = dataset1.Field("dsn").Value;&#13;&#10;		var oRet = DjOpen("eb_dataset1",o,"展现","有模式窗口","直接","设置数据集的其它属性");&#13;&#10;		if(IsSpace(oRet) == false){&#13;&#10;			dataset1.bEdit = true;&#13;&#10;			dataset1.Field("stext").Value = oRet.stext  ;&#13;&#10;			dataset1.Field("param").Value = oRet.param  ;&#13;&#10;			dataset1.Field("fieldchn").Value = oRet.fieldchn  ;&#13;&#10;			dataset1.Field("beginrow").Value = oRet.beginrow ;&#13;&#10;			dataset1.Field("endrow").Value = oRet.endrow ;&#13;&#10;			dataset1.Field("indexcols").Value = oRet.indexcols ;&#13;&#10;			dataset1.Field("indexsorted").Value = oRet.indexsorted  ;&#13;&#10;			dataset1.Field("indexunique").Value = oRet.indexunique ;&#13;&#10;			dataset1.Update("不检查");&#13;&#10;			grid1.hide();&#13;&#10;			dataset1.fset_cont();&#13;&#10;		}&#13;&#10;	}&#13;&#10;}&#13;&#10;//转内建数据集&#13;&#10;function uf_toinds(){&#13;&#10;	if(grid1.tab.rows.length <= 1 ) return;&#13;&#10;	if(dataset1.Field("dstype").Value == "内建数据集" || dataset1.Field("dstype").Value == "自定义数据集") return;&#13;&#10;	//先运行SQL语句得到结构和记录.&#13;&#10;	&#13;&#10;	var sXml =  "<sql>" + dataset1.Field("stext").Value + "</sql>"+"<pageno>1</pageno><pagesize>-1</pagesize>";&#13;&#10;	var sds="";&#13;&#10;	var sDataSource = dataset1.Field("dsn").Value;&#13;&#10;	if(IsSpace(sDataSource) == false){ &#13;&#10;		sDataSource = "&datasourceName="+sDataSource;&#13;&#10;	}&#13;&#10;	sXml +=	"<ds>" + sds +"</ds>";&#13;&#10;	var sRet = new Eapi.RunAjax().sendHttp(location.protocol+"//"+location.host + fcpubdata.servletPath + "/WebBill"+fcpubdata.dotnetVersion+"?key=ToInDs"+sDataSource,sXml);	&#13;&#10;	//CopyToPub(sRet);&#13;&#10;	if(IsSpace(sRet)) {&#13;&#10;		alert("运行后台程序出错!");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	//生成结构数据集&#13;&#10;	var oXml = SetDom(sRet);&#13;&#10;	if(oXml.documentElement == null){&#13;&#10;		alert("转换失败! 原因是:"+sRet);&#13;&#10;		return;	&#13;&#10;	}&#13;&#10;	var sStru="";&#13;&#10;	var oDF=oXml.documentElement.childNodes(oXml.documentElement.childNodes.length-1).childNodes(1);&#13;&#10;	var l = oDF.childNodes.length;&#13;&#10;	for(var i=0;i<l;i++){&#13;&#10;		sStru += "<tr><td>"+oDF.childNodes(i).childNodes(0).text+"</td><td>"+typeTrans(oDF.childNodes(i).childNodes(1).text)+"</td></tr>"&#13;&#10;	}&#13;&#10;	//sStru = "<root>"+sStru+"<set><pages>0</pages><fields><field><fieldname>fieldname</fieldname><datatype>字符</datatype><displaylabel>字段名</displaylabel><size>50</size><precision>0</precision><fieldkind>变量默认值</fieldkind><defaultvalue>'字段'+(mRecordCount+1)</defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>datatype</fieldname><datatype>字符</datatype><displaylabel>数据类型</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue>字符串</defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>"&#13;&#10;	dataset1.bEdit = true;&#13;&#10;	dataset1.Field("dsin1").Value = escape(sStru);	&#13;&#10;	dataset1.Field("dsin2").Value = escape(sRet);&#13;&#10;	dataset1.Field("dstype").Value = "内建数据集";&#13;&#10;	dataset1.Update();&#13;&#10;	dataset1.fset_cont();&#13;&#10;	alert("转换成功!!");&#13;&#10;	//类型名称转换&#13;&#10;	function typeTrans(source){&#13;&#10;		if(source=="字符")&#13;&#10;			return "字符串";&#13;&#10;		else&#13;&#10;			return source ;&#13;&#10;	}&#13;&#10;}&#13;&#10;//存为常用数据集&#13;&#10;function uf_save(){&#13;&#10;	if(IsSpace(dataset1.Field("dsname").Value)){&#13;&#10;		alert("请选择一行后再试!");&#13;&#10;		return;	&#13;&#10;	}&#13;&#10;	//var orgid=getpubvalue("组织.ID");&#13;&#10;	var sql = "<insert tableName='fc_ebds'><names>(id,name,sqlstr,param,fieldchn,dsn,dstype,dsinStru,sortNo)</names><values>(";&#13;&#10;	var iNo = getMaxIntNo("SOR");&#13;&#10;	var sId = getMaxNo("RPD");&#13;&#10;	sql += "'"+sId+"',";&#13;&#10;&#13;&#10;	sql += "'"+dataset1.Field("dsname").Value+"',";&#13;&#10;	//sql += "'"+orgid+"',";&#13;&#10;	sql += "'"+dataset1.Field("stext").Value+"',";&#13;&#10;	if(dataset1.Field("dstype").Value == "内建数据集"){&#13;&#10;		var sRecord = dataset1.Field("dsin2").Value;&#13;&#10;		//var posEnd = sRecord.indexOf("<set><pages>");&#13;&#10;		//if(posEnd > 0) sRecord = sRecord.substring(6,posEnd);&#13;&#10;		//sRecord = escape(sRecord);&#13;&#10;		&#13;&#10;		if(sRecord.length >= 7900){&#13;&#10;			alert("要保存的内建数据集的记录串超长!");&#13;&#10;			return;&#13;&#10;		}&#13;&#10;		if(dataset1.Field("dsin1").Value.length >= 7900){&#13;&#10;			alert("要保存的内建数据集的表结构串超长!");&#13;&#10;			return;&#13;&#10;		}&#13;&#10;&#13;&#10;		sql += "'"+sRecord+"',";&#13;&#10;	}else{&#13;&#10;		dataset1.Field("dsin2").Value = ""; //清空,以免它的值超长.&#13;&#10;		sql += "'"+dataset1.Field("param").Value+"',";&#13;&#10;	}&#13;&#10;	sql += "'"+dataset1.Field("fieldchn").Value+"',";&#13;&#10;	sql += "'"+dataset1.Field("dsn").Value+"',";&#13;&#10;	sql += "'"+dataset1.Field("dstype").Value+"',";&#13;&#10;		&#13;&#10;	sql += "'"+dataset1.Field("dsin1").Value+"',"+iNo+" )</values></insert>";&#13;&#10;	&#13;&#10;	doSaveData(sql, function () {&#13;&#10;			alert("成功的将当前数据集保存为常用数据集了!");&#13;&#10;		});&#13;&#10;	&#13;&#10;}&#13;&#10;//增加&#13;&#10;function uf_add(){&#13;&#10;	dataset1.Append();&#13;&#10;	dataset1.fset_cont();&#13;&#10;	grid1.EndRowState='edit';	&#13;&#10;}&#13;&#10;function uf_addsel(){&#13;&#10;	var oRet = DjOpen("eb_datasetadd",null,"展现","有模式窗口","直接","增加数据集");&#13;&#10;	if(IsSpace(oRet) == false){&#13;&#10;			dataset1.Append();&#13;&#10;			grid1.EndRowState='edit';&#13;&#10;			dataset1.Field("dsname").Value = oRet.dsname;&#13;&#10;			dataset1.Field("stext").Value = oRet.sqlstr;&#13;&#10;			dataset1.Field("param").Value = oRet.param;&#13;&#10;			if(oRet.dstype == "内建数据集") dataset1.Field("dsin2").Value = oRet.param;&#13;&#10;			dataset1.Field("fieldchn").Value = oRet.fieldchn;&#13;&#10;			dataset1.Field("dsn").Value = oRet.dsn;&#13;&#10;			dataset1.Field("dstype").Value = oRet.dstype;&#13;&#10;			dataset1.Field("dsin1").Value = oRet.dsinStru;&#13;&#10;			dataset1.fset_cont();&#13;&#10;	}&#13;&#10;&#13;&#10;}</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" unselectable="on" isCheckPermit="否" alertType="1" userType BLONclose BLONopenBefore BLONopen="uf_open()" center="居中" dj_sn="eb_dataset" type="LR" caption="数据集设置" mkbh codeheader="BBB" keyfield window="有模式窗口" entertype="修改" posleft postop poswidth="730" posheight="340" isfile="是" OtherSave="否" idtype="1" billtaborder="<root><taborder>grid1</taborder><taborder>cmdAdd</taborder><taborder>button6</taborder><taborder>button7</taborder><taborder>cmdDel</taborder><taborder>cmdOk</taborder><taborder>cmdClose</taborder><taborder>button10</taborder><taborder>button11</taborder></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:2;radio:0;listbox:0;textarea:1;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:13;text:0;hr:0;checkboxlist:0;radiolist:0;dropdownlist:0;grid:1;dataset:1;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0;eblayout:0;test:undefined" contxml="<root><button><id>cmdAdd</id><id>button6</id><id>button7</id><id>cmdDel</id><id>cmdOk</id><id>cmdClose</id><id>button10</id><id>button11</id></button><grid><id>grid1</id></grid><dataset><id>dataset1</id></dataset></root>" toolbar="不带工具栏" BLONresizeBefore BLONresizeAfter allBrowser="否" useHelp envType="电脑" runParams><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 53px; LEFT: 784px" id=dataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" formatxml="<root><tr rowstate=&quot;add&quot;><td>dsname</td><td>名称</td><td>字符</td><td>50</td><td>0</td><td>变量默认值</td><td>'ds'+(mRecordCount+1)</td><td></td><td>否</td><td>是</td><td>否</td><td>是</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>120</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>dstype</td><td>类型</td><td>字符</td><td>12</td><td>0</td><td>数据项</td><td>SQL语句</td><td></td><td>选%3Ccode%3E%3Cxml%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3ESQL%u8BED%u53E5%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5B58%u50A8%u8FC7%u7A0B%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5185%u5EFA%u6570%u636E%u96C6%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u81EA%u5B9A%u4E49%u6570%u636E%u96C6%3C/td%3E%3C/tr%3E%3C/xml%3E%3Cformat%3E%3C/format%3E%3Cblninput%3E%u5426%3C/blninput%3E%3Cblnempty%3E%u5426%3C/blnempty%3E%3Ccheck%3E1%3C/check%3E%3Ctemptext%3ESQL%u8BED%u53E5%0D%0A%u5B58%u50A8%u8FC7%u7A0B%0D%0A%u5185%u5EFA%u6570%u636E%u96C6%0D%0A%u81EA%u5B9A%u4E49%u6570%u636E%u96C6%3C/temptext%3E%3C/code%3E</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>stext</td><td>SQL语句</td><td>字符</td><td>8000</td><td>0</td><td>数据项</td><td>select</td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>400</td><td></td><td></td><td></td><td></td><td></td><td></td><td>%28dataset1.Fields.Field%5B%27dstype%27%5D.Value%3D%3D%27SQL%u8BED%u53E5%27%20%26%26%20%20Valid.checkValue%28%27Require%27%2Cdataset1.Fields.Field%5B%27stext%27%5D.Value%29%3D%3Dfalse%29%20%3F%27SQL%u8BED%u53E5%u4E0D%u80FD%u4E3A%u7A7A%21%27%3A%27%27%20</td><td></td></tr><tr rowstate=&quot;add&quot;><td>dsn</td><td>数据源</td><td>字符</td><td>20</td><td>0</td><td>数据项</td><td></td><td></td><td>选%3Ccode%3E%3Cformat%3E%3C/format%3E%3Cblninput%3E%u662F%3C/blninput%3E%3Cblnempty%3E%u5426%3C/blnempty%3E%3Ccheck%3E1%3C/check%3E%3C/code%3E</td><td>是</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>70</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>param</td><td>参数串</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>fieldchn</td><td>字段中文名串</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>beginrow</td><td>开始行</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>endrow</td><td>结束行</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>indexcols</td><td>索引列</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>indexsorted</td><td>排序索引字段</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>indexunique</td><td>唯一的索引字段</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>dsin1</td><td>内置数据集结构</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>dsin2</td><td>内置数据集记录</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>" iscreatetable="否" opensql idparam subdsfield masterds masterdsfield Like="否" chnname temptable="TMP_DATASET1" async="否" validate="<root><field><Node0>[类型] 等于 'SQL语句'与 [内容] 为空  </Node0><Node1>&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;dataset1&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;dstype&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;类型&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;等于&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;SQL语句&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;与&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;dataset1&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;stext&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;内容&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;为空&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;</Node1><Node2>dataset1.Fields.Field['dstype'].Value=='SQL语句' &amp;amp;&amp;amp;  Valid.checkValue('Require',dataset1.Fields.Field['stext'].Value)==false</Node2><Node3>内联警告（屏幕提示和需要时显示的信息）</Node3><Node4>SQL语句不能为空!</Node4><Node5></Node5><name>stext</name></field></root>" AfterScroll BeforeScroll AfterPost BeforePost BeforeOpen AfterOpen datasourceName isSubGrid="否" opensortno="1" pubpara="否" saveastable isaddemptyrec="否" submittype="1" submitno="1" savetable issubds="否" controltype="dataset"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 727px; HEIGHT: 192px; TOP: 32px; LEFT: 7px" id=grid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" controltype="grid" crosstabdatatype="0" crosstabsql cavg="否" cmax="否" cmin="否" csum="否" ccount="否" ravg="否" rmax="否" rmin="否" rsum="否" rcount="否" coltitle rowtitle crosstabformat crosstabsumtype="0" crosstabtitle iscrosstab="否" usertitle="否" usertitlehtml titlerows titlerowheight blRowNo="否" hideHscroll="auto" visible="是" bodyrows="-1" bodyrowheight="-1" hideVscroll="auto" SetRowHeight="是" readonly="否" autoappend="否" autowidth="是" autoheight="是" canselect="是" dataset="dataset1" autosize="否">&nbsp;<BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 64px; HEIGHT: 26px; TOP: 4px; LEFT: 8px" id=cmdAdd onmovestart=moveStart() onresize=resize() onmove=move() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_add()")' dropstyle="否"></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 64px; HEIGHT: 25px; TOP: 2px; LEFT: 325px" id=button6 onmovestart=moveStart() onresize=resize() onmove=move() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_other()")' dropstyle="否">详细属性</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 90px; HEIGHT: 25px; TOP: 2px; LEFT: 394px" id=button7 onmovestart=moveStart() onresize=resize() onmove=move() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_toinds()")' dropstyle="否">转内建数据集</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 64px; HEIGHT: 26px; TOP: 4px; LEFT: 76px" id=cmdDel onmovestart=moveStart() onresize=resize() onmove=move() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("dataset1.Delete()")' dropstyle="否"></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 64px; HEIGHT: 26px; TOP: 4px; LEFT: 144px" id=cmdOk onmovestart=moveStart() onresize=resize() onmove=move() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_ok()")' dropstyle="否"></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 64px; HEIGHT: 26px; TOP: 4px; LEFT: 213px" id=cmdClose onmovestart=moveStart() onresize=resize() onmove=move() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("CloseBill()")' dropstyle="否"></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 100px; HEIGHT: 25px; TOP: 2px; LEFT: 488px" id=button10 onmovestart=moveStart() onresize=resize() onmove=move() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_save()")' dropstyle="否">存为常用数据集</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 130px; HEIGHT: 25px; TOP: 2px; LEFT: 593px" id=button11 onmovestart=moveStart() onresize=resize() onmove=move() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_addsel()")' dropstyle="否">用常用数据集来增加</BUTTON></DIV>