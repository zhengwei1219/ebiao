<script>//拼写listbox控件的显示SQL语句&#13;&#10;var db2UserName=fcpubdata.db2UserName;&#13;&#10;function uf_sSql(){&#13;&#10;	if(fcpubdata.databaseTypeName!="sqlserver" && fcpubdata.databaseTypeName!="oracle" && fcpubdata.databaseTypeName!="db2" && fcpubdata.databaseTypeName!="mysql"){&#13;&#10;		alert("数据库维护只支持sqlserver和oracle和db2和mysql");&#13;&#10;		CloseBill();&#13;&#10;	}&#13;&#10;	var sSql="";&#13;&#10;	if(fcpubdata.databaseTypeName=="sqlserver"){&#13;&#10;		sSql="select name from sysobjects where name <> 'dtproperties' and xtype='U' and name not like 'tmp_%' order by name ";	&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="oracle"){&#13;&#10;		sSql="select table_name from user_tables order by table_name";	&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="db2"){&#13;&#10;		sSql="SELECT TABNAME FROM SYSCAT.TABLES WHERE TABSCHEMA='"+db2UserName+"'";&#13;&#10;		Label2.style.display="none";&#13;&#10;		txtPkey.style.display="none";&#13;&#10;	}&#13;&#10;	if(sSql == ""){&#13;&#10;		var oOpt = new Eapi.RunAjax().sendHttp(location.protocol+"//"+location.host + fcpubdata.servletPath + "/WebBill"+fcpubdata.dotnetVersion+"?GetAllTables","<returnType>option</returnType><sFilter></sFilter>");&#13;&#10;	}else{&#13;&#10;		var oOpt=SqlCombo(lstTable,sSql);&#13;&#10;	}&#13;&#10;	lstTable.outerHTML=SelectAddOption(lstTable,oOpt);&#13;&#10;}&#13;&#10;&#13;&#10;//双击List列表，查询出当前数据表中的字段列表&#13;&#10;function uf_click(){&#13;&#10;	var slen=lstTable.length;&#13;&#10;	if(lstTable.selectedIndex>=0){&#13;&#10;		var mysqlKey = uf_showFieldList(lstTable.value);&#13;&#10;		if(typeof(mysqlKey ) != "undefined"){&#13;&#10;			txtPkey.value=mysqlKey;&#13;&#10;		}else{&#13;&#10;			uf_showkey(lstTable.value);&#13;&#10;		}&#13;&#10;	}&#13;&#10;}&#13;&#10;function uf_showFieldList(tableName) {&#13;&#10;	var sval = tableName;&#13;&#10;	var sSql="";&#13;&#10;	if(fcpubdata.databaseTypeName=="sqlserver"){&#13;&#10;		sSql="select syscolumns.name as fdname,systypes.name as fdtype,syscolumns.length as fdsize,syscolumns.scale as fddec,case when syscolumns.isnullable=0 then 'NOT NULL' when syscolumns.isnullable=1 then 'NULL' end as isnullable from syscolumns,sysobjects,"&#13;&#10;		+"systypes where syscolumns.id=sysobjects.id and  syscolumns.xtype=systypes.xtype and sysobjects.xtype='U' and systypes.name!='sysname' and "&#13;&#10;		+"sysobjects.name='"+sval+"' order by syscolumns.colorder";&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="oracle"){&#13;&#10;		sSql="select COLUMN_NAME as fdname,DATA_TYPE AS fdtype,decode(DATA_TYPE,'CHAR',DATA_LENGTH,'NCHAR',DATA_LENGTH,'VARCHAR2',DATA_LENGTH,'NVARCHAR2',DATA_LENGTH,'RAW',DATA_LENGTH,DATA_PRECISION) as fdsize,decode(DATA_TYPE,'NUMBER',DATA_SCALE,DATA_PRECISION) as fddec,decode(NULLABLE,'N','NOT NULL','Y','NULL') as isnullable from user_tab_columns where table_name='"+sval+"'";	&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="db2"){&#13;&#10;		sSql="select COLNAME as fdname,TYPENAME AS fdtype,LENGTH as fdsize,SCALE as fddec,CASE NULLS WHEN 'N' THEN 'NOT NULL' ELSE 'NULL' END as isnullable  FROM SYSCAT.COLUMNS where TABNAME='"+sval+"' and TABSCHEMA='"+db2UserName+"'";	&#13;&#10;	}&#13;&#10;	if(sSql==""){ //mysql&#13;&#10;        var retX = SelectSql("describe "+tableName,1,-1);&#13;&#10;        var oX = SetDom(retX);&#13;&#10;        if(oX.documentElement == null){&#13;&#10;        	alert(retX);&#13;&#10;        	return;&#13;&#10;        }&#13;&#10;        var keyName=""; //主键字段名&#13;&#10;        var sb=new Sys.StringBuilder("<root>");&#13;&#10;        for(var i=0;i<oX.documentElement.childNodes.length-1;i++){&#13;&#10;        	sb.append("<tr><td>"+oX.documentElement.childNodes(i).childNodes(0).text + "</td>")	;&#13;&#10;        	var sTypes = oX.documentElement.childNodes(i).childNodes(1).text;&#13;&#10;        	var posStart = sTypes.indexOf("(");&#13;&#10;        	var posEnd = sTypes.indexOf(")");&#13;&#10;        	var pos = sTypes.indexOf(",");&#13;&#10;        	if(pos>=0){&#13;&#10;	        	var fieldLen = sTypes.substring(posStart+1,pos);&#13;&#10;	        	var fieldDecLen=sTypes.substring(pos+1,posEnd);&#13;&#10;        	}else{&#13;&#10;	        	var fieldLen = sTypes.substring(posStart+1,posEnd);&#13;&#10;	        	var fieldDecLen="0";&#13;&#10;        	}&#13;&#10;        	&#13;&#10;        	var typeName = sTypes.substring(0,posStart);&#13;&#10;        	if(posStart < 0) typeName = sTypes;&#13;&#10;        	&#13;&#10;  			var sNull = "NULL";&#13;&#10;  			if(oX.documentElement.childNodes(i).childNodes(2).text == "NO") sNull = "NOT " +sNull;     	&#13;&#10;        	sb.append("<td>"+typeName+"</td><td>"+fieldLen+"</td><td>"+fieldDecLen+"</td><td>"+sNull+"</td><td></td></tr>");&#13;&#10;        	&#13;&#10;        	if(oX.documentElement.childNodes(i).childNodes(3).text != ""){&#13;&#10;        		keyName += oX.documentElement.childNodes(i).childNodes(0).text +"," ;&#13;&#10;        	}&#13;&#10;        }&#13;&#10;	&#13;&#10;		var ss = imgdataset1.xml;&#13;&#10;		var pos1 = ss.indexOf("<set><pages>");&#13;&#10;		if (pos1>=0){&#13;&#10;			ss = ss.substring(pos1,ss.length);	&#13;&#10;		}&#13;&#10;		sb.append(ss);&#13;&#10;        //sb.append("<set><pages>9</pages><fields><field><fieldname>fdname</fieldname><datatype>字符</datatype><displaylabel>西文字段名</displaylabel><size>50</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>fdtype</fieldname><datatype>字符</datatype><displaylabel>字段类型</displaylabel><size>20</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>fdsize</fieldname><datatype>整数</datatype><displaylabel>字段宽度</displaylabel><size>2</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>fddec</fieldname><datatype>整数</datatype><displaylabel>字段精度</displaylabel><size>2</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>isnullable</fieldname><datatype>整数</datatype><displaylabel>允许空</displaylabel><size>4</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>colorder</fieldname><datatype>字符</datatype><displaylabel>序列号</displaylabel><size>2</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>是</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>否</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>");&#13;&#10;        imgdataset1.OpenXmlData(sb.toString());   	        &#13;&#10;		if(keyName != "") keyName = keyName.substring(0,keyName.length-1);&#13;&#10;		return keyName;&#13;&#10;		&#13;&#10;	}else{&#13;&#10;		imgdataset1.Open(sSql);&#13;&#10;	}&#13;&#10;	&#13;&#10;	&#13;&#10;}&#13;&#10;//点击删除Button，将字段表中当前选中行从数据表中删除&#13;&#10;function uf_del(){&#13;&#10;	if(fcpubdata.databaseTypeName=="db2"){&#13;&#10;		alert("db2数据库不支持删除字段!");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	if(lstTable.selectedIndex<0){&#13;&#10;		alert("请选择数据表")&#13;&#10;		return;	&#13;&#10;	}&#13;&#10;	var TAB=lstTable.value;&#13;&#10;	var sSql="";&#13;&#10;	var allZD="";&#13;&#10;	var iCount=0;&#13;&#10;	var strusql = "";&#13;&#10;	&#13;&#10;	//双击多选删除字段&#13;&#10;	for (i=0;i<imgdataset1.RecordCount;i++){&#13;&#10;		if (imgdataset1.oDom.documentElement.childNodes(i).getAttribute("multisel")=='是') {  &#13;&#10;	    	var ZD=imgdataset1.oDom.documentElement.childNodes(i).childNodes(0).text;&#13;&#10;			sSql += _delOneField(TAB,ZD);&#13;&#10;			//strusql += "<no>delete FC_DBSTRU where tbname='"+TAB+"' and fdname='"+ZD+"'</no>";&#13;&#10;			allZD+=ZD+",";	&#13;&#10;			iCount++;&#13;&#10;		}&#13;&#10;	}&#13;&#10;	//默认当前行删除字段&#13;&#10;	if(iCount<=0){&#13;&#10;		allZD=imgdataset1.Field("fdname").Value&#13;&#10;		sSql += _delOneField(TAB,allZD);&#13;&#10;		//strusql += "<no>delete FC_DBSTRU where tbname='"+TAB+"' and fdname='"+allZD+"'</no>";&#13;&#10;	}&#13;&#10;	if(allZD.indexOf(",")>0){&#13;&#10;		allZD=allZD.substring(0,allZD.length-1);&#13;&#10;	}&#13;&#10;	var s1=sSql ;&#13;&#10;	var arr = s1.split(";");&#13;&#10;	var l= arr.length;&#13;&#10;	var sXml = ""&#13;&#10;	for(var i=0;i<l;i++){&#13;&#10;		var s2=new Eapi.Str().trim(arr[i])&#13;&#10;		if(IsSpace(s2)) continue;&#13;&#10;		sXml += s2 ;&#13;&#10;	}&#13;&#10;	if(confirm("真的要删除'"+allZD+"'字段吗？")){&#13;&#10;		var sRet=doSaveData(sXml,function (){alert("删除成功");uf_click();});	///&#13;&#10;		&#13;&#10;	}&#13;&#10;	/*if(IsSpace(sRet)){&#13;&#10;		var ss = InsertSqls(strusql);&#13;&#10;		uf_click();&#13;&#10;	}else{&#13;&#10;		alert(sRet);&#13;&#10;	}*/&#13;&#10;	&#13;&#10;	function _delOneField(tableName,fieldName){&#13;&#10;		var TAB = tableName;&#13;&#10;		var allZD = fieldName;&#13;&#10;		var sSql="";&#13;&#10;		if(fcpubdata.databaseTypeName=="sqlserver"){&#13;&#10;			var DF=SqlToField("select top 1 name from sysobjects where id=(select syscolumns.cdefault from syscolumns,sysobjects where syscolumns.id=sysobjects.id and sysobjects.name='"+TAB+"' and syscolumns.name='"+allZD+"')")&#13;&#10;			if(IsSpace(DF)==false){&#13;&#10;			sSql="<alter tableName='"+TAB+"'>"+ " <detail> drop constraint  "+DF+"</detail>"+"</alter>;\n"///&#13;&#10;			}&#13;&#10;		    sSql+="<alter tableName='"+TAB+"'>"+" <detail> drop column "+allZD+ "</detail>"+"</alter>;\n";	///&#13;&#10;		}&#13;&#10;		if(fcpubdata.databaseTypeName=="oracle" || fcpubdata.databaseTypeName=="mysql"){&#13;&#10;			sSql+="<alter tableName='"+TAB+"'>"+" <detail> drop column "+allZD+ "</detail>"+"</alter>;\n";///	&#13;&#10;		}&#13;&#10;		return sSql;&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;//点击修改Button，修改当前选中字段&#13;&#10;&#13;&#10;function uf_alterField(bAdd){&#13;&#10;	if(bAdd == false && fcpubdata.databaseTypeName=="db2"){&#13;&#10;		alert("db2数据库不支持修改字段!");&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	&#13;&#10;	if(lstTable.selectedIndex<0){&#13;&#10;		alert("请选择数据表")&#13;&#10;		return;		&#13;&#10;	}&#13;&#10;	var sval=lstTable.value;&#13;&#10;	var sFd="";&#13;&#10;	if(bAdd == false){&#13;&#10;		sFd=imgdataset1.Field('fdname').Value;&#13;&#10;	}&#13;&#10;	var arr=new Array();&#13;&#10;	arr[0]=sval;	//表名&#13;&#10;	arr[1]=sFd;		//字段名&#13;&#10;	var formTitle="";&#13;&#10;	if(bAdd == true){formTitle="新增字段"} else {formTitle="修改字段"};&#13;&#10;	var sText=DjOpen('fcs_edit_column',arr,'展现','有模式窗口','直接',formTitle);	&#13;&#10;	if(sText=="ok"){&#13;&#10;		uf_showFieldList(sval);&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;//设置主键&#13;&#10;&#13;&#10;function uf_setPrimaryKey(){&#13;&#10;	if(lstTable.selectedIndex<0){&#13;&#10;		alert("请选择数据表")	&#13;&#10;		return;	&#13;&#10;	}&#13;&#10;	var sval=lstTable.value;  //表名 &#13;&#10;	var sFd=""   //字段名&#13;&#10;	var sSql1="";&#13;&#10;	//查找原来的主键,并删除&#13;&#10;	var xmSql2="";&#13;&#10;	if(fcpubdata.databaseTypeName=="mysql"){&#13;&#10;	//	xmSql2+="<alter tableName='"+sval+"'>"+" <detail> drop primary key </detail>"+"</alter>"	&#13;&#10;	}&#13;&#10;	else{&#13;&#10;		if(fcpubdata.databaseTypeName=="sqlserver"){&#13;&#10;			sSql1="select name from sysobjects where parent_obj=(select id from sysobjects where sysobjects.name='"+sval+"') and sysobjects.type='K'";&#13;&#10;		}&#13;&#10;		if(fcpubdata.databaseTypeName=="oracle"){&#13;&#10;			sSql1="select constraint_name from user_constraints where table_name='"+sval+"' and constraint_type='P'"	&#13;&#10;		}&#13;&#10;		&#13;&#10;		&#13;&#10;		var s1=SqlToField(sSql1);&#13;&#10;		if(IsSpace(s1)==false){&#13;&#10;			xmSql2+="<alter tableName='"+sval+"'>"+" <detail> drop constraint  "+s1+"</detail>"+"</alter>"	&#13;&#10;		}&#13;&#10;	}&#13;&#10;	//加上新的主键&#13;&#10;	for(var i=0;i<imgdataset1.RecordCount;i++){&#13;&#10;		if(imgdataset1.oDom.documentElement.childNodes(i).getAttribute("multisel")=='是'){&#13;&#10;			sFd+=imgdataset1.oDom.documentElement.childNodes(i).childNodes(0).text+",";&#13;&#10;		}	&#13;&#10;	}&#13;&#10;	var len=sFd.length;&#13;&#10;	sFd=sFd.substring(0,len-1);&#13;&#10;	if(IsSpace(sFd)){&#13;&#10;		sFd=imgdataset1.Field('fdname').Value	///xmFd&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="sqlserver"){&#13;&#10;		xmSql2+="<alter tableName='"+sval+"'>"+"<detail> add constraint PK_"+sval+" PRIMARY KEY CLUSTERED ("+sFd+")"+"</detail>"+"</alter>"&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="oracle" || fcpubdata.databaseTypeName=="mysql"){&#13;&#10;		xmSql2+="<alter tableName='"+sval+"'>"+"<detail> add primary key ("+sFd+")"+"</detail>"+"</alter>"&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="db2"){&#13;&#10;		xmSql2+="<alter tableName='"+sval+"<detail> add constraint PK_"+sval+" PRIMARY KEY ("+sFd+")"+"</detail>"+"</alter>"&#13;&#10;	}&#13;&#10;	&#13;&#10;	&#13;&#10;	//成批执行这些命令&#13;&#10;	/*var arr = xmSql2.split(";");&#13;&#10;	var l= arr.length;&#13;&#10;	var sXml = ""&#13;&#10;	for(var i=0;i<l;i++){&#13;&#10;		var s3=new Eapi.Str().trim(arr[i])&#13;&#10;		if(IsSpace(s3)) continue;&#13;&#10;		sXml +=  s3 ;&#13;&#10;	}*/&#13;&#10;	//alert(xmSql2);&#13;&#10;	doSaveData(xmSql2,function (){alert("成功");uf_click();});	///&#13;&#10;	/*var sRet=InsertSqls(sXml);&#13;&#10;	if(IsSpace(sRet)){&#13;&#10;		//uf_showkey(sval)&#13;&#10;		uf_click();&#13;&#10;		alert("成功！");&#13;&#10;	}else{&#13;&#10;		alert(sRet);&#13;&#10;	}*/&#13;&#10;}&#13;&#10;//显示主键到编辑框&#13;&#10;function uf_showkey(sval) {&#13;&#10;	if(fcpubdata.databaseTypeName=="sqlserver"){&#13;&#10;		var sSql3="sp_helpindex '"+sval+"'"&#13;&#10;		var str=SelectSql(sSql3,1,1);&#13;&#10;		var oXml=SetDom(str);&#13;&#10;		var s1="";&#13;&#10;		if(oXml.documentElement != null ){&#13;&#10;			if(oXml.documentElement.childNodes.length>1){&#13;&#10;				s1=oXml.documentElement.childNodes(0).childNodes(2).text;&#13;&#10;			}&#13;&#10;		}&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="oracle"){&#13;&#10;		var sSql3="select user_cons_columns.column_name from user_constraints ,user_cons_columns where user_cons_columns.constraint_name=user_constraints.constraint_name and constraint_type='P' and user_constraints.table_name='"+sval+"'";&#13;&#10;		var sSql4="select count(user_cons_columns.column_name) from user_constraints ,user_cons_columns where user_cons_columns.constraint_name=user_constraints.constraint_name and constraint_type='P' and user_constraints.table_name='"+sval+"'";&#13;&#10;		var slen=SelectSql(sSql4,1,1);//查询出表内有几个字段被设为主键，返回XML串&#13;&#10;		var oXml1=SetDom(slen);&#13;&#10;		var ilen="";&#13;&#10;		var s1="";&#13;&#10;		if(oXml1.documentElement != null ){&#13;&#10;			if(oXml1.documentElement.childNodes.length>1){&#13;&#10;				ilen=oXml1.documentElement.childNodes(0).childNodes(0).text;//返回数字&#13;&#10;			}&#13;&#10;		}&#13;&#10;		if(ilen>0){&#13;&#10;			var str=SelectSql(sSql3,1,ilen);&#13;&#10;			var oXml=SetDom(str);&#13;&#10;			for(var i=0;i<ilen;i++){&#13;&#10;				s1+=oXml.documentElement.childNodes(i).childNodes(0).text+",";&#13;&#10;			}&#13;&#10;			s1=s1.substring(0,s1.length-1);&#13;&#10;		}&#13;&#10;	}&#13;&#10;	if(typeof s1 == "undefined") s1 = "";&#13;&#10;	txtPkey.value=s1;&#13;&#10;	&#13;&#10;}&#13;&#10;//删除表&#13;&#10;function uf_dropTab(){&#13;&#10;	if(lstTable.selectedIndex<0){&#13;&#10;		alert("请选择数据表")&#13;&#10;		return;		&#13;&#10;	}&#13;&#10;	var TAB=lstTable.value;  //表名 &#13;&#10;	var xmlSql="<drop tableName='"+TAB+"'>"+"</drop>";&#13;&#10;	var strusql = "delete FC_DBSTRU where tbname = '"+TAB+"'";&#13;&#10;	&#13;&#10;	if(confirm("确定要删除'"+TAB+"'表吗？")==true){&#13;&#10;		doSaveData(xmlSql,function (){&#13;&#10;			alert("删除成功");&#13;&#10;			lstTable.remove(lstTable.selectedIndex);&#13;&#10;			lstTable.selectedIndex=0;&#13;&#10;			&#13;&#10;			uf_click();&#13;&#10;		&#13;&#10;		});	&#13;&#10;	}&#13;&#10;    &#13;&#10;	/*var strusql = "delete FC_DBSTRU where tbname = '"+TAB+"'";&#13;&#10;	&#13;&#10;	//if(confirm("确定要删除'"+TAB+"'表吗？")==true){&#13;&#10;		//var s1=InsertSql(sSql);&#13;&#10;		//var ss = InsertSql(strusql);&#13;&#10;		&#13;&#10;	}else{&#13;&#10;		return;&#13;&#10;	}&#13;&#10;    &#13;&#10;	if(IsSpace(s1)){&#13;&#10;		for (var i=lstTable.length-1;i>=0;i--){&#13;&#10;			if (lstTable.options(i).selected){&#13;&#10;				lstTable.remove(i)&#13;&#10;				lstTable.selectedIndex=0&#13;&#10;				break;&#13;&#10;			}&#13;&#10;		}&#13;&#10;		uf_click();&#13;&#10;	}else{&#13;&#10;		alert(s1)*/&#13;&#10;	&#13;&#10;}&#13;&#10;&#13;&#10;//新建表&#13;&#10;function uf_createTab(){&#13;&#10;	var sText=DjOpen('fcs_edit_table','','展现','有模式窗口','直接','新建表及添加字段')	&#13;&#10;	&#13;&#10;	if(IsSpace(sText)==false){&#13;&#10;		sText = sText.toUpperCase();&#13;&#10;		var i=lstTable.options.length;&#13;&#10;		var oOpt=document.createElement("option")&#13;&#10;		oOpt.text=sText;&#13;&#10;		oOpt.value=sText;&#13;&#10;		lstTable.add(oOpt);&#13;&#10;		lstTable.options(i).selected=true;&#13;&#10;		&#13;&#10;		uf_showFieldList(sText);&#13;&#10;		txtPkey.value=""&#13;&#10;		uf_showkey(sText)	&#13;&#10;	}&#13;&#10;}&#13;&#10;&#13;&#10;//删除主键&#13;&#10;&#13;&#10;function uf_delUnique(){&#13;&#10;	var sval=lstTable.value;	//表名&#13;&#10;	if(fcpubdata.databaseTypeName=="db2" || fcpubdata.databaseTypeName=="mysql"){&#13;&#10;		//var sSql2="alter table "+sval+" drop PRIMARY KEY " ;&#13;&#10;		var xmlSql2="<alter tableName='"+sval+"'>"+"<detail> drop PRIMARY KEY </detail>"+"</alter>"; &#13;&#10;		if(confirm("确定要删除'"+sval+"'表的主键吗？")==true){&#13;&#10;			doSaveData(xmlSql2,function (){&#13;&#10;				alert("删除成功");&#13;&#10;				txtPkey.value="";	&#13;&#10;			});	&#13;&#10;		}&#13;&#10;	&#13;&#10;		return;&#13;&#10;	}&#13;&#10;	var sSql="";&#13;&#10;	if(fcpubdata.databaseTypeName=="sqlserver"){&#13;&#10;		sSql="select name from sysobjects where parent_obj=(select id from sysobjects where sysobjects.name='"+sval+"') and sysobjects.type='k'";&#13;&#10;		var oXml=SetDom(SelectSql(sSql,1,1));&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="oracle"){&#13;&#10;		sSql="select constraint_name from user_constraints where table_name='"+sval+"' and constraint_type='P'"	&#13;&#10;		var oXml=SetDom(SelectSql(sSql,1,1))&#13;&#10;	}&#13;&#10;	if(oXml.documentElement.childNodes.length>1){&#13;&#10;		var s1=oXml.documentElement.childNodes(0).childNodes(0).text;&#13;&#10;		//alert(s1)&#13;&#10;	}else{&#13;&#10;		alert("此表内未设主键");&#13;&#10;	}	&#13;&#10;	if(IsSpace(s1)==false){&#13;&#10;		xmlSql2="<alter tableName='"+sval+"'>"+"<detail> drop constraint "+ s1+"</detail>"+"</alter>"; &#13;&#10;		//alert(xmlSql2)&#13;&#10;		doSaveData(xmlSql2,function (){alert("删除成功");txtPkey.value="";});&#13;&#10;		/*var sSql2="alter table "+sval+" drop constraint "+s1;///&#13;&#10;		if(confirm("确定要删除'"+sval+"'表的主键吗？")==true){&#13;&#10;			var s2=InsertSql(sSql2);&#13;&#10;			if(IsSpace(s2)){&#13;&#10;				txtPkey.value="";	&#13;&#10;			}else{&#13;&#10;				alert(s2)&#13;&#10;			}&#13;&#10;		}else{&#13;&#10;			return;&#13;&#10;		}*/&#13;&#10;		&#13;&#10;	}&#13;&#10;	&#13;&#10;}</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcstring.js&#13;&#10;fcnumdate.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" runsave idtype="1" OtherSave="否" isfile="是" postop posleft window="当前窗口" toolbar="不带工具栏" BLONopen="uf_sSql()" contxml="<root><label><id>Label1</id><id>Label2</id></label><listbox><id>lstTable</id></listbox><button><id>FCButton7</id><id>button0</id><id>button1</id><id>button2</id><id>button3</id><id>button4</id><id>button5</id></button><text><id>txtPkey</id></text><grid><id>imgwebgrid1</id></grid><dataset><id>imgdataset1</id></dataset></root>" billtaborder="<root><taborder>lstTable</taborder><taborder>FCButton7</taborder><taborder>txtPkey</taborder><taborder>imgwebgrid1</taborder><taborder>button0</taborder><taborder>button1</taborder><taborder>button2</taborder><taborder>button3</taborder><taborder>button4</taborder><taborder>button5</taborder></root>" dj_sn="fcs_edit_db" type="ST" caption="数据库维护" mkbh codeheader="BBB" entertype="修改" poswidth posheight controlno="SKButton:0;SKDBedit:0;checkbox:0;label:0;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:5;text:0;hr:0;checkboxlist:0;radiolist:0;dropdownlist:0;grid:0;dataset:0;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0" keyfield unselectable="on" center="  " BLONopenBefore BLONclose userType><SPAN onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; TEXT-ALIGN: left; WIDTH: 124px; DISPLAY: block; FONT-FAMILY: 楷体_GB2312; HEIGHT: 17px; COLOR: #0000ff; FONT-SIZE: 16px; TOP: 37px; FONT-WEIGHT: bold; TEXT-DECORATION: underline; LEFT: 12px; backgroundColor1: #ffffff" id=Label1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" value="Label1">选择数据库表：</SPAN><SELECT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; BACKGROUND-COLOR: #ffffff; WIDTH: 195px; DISPLAY: block; FONT-FAMILY: ; HEIGHT: 384px; FONT-SIZE: 12px; TOP: 56px; LEFT: 6px" id=lstTable onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() onchange='bill_onclick("uf_click()")' size=8 controltype="listbox" AutoSizeXml="<record id ='lstTable'><Halign>不动</Halign><HWidth></HWidth><HUnit>px</HUnit><WSetType>百分比设置</WSetType><Width></Width><WExt></WExt><WSetUnit>px</WSetUnit><MinW></MinW><Palign>不动</Palign><PWidth></PWidth><PUnit>px</PUnit><HSetType>伸缩设置</HSetType><Height></Height><HExt>0</HExt><HSetUnit>px</HSetUnit><MinH></MinH></record>" datasourceName async="否" tempvalue temptext check="1" sql></SELECT><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 51px; TOP: 11px; LEFT: 663px" id=imgdataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" controltype="dataset" datasourceName async="否" masterdsfield masterds subdsfield issubds="否" idparam savetable submitno="1" submittype="1" isaddemptyrec="否" saveastable pubpara="否" isSubGrid="否" temptable="TMP_IMGDATASET2" opensortno="1" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll chnname opensql iscreatetable="否" Like="否" formatxml='<root><tr rowstate="add"><td>fdname</td><td>西文字段名</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>120</td><td></td><td></td><td></td><td></td><td></td><td>GridMultiSel(imgwebgrid1,imgdataset1)</td><td></td><td></td></tr><tr rowstate="add"><td>fdtype</td><td>字段类型</td><td>字符</td><td>20</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td>GridMultiSel(imgwebgrid1,imgdataset1)</td><td></td><td></td></tr><tr rowstate="add"><td>fdsize</td><td>宽度</td><td>整数</td><td>2</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>60</td><td></td><td></td><td></td><td></td><td></td><td>GridMultiSel(imgwebgrid1,imgdataset1)</td><td></td><td></td></tr><tr rowstate="add"><td>fddec</td><td>精度</td><td>整数</td><td>2</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>40</td><td></td><td></td><td></td><td></td><td></td><td>GridMultiSel(imgwebgrid1,imgdataset1)</td><td></td><td></td></tr><tr rowstate="add"><td>isnullable</td><td>允许空</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td>GridMultiSel(imgwebgrid1,imgdataset1)</td><td></td><td></td></tr><tr rowstate="add"><td>colorder</td><td>序列号</td><td>字符</td><td>2</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>否</td><td>否</td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>40</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>'><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 429px; HEIGHT: 385px; TOP: 56px; LEFT: 200px" id=imgwebgrid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" controltype="grid" crosstabsql coltitle rowtitle crosstabformat crosstabsumtype="0" crosstabdatatype="0" crosstabtitle usertitlehtml titlerows titlerowheight canselect="是" autoheight="是" autowidth="是" autoappend="否" readonly="否" visible="是" usertitle="否" iscrosstab="否" rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否" csstext1="FONT-SIZE: 12px; OVERFLOW: hidden; BACKGROUND-COLOR: #ffffff" csstext2="FONT-SIZE: 12px; OVERFLOW: hidden; BACKGROUND-COLOR: #d4d0c8" SetRowHeight="是" hideHscroll="auto" hideVscroll="否" blRowNo="否" bodyrowheight="-1" bodyrows="-1" dataset="imgdataset1"><SPAN onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; TEXT-ALIGN: left; WIDTH: 92px; DISPLAY: block; FONT-FAMILY: 楷体_GB2312; HEIGHT: 0px; COLOR: #0000ff; FONT-SIZE: 16px; TOP: 37px; FONT-WEIGHT: bold; TEXT-DECORATION: none; LEFT: 160px; backgroundColor1: #c0c0c0" id=Label2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="label" value="Label2">主键字段：</SPAN><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; TEXT-ALIGN: left; BACKGROUND-COLOR: #ffffff; WIDTH: 337px; DISPLAY: block; HEIGHT: 20px; FONT-SIZE: 12px; TOP: 34px; LEFT: 249px" id=txtPkey onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() readOnly controltype="text" CanSelect="false"></INPUT><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; BACKGROUND-COLOR: #d4d0c8; WIDTH: 64px; DISPLAY: block; FONT-FAMILY: ; HEIGHT: 25px; FONT-SIZE: 12px; TOP: 7px; LEFT: 521px" id=FCButton7 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_delUnique()")' dropstyle="否">删除主键</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; BACKGROUND-COLOR: #d4d0c8; WIDTH: 64px; DISPLAY: block; FONT-FAMILY: ; HEIGHT: 25px; FONT-SIZE: 12px; TOP: 7px; LEFT: 454px" id=button0 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_setPrimaryKey()")' dropstyle="否">设置主键</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; BACKGROUND-COLOR: #d4d0c8; WIDTH: 64px; DISPLAY: block; FONT-FAMILY: ; HEIGHT: 25px; FONT-SIZE: 12px; TOP: 7px; LEFT: 388px" id=button1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_alterField(false)")' dropstyle="否">修改字段</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; BACKGROUND-COLOR: #d4d0c8; WIDTH: 64px; DISPLAY: block; FONT-FAMILY: ; HEIGHT: 25px; FONT-SIZE: 12px; TOP: 7px; LEFT: 322px" id=button2 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_del()")' dropstyle="否">删除字段</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; BACKGROUND-COLOR: #d4d0c8; WIDTH: 64px; DISPLAY: block; FONT-FAMILY: ; HEIGHT: 25px; FONT-SIZE: 12px; TOP: 7px; LEFT: 256px" id=button3 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_alterField(true)")' dropstyle="否">新增字段</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; BACKGROUND-COLOR: #d4d0c8; WIDTH: 64px; DISPLAY: block; FONT-FAMILY: ; HEIGHT: 25px; FONT-SIZE: 12px; TOP: 7px; LEFT: 190px" id=button4 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_dropTab()")' dropstyle="否">删除表</BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; BACKGROUND-COLOR: #d4d0c8; WIDTH: 64px; DISPLAY: block; FONT-FAMILY: ; HEIGHT: 25px; FONT-SIZE: 12px; TOP: 7px; LEFT: 123px" id=button5 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_createTab()")' dropstyle="否">新建表</BUTTON></DIV>