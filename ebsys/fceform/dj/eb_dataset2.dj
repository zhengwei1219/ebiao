<script>var obj ;&#13;&#10;function uf_open(){&#13;&#10;	//CopyToPub(dataset1.xml);&#13;&#10;	//CopyToPub(grid2.format);&#13;&#10;	//return;&#13;&#10;	&#13;&#10;	var sds = fcpubdata.obj[0] ; &#13;&#10;	if(IsSpace(sds) == false){&#13;&#10;		var sStru = unescape(sds);&#13;&#10;		if(sStru.substring(0,6) != "<root>") &#13;&#10;			sStru = "<root>"+sStru+"<set><pages>0</pages><fields><field><fieldname>fieldname</fieldname><datatype>字符</datatype><displaylabel>字段名</displaylabel><size>50</size><precision>0</precision><fieldkind>变量默认值</fieldkind><defaultvalue>'字段'+(mRecordCount+1)</defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>datatype</fieldname><datatype>字符</datatype><displaylabel>数据类型</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue>字符串</defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>";&#13;&#10;		dataset1.OpenXmlData(sStru);&#13;&#10;	}else{&#13;&#10;		dataset1.Delete();&#13;&#10;	}	&#13;&#10;	var sds = fcpubdata.obj[1] ;&#13;&#10;&#13;&#10;	if(IsSpace(sds) == false){&#13;&#10;		grid2.format=uf_getGridFormat(dataset1.RecordCount);&#13;&#10;		dataset2.OpenXmlData(unescape(sds));&#13;&#10;	}else{&#13;&#10;		dataset2.Delete();&#13;&#10;	}	&#13;&#10;	e_PropWinOnload();		&#13;&#10;}&#13;&#10;&#13;&#10;function uf_ok() {&#13;&#10;	window.returnValue = [escape(dataset1.RecordData),escape(dataset2.xml)];&#13;&#10;	CloseBill();&#13;&#10;	&#13;&#10;}&#13;&#10;function uf_delfield() {&#13;&#10;	if(dataset1.RecordCount<=0) {&#13;&#10;		alert("没有要删除的字段!");&#13;&#10;		return;&#13;&#10;	}	&#13;&#10;	if(window.confirm("删除 "+dataset1.Fields.Field['fieldname'].Value+" 字段的同时会将此字段的所有记录数据都删除,你确定要删除吗?")==false) return;&#13;&#10;	&#13;&#10;	var sAll="";&#13;&#10;	if(dataset1.RecordCount==1){&#13;&#10;		sAll = "<root><tr><td></td></tr><set><pages>0</pages><fields><field><fieldname>aaaa</fieldname><datatype>字符</datatype><displaylabel>新建字段</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>";&#13;&#10;	}else{&#13;&#10;		var oField = dataset2.oDom.documentElement.childNodes(dataset2.oDom.documentElement.childNodes.length-1).childNodes(1)	;&#13;&#10;		oField.removeChild(oField.childNodes(dataset1.RecNo));&#13;&#10;		var l = dataset2.oDom.documentElement.childNodes.length-1;&#13;&#10;		for(var i=0;i<l;i++){&#13;&#10;			dataset2.oDom.documentElement.childNodes(i).removeChild(dataset2.oDom.documentElement.childNodes(i).childNodes(dataset1.RecNo));	&#13;&#10;		}&#13;&#10;		sAll = dataset2.oDom.documentElement.xml ;&#13;&#10;	}&#13;&#10;	&#13;&#10;	dataset2.OpenXmlData(sAll);	&#13;&#10;	&#13;&#10;	dataset1.Delete();&#13;&#10;}&#13;&#10;function uf_addfield() {&#13;&#10;	var sAll="";&#13;&#10;	if(dataset1.RecordCount==0){&#13;&#10;		dataset1.Append();&#13;&#10;		dataset1.fset_cont();&#13;&#10;		//<root><tr rowstate="add"><td></td></tr><set><pages>0</pages><fields><field><fieldname>aaaa</fieldname><datatype>字符</datatype><displaylabel>新建字段</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>&#13;&#10;		sAll="<root><tr><td></td></tr><set><pages>0</pages><fields><field><fieldname>"+dataset1.Fields.Field['fieldname'].Value+"</fieldname><datatype>字符</datatype><displaylabel>"+dataset1.Fields.Field['fieldname'].Value+"</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>";&#13;&#10;	}else{&#13;&#10;		dataset1.Append();&#13;&#10;		dataset1.fset_cont();&#13;&#10;		var oField = dataset2.oDom.documentElement.childNodes(dataset2.oDom.documentElement.childNodes.length-1).childNodes(1)	;&#13;&#10;		var oSub = SetDom("<field><fieldname>"+dataset1.Fields.Field['fieldname'].Value+"</fieldname><datatype>字符</datatype><displaylabel>"+dataset1.Fields.Field['fieldname'].Value+"</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field>");&#13;&#10;		oField.appendChild(oSub.documentElement);&#13;&#10;		var l = dataset2.oDom.documentElement.childNodes.length-1;&#13;&#10;		for(var i=0;i<l;i++){&#13;&#10;			var oSub1=SetDom("<td/>");&#13;&#10;			dataset2.oDom.documentElement.childNodes(i).appendChild(oSub1.documentElement);	&#13;&#10;		}&#13;&#10;		sAll = dataset2.oDom.documentElement.xml ;&#13;&#10;		/*&#13;&#10;		l=dataset1.RecordCount;&#13;&#10;		var sb=new Sys.StringBuilder();&#13;&#10;		for(var i=0;i<l;i++){&#13;&#10;			sb.append("<col><fname>aaaa</fname><cname>新建字段</cname><width>10</width><dtype>字符</dtype><readonly>否</readonly><visible>是</visible><u></u><v></v><s></s><r></r><columnwidth>80</columnwidth><align>left</align></col>");&#13;&#10;		}&#13;&#10;		grid2.format="<cols>"+sb.toString()+"</cols>";&#13;&#10;		*/&#13;&#10;		grid2.format=uf_getGridFormat(dataset1.RecordCount);&#13;&#10;	}	&#13;&#10;	dataset2.OpenXmlData(sAll);&#13;&#10;	&#13;&#10;}&#13;&#10;function uf_getGridFormat(iCount){&#13;&#10;	var l=iCount;&#13;&#10;	var sb=new Sys.StringBuilder();&#13;&#10;	for(var i=0;i<l;i++){&#13;&#10;		sb.append("<col><fname>aaaa</fname><cname>新建字段</cname><width>10</width><dtype>字符</dtype><readonly>否</readonly><visible>是</visible><u></u><v></v><s></s><r></r><columnwidth>80</columnwidth><align>left</align></col>");&#13;&#10;	}&#13;&#10;	return "<cols>"+sb.toString()+"</cols>";&#13;&#10;	&#13;&#10;}&#13;&#10;function uf_afterupdate() {&#13;&#10;	//更新标题&#13;&#10;	var index = dataset1.RecNo;&#13;&#10;	var newTitle=dataset1.Fields.Field["fieldname"].Value;&#13;&#10;	var oField = dataset2.oDom.documentElement.childNodes(dataset2.oDom.documentElement.childNodes.length-1).childNodes(1)	;&#13;&#10;	oField.childNodes(index).childNodes(0).text=newTitle;&#13;&#10;	oField.childNodes(index).childNodes(2).text=newTitle;	&#13;&#10;	grid2.tab.rows(0).cells(index+1).innerText = newTitle;&#13;&#10;}&#13;&#10;//页签控件的点击事件&#13;&#10;function PubClickPageControl(index) {&#13;&#10;	var oGrid = grid1;&#13;&#10;	if(index == 1){&#13;&#10;		oGrid = grid2;&#13;&#10;	}&#13;&#10;	oGrid.ParentPos = "相对" ;&#13;&#10;	oGrid.hideVscroll = false ;&#13;&#10;	oGrid.hideHscroll = false ;&#13;&#10;	oGrid.HScroll();  //重算滚动条&#13;&#10;	oGrid.VScroll();&#13;&#10;}&#13;&#10;&#13;&#10;</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;fcdate.js&#13;&#10;~userfunc.js" mkbh unselectable="on" contxml="<root><tab><id>tab2</id></tab><button><id>cmdAdd1</id><id>cmdDel1</id><id>cmdAdd</id><id>cmdDel</id><id>cmdOk</id><id>cmdClose</id></button><grid><id>grid1</id><id>grid2</id></grid><dataset><id>dataset1</id><id>dataset2</id></dataset></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:0;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:2;div:0;DsMain_field:0;a:0;button:7;text:0;hr:0;checkboxlist:0;radiolist:0;dropdownlist:0;grid:2;dataset:2;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0" billtaborder="<root><taborder>grid1</taborder><taborder>grid2</taborder><taborder>cmdAdd1</taborder><taborder>cmdDel1</taborder><taborder>cmdOk</taborder><taborder>cmdClose</taborder><taborder>cmdAdd</taborder><taborder>cmdDel</taborder></root>" OtherSave="否" codeheader="BBB" keyfield entertype="修改" idtype="1" BLONclose BLONopenBefore BLONopen="uf_open()" window="有模式窗口" toolbar="不带工具栏" posheight="400" poswidth="540" postop posleft center="居中" isfile="是" type="PR" caption="编辑内置数据集" dj_sn="eb_dataset2" userType><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 38px; LEFT: 538px" id=dataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" temptable="TMP_DATASET1" chnname Like="否" opensortno="1" AfterOpen BeforeOpen BeforePost AfterPost="uf_afterupdate()" BeforeScroll AfterScroll opensql iscreatetable="否" pubpara="否" formatxml="<root><tr rowstate=&quot;add&quot;><td>fieldname</td><td>字段名</td><td>字符</td><td>50</td><td>0</td><td>变量默认值</td><td>'字段'+(mRecordCount+1)</td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>180</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr rowstate=&quot;add&quot;><td>datatype</td><td>数据类型</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td>字符串</td><td></td><td>选%3Ccode%3E%3Cxml%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u6574%u6570%3C/td%3E%3Ctd%3E%u6574%u6570%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5B9E%u6570%3C/td%3E%3Ctd%3E%u5B9E%u6570%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5B57%u7B26%u4E32%3C/td%3E%3Ctd%3E%u5B57%u7B26%u4E32%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u65E5%u671F%3C/td%3E%3Ctd%3E%u65E5%u671F%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u65F6%u95F4%3C/td%3E%3Ctd%3E%u65F6%u95F4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u65E5%u671F%u65F6%u95F4%3C/td%3E%3Ctd%3E%u65E5%u671F%u65F6%u95F4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5E03%u5C14%3C/td%3E%3Ctd%3E%u5E03%u5C14%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u6574%u6570%u7EC4%3C/td%3E%3Ctd%3E%u6574%u6570%u7EC4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5B9E%u6570%u7EC4%3C/td%3E%3Ctd%3E%u5B9E%u6570%u7EC4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5B57%u7B26%u4E32%u7EC4%3C/td%3E%3Ctd%3E%u5B57%u7B26%u4E32%u7EC4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u9ED8%u8BA4%3C/td%3E%3Ctd%3E%u9ED8%u8BA4%3C/td%3E%3C/tr%3E%3C/xml%3E%3Cformat%3E%3C/format%3E%3Cblninput%3E%u5426%3C/blninput%3E%3Cblnempty%3E%u5426%3C/blnempty%3E%3Ccheck%3E1%3C/check%3E%3Ctempvalue%3E%u6574%u6570%0D%0A%u5B9E%u6570%0D%0A%u5B57%u7B26%u4E32%0D%0A%u65E5%u671F%0D%0A%u65F6%u95F4%0D%0A%u65E5%u671F%u65F6%u95F4%0D%0A%u5E03%u5C14%0D%0A%u6574%u6570%u7EC4%0D%0A%u5B9E%u6570%u7EC4%0D%0A%u5B57%u7B26%u4E32%u7EC4%0D%0A%u9ED8%u8BA4%3C/tempvalue%3E%3Ctemptext%3E%u6574%u6570%0D%0A%u5B9E%u6570%0D%0A%u5B57%u7B26%u4E32%0D%0A%u65E5%u671F%0D%0A%u65F6%u95F4%0D%0A%u65E5%u671F%u65F6%u95F4%0D%0A%u5E03%u5C14%0D%0A%u6574%u6570%u7EC4%0D%0A%u5B9E%u6570%u7EC4%0D%0A%u5B57%u7B26%u4E32%u7EC4%0D%0A%u9ED8%u8BA4%3C/temptext%3E%3C/code%3E</td><td>是</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>100</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>" controltype="dataset">&nbsp; 
<DIV onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 518px; HEIGHT: 339px; TOP: 0px; LEFT: 4px" id=tab2 onresize=page_onresize() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="tab" value="记录">
<TABLE id=fcpagesubtable onmousedown=pageonclick() onresizestart=CancelEvent() bgColor=white>
<TBODY>
<TR contentEditable=false>
<TD style="BORDER-LEFT: #8ba7b6 1px solid; BACKGROUND-COLOR: white; COLOR: red; BORDER-TOP: #8ba7b6 1px solid; BORDER-RIGHT: #8ba7b6 1px solid" height=20 width=80 align=middle><FONT size=2>字段</FONT></TD>
<TD style="BORDER-LEFT: #8ba7b6 1px solid; BACKGROUND-COLOR: white; COLOR: black; BORDER-TOP: #8ba7b6 1px solid; BORDER-RIGHT: #8ba7b6 1px solid" height=20 width=80 align=middle><FONT size=2>记录</FONT></TD></TR></TBODY></TABLE>
<DIV oncontrolselect=controlselect() style="Z-INDEX: 1; BORDER-BOTTOM: #8ba7b6 1px solid; POSITION: absolute; BORDER-LEFT: #8ba7b6 1px solid; BACKGROUND-COLOR: white; WIDTH: 516px; HEIGHT: 319px; BORDER-TOP: #8ba7b6 1px solid; TOP: 22px; BORDER-RIGHT: #8ba7b6 1px solid" id=fcpagesub onmovestart=CancelEvent() onresizestart=CancelEvent()><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 351px; HEIGHT: 302px; TOP: 6px; LEFT: 3px" id=grid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" controltype="grid" ParentPos="相对" canselect="是" autoheight="否" autowidth="否" autoappend="否" readonly="否" titlerowheight titlerows usertitlehtml usertitle="否" iscrosstab="否" crosstabtitle crosstabsumtype crosstabformat rowtitle coltitle rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否" crosstabsql crosstabdatatype visible="是" dataset="dataset1"><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 55px; HEIGHT: 26px; TOP: 24px; LEFT: 361px" id=cmdAdd1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_addfield()")' dropstyle="否"></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 55px; HEIGHT: 26px; TOP: 55px; LEFT: 361px" id=cmdDel1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_delfield()")' dropstyle="否"></BUTTON></DIV>
<DIV oncontrolselect=controlselect() style="Z-INDEX: 0; BORDER-BOTTOM: #8ba7b6 1px solid; POSITION: absolute; BORDER-LEFT: #8ba7b6 1px solid; BACKGROUND-COLOR: white; WIDTH: 516px; HEIGHT: 319px; BORDER-TOP: #8ba7b6 1px solid; TOP: 22px; BORDER-RIGHT: #8ba7b6 1px solid" id=fcpagesub onmovestart=CancelEvent() onresizestart=CancelEvent()><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 501px; HEIGHT: 280px; TOP: 30px; LEFT: 5px" id=grid2 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" controltype="grid" canselect="是" autoheight="否" autowidth="否" autoappend="否" readonly="否" titlerowheight titlerows usertitlehtml usertitle="否" iscrosstab="否" crosstabtitle crosstabsumtype crosstabformat rowtitle coltitle rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否" crosstabsql crosstabdatatype visible="是" dataset="dataset2"><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 55px; HEIGHT: 26px; TOP: 2px; LEFT: 12px" id=cmdAdd onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("dataset2.Append();")' dropstyle="否"></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 55px; HEIGHT: 26px; TOP: 2px; LEFT: 82px" id=cmdDel onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("dataset2.Delete()")' dropstyle="否"></BUTTON></DIV></DIV><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 116px; LEFT: 569px" id=dataset2 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" temptable="TMP_DATASET2" chnname Like="否" opensortno="1" AfterOpen BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll opensql iscreatetable="否" pubpara="否" formatxml='<root><tr rowstate="add"><td>aaaa</td><td>新建字段</td><td>字符</td><td>10</td><td>0</td><td>数据项</td><td></td><td></td><td>否</td><td>是</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></root>' controltype="dataset"><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 55px; HEIGHT: 26px; TOP: 343px; LEFT: 359px" id=cmdOk onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("uf_ok()")' dropstyle="否"></BUTTON><BUTTON onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 55px; HEIGHT: 26px; TOP: 343px; LEFT: 429px" id=cmdClose onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="button" fc_onclick='bill_onclick("CloseBill()")' dropstyle="否"></BUTTON></DIV>