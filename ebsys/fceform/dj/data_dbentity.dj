<script>function uf_open(){&#13;&#10;	&#13;&#10;	&#13;&#10;	var connStr="";&#13;&#10;	if(IsSpace(dataset1.datasourceName)==false){&#13;&#10;		connStr="&datasourceName="+dataset1.datasourceName;	&#13;&#10;	}&#13;&#10;&#13;&#10;	&#13;&#10;	var sSql="";&#13;&#10;	if(fcpubdata.databaseTypeName=="sqlserver"){&#13;&#10;		sSql="select name as tbname from sysobjects where name <> 'dtproperties' and xtype='U' and UPPER(name) like ':{Trim(txtTableName.value.toUpperCase())+'%'}:' order by name ";	&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="oracle"){&#13;&#10;		sSql="select table_name as tbname from user_tables where UPPER(table_name) like ':{Trim(txtTableName.value.toUpperCase())+'%'}:' order by table_name";	&#13;&#10;	}&#13;&#10;	if(fcpubdata.databaseTypeName=="db2"){&#13;&#10;		sSql="SELECT TABNAME as tbname FROM SYSCAT.TABLES WHERE TABSCHEMA='"+db2UserName+"' and UCASE(TABNAME) like ':{Trim(txtTableName.value.toUpperCase())+'%'}:'";&#13;&#10;	}&#13;&#10;&#13;&#10;	if(sSql == ""){&#13;&#10;		new Eapi.RunAjax().sendHttp(location.protocol+"//"+location.host + fcpubdata.servletPath + "/WebBill"+fcpubdata.dotnetVersion+"?key=GetAllTables"+connStr,&#13;&#10;			"<returnType>dataset</returnType><sFilter></sFilter>",	_afterRun,dataset1);&#13;&#10;		&#13;&#10;	}else {&#13;&#10;		dataset1.PageSize = 20;&#13;&#10;		dataset1.Open(sSql);&#13;&#10;	}&#13;&#10;	fcpubdata.isCanRun = true;&#13;&#10;	&#13;&#10;	function _afterRun(result){&#13;&#10;		var retX = result.value;&#13;&#10;		var obj = result.context;&#13;&#10;		var oXml = SetDom(retX);&#13;&#10;		if(oXml.documentElement == null) return;&#13;&#10;		var len = oXml.documentElement.childNodes.length; &#13;&#10;		if(len <= 1) return;&#13;&#10;		var sb = new Sys.StringBuilder("<root>");&#13;&#10;		var sEntity = SelectSql("select tbname from fc_entity",1,-1); //取得已导入过的表名&#13;&#10;		var entityXml = SetDom(sEntity);&#13;&#10;		for(var i=0;i<len-1;i++){&#13;&#10;			var tableName = oXml.documentElement.childNodes(i).childNodes(0).text;&#13;&#10;			var sInfo = "";&#13;&#10;			if(isImport(entityXml,tableName)) sInfo = "已导入";&#13;&#10;			sb.append("<tr><td>"+tableName+"</td><td>"+sInfo+"</td></tr>");&#13;&#10;		}&#13;&#10;		sb.append(obj.oDom.documentElement.childNodes(obj.oDom.documentElement.childNodes.length-1).xml);&#13;&#10;		sb.append("</root>");&#13;&#10;		obj.OpenXmlData(sb.toString());&#13;&#10;	}&#13;&#10;}&#13;&#10;function uf_afterRun(oDs){&#13;&#10;	var len = oDs.oDom.documentElement.childNodes.length; &#13;&#10;	if(len <= 1) return;&#13;&#10;	&#13;&#10;	var sEntity = SelectSql("select tbname from fc_entity",1,-1); //取得已导入过的表名&#13;&#10;	var entityXml = SetDom(sEntity);&#13;&#10;	for(var i=0;i<len-1;i++){&#13;&#10;		var tableName = oDs.oDom.documentElement.childNodes(i).childNodes(0).text;&#13;&#10;		var sInfo = "";&#13;&#10;		if(isImport(entityXml,tableName)) {&#13;&#10;			sInfo = "已导入";&#13;&#10;			oDs.oDom.documentElement.childNodes(i).childNodes(1).text = sInfo;&#13;&#10;		}&#13;&#10;		&#13;&#10;	}&#13;&#10;	oDs.dset_cont();&#13;&#10;}&#13;&#10;function isImport(oXml,tableName){&#13;&#10;	tableName = tableName.toLowerCase();&#13;&#10;	for(var i=0;i<oXml.documentElement.childNodes.length;i++){&#13;&#10;		if(oXml.documentElement.childNodes(i).childNodes(0).text.toLowerCase() == tableName) return true;	&#13;&#10;	}&#13;&#10;	return false;&#13;&#10;}&#13;&#10;function uf_ok(){&#13;&#10;	if(fcpubdata.isCanRun == false) return;&#13;&#10;	fcpubdata.isCanRun = false;&#13;&#10;	var sb = new Sys.StringBuilder("<root>");&#13;&#10;	for(var i=0;i<dataset1.oDom.documentElement.childNodes.length-1;i++){&#13;&#10;		if(dataset1.oDom.documentElement.childNodes(i).getAttribute("multisel") =="是" ){ //&& dataset1.oDom.documentElement.childNodes(i).childNodes(1).text != "已导入" &#13;&#10;			sb.append("<option>"+dataset1.oDom.documentElement.childNodes(i).childNodes(0).text+"</option>");	&#13;&#10;		}	&#13;&#10;	}&#13;&#10;	sb.append("</root>");&#13;&#10;	var sOptions = sb.toString();&#13;&#10;	if(sOptions == "<root></root>") {&#13;&#10;		fcpubdata.isCanRun = true;&#13;&#10;		alert("至少要选中一个未导入的表后再试!");&#13;&#10;		return	&#13;&#10;	}&#13;&#10;	uf_action(sOptions);&#13;&#10;	&#13;&#10;}&#13;&#10;function uf_action(sOptions){&#13;&#10;//	var strXml="<returnType>option</returnType><sFilter>E_</sFilter><patternName>"+fcpubdata.db2UserName+"</patternName><dbType>oracle</dbType>"; //java版需要dbtype&#13;&#10;	var strXml="<returnType>option</returnType><sFilter></sFilter><patternName>"+fcpubdata.db2UserName+"</patternName><dbType>"+fcpubdata.databaseTypeName+"</dbType>"+sOptions;&#13;&#10;	new Eapi.RunAjax().sendHttp(location.protocol+"//"+location.host + fcpubdata.servletPath + "/WebBill"+fcpubdata.dotnetVersion+"?key=setDbStru",strXml,function (result){&#13;&#10;		var sRet = result.value;&#13;&#10;		if(IsSpace(sRet)==false) {&#13;&#10;			&#13;&#10;			fcpubdata.isCanRun = true;&#13;&#10;			alert(sRet);&#13;&#10;		}else{&#13;&#10;			alert("OK!");&#13;&#10;			CloseBill();&#13;&#10;		}&#13;&#10;	&#13;&#10;	})&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;function uf_key_enter(){&#13;&#10;	if(event.keyCode == 13){ //按回车键&#13;&#10;		dataset1.Open();&#13;&#10;	}	&#13;&#10;}</script> 
<DIV oncontrolselect=controlselect() id=SKbillsheet contentEditable=true jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcstring.js&#13;&#10;fcnumdate.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" isCheckPermit="否" alertType="1" userType userToolbar='<tr rowstate="add"><td>cmdImport</td><td></td><td>导 入</td><td>uf_ok()</td><td>50px</td></tr><tr rowstate="add"><td>query</td><td>查询</td><td></td><td></td><td></td></tr>' mkbh unselectable="on" contxml="<root><label><id>label1</id><id>label3</id></label><text><id>txtTableName</id></text><grid><id>grid1</id></grid><dataset><id>dataset1</id></dataset></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:3;radio:0;listbox:1;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:2;button:3;text:1;hr:0;checkboxlist:0;radiolist:0;dropdownlist:0;grid:1;dataset:1;spin:0;excel:0;tree:0;ebshow:0;ebiao:0;layout:0;page:0" billtaborder="<root><taborder>grid1</taborder><taborder>txtTableName</taborder></root>" runsave OtherSave="否" codeheader="BBB" keyfield entertype="修改" idtype="1" BLONclose BLONopenBefore BLONopen="uf_open()" window="当前窗口" toolbar="自定义工具栏" posheight poswidth postop posleft center="  " isfile="是" type="ST" caption="导入库结构到fc_entity表" dj_sn="data_dbentity"><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 129px; HEIGHT: 18px; TOP: 7px; LEFT: 6px" id=label1 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() inputTag="否" NotBg="否" controltype="label">在行上双击选择表名:</LABEL><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 371px; HEIGHT: 356px; TOP: 28px; LEFT: 4px" id=grid1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_webgrid.gif" controltype="grid" blRowNo="否" hideHscroll="auto" canselect="是" autoheight="是" autowidth="是" autoappend="否" readonly="否" titlerowheight titlerows usertitlehtml usertitle SetRowHeight="是" hideVscroll="auto" bodyrowheight="-1" bodyrows="-1" iscrosstab="否" crosstabtitle crosstabsumtype="0" crosstabformat rowtitle coltitle rcount="否" rsum="否" rmin="否" rmax="否" ravg="否" ccount="否" csum="否" cmin="否" cmax="否" cavg="否" crosstabsql crosstabdatatype="0" visible="是" dataset="dataset1"><IMG onresizeend=resizeEnd() style="POSITION: absolute; WIDTH: 39px; HEIGHT: 47px; TOP: 22px; LEFT: 444px" id=dataset1 onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() src="../../fceform/images/ef_designer_dataset.gif" idtype="1" controltype="dataset" async="否" isSubGrid="否" masterdsfield masterds subdsfield issubds="否" idparam savetable submitno="1" submittype="1" isaddemptyrec="否" opensortno="1" AfterOpen="uf_afterRun(dataset1)" BeforeOpen BeforePost AfterPost BeforeScroll AfterScroll opensql pubpara="否" formatxml='<root><tr rowstate="add"><td>tbname</td><td>表名称</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>280</td><td></td><td></td><td></td><td></td><td></td><td>GridMultiSel(grid1)</td><td></td><td></td></tr><tr rowstate="add"><td>iType</td><td>状态</td><td>字符</td><td>50</td><td>0</td><td>数据项</td><td></td><td></td><td>是</td><td>是</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td>否</td><td></td><td></td><td>left</td><td>80</td><td></td><td></td><td></td><td></td><td></td><td>GridMultiSel(grid1)</td><td></td><td></td></tr></root>' saveastable datasourceName><INPUT onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 115px; HEIGHT: 20px; TOP: 3px; LEFT: 238px" id=txtTableName onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() controltype="text" fc_onkeydown='bill_onkeydown("uf_key_enter()")'><LABEL onresizeend=resizeEnd() oncontrolselect=controlselect() style="POSITION: absolute; WIDTH: 58px; HEIGHT: 19px; TOP: 7px; LEFT: 178px" id=label3 onresize=resize() onmove=move() onmovestart=moveStart() onmoveend=moveEnd() onresizestart=resizeStart() inputTag="否" controltype="label">模糊查找</LABEL></DIV>